
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "gallery/surface_multi_texture.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_gallery_surface_multi_texture.py>`
        to download the full example code

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_gallery_surface_multi_texture.py:


Surface with multiple textures
==============================

This example demonstrates one possible method for displaying a 3D surface with
multiple textures.

Thanks to Emmanuel Reynaud and Luis Gutierrez for providing the gorgeous coral
model for this demo. You can find the data on FigShare:
https://doi.org/10.6084/m9.figshare.22348645

More information on the methods used to generate this model can be found in *L.
Gutierrez-Heredia, C. Keogh, E. G. Reynaud, Assessing the Capabilities of
Additive Manufacturing Technologies for Coral Studies, Education, and
Monitoring. Front. Mar. Sci. 5 (2018), doi:10.3389/fmars.2018.00278.*

A bit about 3D models
---------------------

A standard way to define a 3D model (mesh, or Surface in napari) is by listing
vertices (3D point coordinates) and faces (triplets of vertex indices - each
face is a triangle in 3D space). Meshes are often stored in "Wavefront" (.obj)
files, which may have companion material (.mtl) files that describe some
shading properties (base color, shinyness, etc.) for different parts of the
model.

In some cases, the color of a vertex is given by a single point value that is
then colormapped on the fly (`vertex_values`). In other cases, each vertex or
face may be assigned a specific color (`vertex_colors`). These methods are
demonstrated in :ref:`sphx_glr_gallery_surface_texture_and_colors.py`.

In the case of "photorealistic" models, the color of each vertex is instead
determined by mapping a vertex to a point in an image called a texture using 2D
texture coordinates in the range [0, 1]. The color of each individual pixel is
smoothly interpolated (sampled) on the fly from the texture (the GPU makes this
interpolation very fast).

Napari does not (yet) support models with multiple textures or materials. If
the textures don't overlap, you can display them on separate meshes as shown in
this demo. If the textures do overlap, you may instead be able to combine the
textures as images. This relies on textures having the same texture
coordinates, and may require resizing the textures to match each other.

.. tags:: visualization-nD

.. GENERATED FROM PYTHON SOURCE LINES 46-54

.. code-block:: default

    import os

    import matplotlib.pyplot as plt
    import pooch
    from vispy.io import imread, read_mesh

    import napari








.. GENERATED FROM PYTHON SOURCE LINES 55-57

Download the model
------------------

.. GENERATED FROM PYTHON SOURCE LINES 57-79

.. code-block:: default

    download = pooch.DOIDownloader(progressbar=True)
    doi = "10.6084/m9.figshare.22348645.v1"
    tmp_dir = pooch.os_cache("napari-surface-texture-example")
    os.makedirs(tmp_dir, exist_ok=True)
    data_files = {
        "mesh": "PocilloporaDamicornisSkin.obj",
        # "materials": "PocilloporaVerrugosaSkinCrop.mtl",  # not yet supported
        "Texture_0": "PocilloporaDamicornisSkin_Texture_0.jpg",
        "GeneratedMat2": "PocilloporaDamicornisSkin_GeneratedMat2.png",
    }
    print(f"downloading data into {tmp_dir}")
    for file_name in data_files.values():
        if not (tmp_dir / file_name).exists():
            print(f"downloading {file_name}")
            download(
                f"doi:{doi}/{file_name}",
                output_file=tmp_dir / file_name,
                pooch=None,
            )
        else:
            print(f"using cached {tmp_dir / file_name}")





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    downloading data into /home/runner/.cache/napari-surface-texture-example
    downloading PocilloporaDamicornisSkin.obj
      0%|                                              | 0.00/93.8M [00:00<?, ?B/s]      0%|                                      | 52.2k/93.8M [00:00<03:23, 460kB/s]      0%|                                      | 244k/93.8M [00:00<01:27, 1.06MB/s]      1%|▍                                    | 1.01M/93.8M [00:00<00:28, 3.25MB/s]      3%|█▏                                   | 2.88M/93.8M [00:00<00:10, 8.43MB/s]      5%|█▉                                   | 4.83M/93.8M [00:00<00:07, 11.9MB/s]      9%|███▎                                 | 8.34M/93.8M [00:00<00:04, 19.2MB/s]     12%|████▎                                | 10.8M/93.8M [00:00<00:03, 20.9MB/s]     15%|█████▋                               | 14.4M/93.8M [00:00<00:03, 25.4MB/s]     19%|██████▉                              | 17.6M/93.8M [00:00<00:02, 27.3MB/s]     23%|████████▍                            | 21.4M/93.8M [00:01<00:02, 29.6MB/s]     27%|██████████                           | 25.5M/93.8M [00:01<00:02, 33.0MB/s]     31%|███████████▍                         | 29.0M/93.8M [00:01<00:01, 33.2MB/s]     35%|████████████▉                        | 32.9M/93.8M [00:01<00:01, 35.1MB/s]     39%|██████████████▌                      | 36.9M/93.8M [00:01<00:01, 36.4MB/s]     43%|████████████████                     | 40.8M/93.8M [00:01<00:01, 37.1MB/s]     48%|█████████████████▋                   | 44.8M/93.8M [00:01<00:01, 38.1MB/s]     52%|███████████████████▏                 | 48.7M/93.8M [00:01<00:01, 38.4MB/s]     56%|████████████████████▊                | 52.8M/93.8M [00:01<00:01, 39.2MB/s]     61%|██████████████████████▍              | 56.7M/93.8M [00:02<00:00, 38.9MB/s]     65%|████████████████████████             | 60.9M/93.8M [00:02<00:00, 39.7MB/s]     69%|█████████████████████████▌           | 64.9M/93.8M [00:02<00:00, 39.3MB/s]     74%|███████████████████████████▎         | 69.1M/93.8M [00:02<00:00, 40.1MB/s]     78%|████████████████████████████▊        | 73.1M/93.8M [00:02<00:00, 39.5MB/s]     82%|██████████████████████████████▌      | 77.3M/93.8M [00:02<00:00, 40.3MB/s]     87%|████████████████████████████████     | 81.3M/93.8M [00:02<00:00, 39.8MB/s]     91%|█████████████████████████████████▋   | 85.4M/93.8M [00:02<00:00, 40.1MB/s]     95%|███████████████████████████████████▎ | 89.5M/93.8M [00:02<00:00, 40.0MB/s]    100%|████████████████████████████████████▉| 93.5M/93.8M [00:02<00:00, 40.2MB/s]      0%|                                              | 0.00/93.8M [00:00<?, ?B/s]    100%|██████████████████████████████████████| 93.8M/93.8M [00:00<00:00, 294GB/s]
    downloading PocilloporaDamicornisSkin_Texture_0.jpg
      0%|                                              | 0.00/17.3M [00:00<?, ?B/s]      0%|                                      | 52.2k/17.3M [00:00<00:43, 393kB/s]      1%|▌                                      | 244k/17.3M [00:00<00:17, 999kB/s]      6%|██▏                                  | 1.01M/17.3M [00:00<00:05, 3.14MB/s]     20%|███████▏                             | 3.38M/17.3M [00:00<00:01, 9.86MB/s]     35%|████████████▊                        | 5.97M/17.3M [00:00<00:00, 14.9MB/s]     54%|███████████████████▊                 | 9.26M/17.3M [00:00<00:00, 20.5MB/s]     69%|█████████████████████████▍           | 11.9M/17.3M [00:00<00:00, 22.2MB/s]     89%|████████████████████████████████▉    | 15.4M/17.3M [00:00<00:00, 26.0MB/s]      0%|                                              | 0.00/17.3M [00:00<?, ?B/s]    100%|█████████████████████████████████████| 17.3M/17.3M [00:00<00:00, 47.8GB/s]
    downloading PocilloporaDamicornisSkin_GeneratedMat2.png
      0%|                                               | 0.00/120k [00:00<?, ?B/s]     43%|████████████████▉                      | 52.2k/120k [00:00<00:00, 392kB/s]      0%|                                               | 0.00/120k [00:00<?, ?B/s]    100%|████████████████████████████████████████| 120k/120k [00:00<00:00, 240MB/s]




.. GENERATED FROM PYTHON SOURCE LINES 80-86

Load the model
--------------
Next, read the model data from the .obj file. Currently napari/vispy do not
support reading material properties (.mtl files) nor separate texture and
vertex indices (i.e. repeated vertices). Normal vectors read from the file
are also ignored and re-calculated from the faces.

.. GENERATED FROM PYTHON SOURCE LINES 86-88

.. code-block:: default

    vertices, faces, _normals, texcoords = read_mesh(tmp_dir / data_files["mesh"])








.. GENERATED FROM PYTHON SOURCE LINES 89-94

Load the textures
-----------------
This model comes with two textures: `Texture_0` is generated from
photogrammetry of the actual object, and `GeneratedMat2` is a generated
material to fill in  parts of the model lacking photographic texture.

.. GENERATED FROM PYTHON SOURCE LINES 94-97

.. code-block:: default

    photo_texture = imread(tmp_dir / data_files["Texture_0"])
    generated_texture = imread(tmp_dir / data_files["GeneratedMat2"])








.. GENERATED FROM PYTHON SOURCE LINES 98-99

This is what the texture images look like in 2D:

.. GENERATED FROM PYTHON SOURCE LINES 99-110

.. code-block:: default

    fig, axs = plt.subplots(1, 2)
    axs[0].set_title(f"Texture_0 {photo_texture.shape}")
    axs[0].imshow(photo_texture)
    axs[0].set_xticks((0, photo_texture.shape[1]), labels=(0.0, 1.0))
    axs[0].set_yticks((0, photo_texture.shape[0]), labels=(0.0, 1.0))
    axs[1].set_title(f"GeneratedMat2 {generated_texture.shape}")
    axs[1].imshow(generated_texture)
    axs[1].set_xticks((0, generated_texture.shape[1]), labels=(0.0, 1.0))
    axs[1].set_yticks((0, generated_texture.shape[0]), labels=(0.0, 1.0))
    fig.show()




.. image-sg:: /gallery/images/sphx_glr_surface_multi_texture_001.png
   :alt: Texture_0 (8192, 8192, 3), GeneratedMat2 (2048, 2048, 4)
   :srcset: /gallery/images/sphx_glr_surface_multi_texture_001.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 111-116

Create the napari layers
------------------------
Next create two separate layers with the same mesh - once with each texture.
In this example the texture coordinates happen to be the same for each
texture, but this is not a strict requirement.

.. GENERATED FROM PYTHON SOURCE LINES 116-129

.. code-block:: default

    photo_texture_layer = napari.layers.Surface(
        (vertices, faces),
        texture=photo_texture,
        texcoords=texcoords,
        name="Texture_0",
    )
    generated_texture_layer = napari.layers.Surface(
        (vertices, faces),
        texture=generated_texture,
        texcoords=texcoords,
        name="GeneratedMat2",
    )








.. GENERATED FROM PYTHON SOURCE LINES 130-134

Add the layers to a viewer
--------------------------
Finally, create the viewer and add the Surface layers.
sphinx_gallery_thumbnail_number = 2

.. GENERATED FROM PYTHON SOURCE LINES 134-144

.. code-block:: default

    viewer = napari.Viewer(ndisplay=3)

    viewer.add_layer(photo_texture_layer)
    viewer.add_layer(generated_texture_layer)

    viewer.camera.angles = (90.0, 0.0, -75.0)
    viewer.camera.zoom = 75

    if __name__ == '__main__':
        napari.run()



.. image-sg:: /gallery/images/sphx_glr_surface_multi_texture_002.png
   :alt: surface multi texture
   :srcset: /gallery/images/sphx_glr_surface_multi_texture_002.png
   :class: sphx-glr-single-img






.. rst-class:: sphx-glr-timing

   **Total running time of the script:** ( 0 minutes  48.241 seconds)


.. _sphx_glr_download_gallery_surface_multi_texture.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example




    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: surface_multi_texture.py <surface_multi_texture.py>`

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: surface_multi_texture.ipynb <surface_multi_texture.ipynb>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
