{"pageProps":{"state":{"globalHeaders":{"https://napari-hub.org":{"level":1,"children":[],"href":"https://napari-hub.org","text":"napari hub"},"https://github.com/napari/napari":{"level":1,"children":[],"href":"https://github.com/napari/napari","text":"napari source code"},"/developers/index.html":{"level":1,"children":["/developers/benchmarks.html","/developers/contributing.html","/developers/core_dev_guide.html","/developers/profiling.html","/developers/release.html","/developers/testing.html","/developers/docs.html"],"href":"/developers/index.html","text":"Developer resources"},"/developers/docs.html":{"level":2,"children":[],"href":"/developers/docs.html","text":"Organization of Documentation for napari"},"/developers/testing.html":{"level":2,"children":[],"href":"/developers/testing.html","text":"Testing"},"/developers/release.html":{"level":2,"children":[],"href":"/developers/release.html","text":"Release Guide"},"/developers/profiling.html":{"level":2,"children":[],"href":"/developers/profiling.html","text":"Profiling"},"/developers/core_dev_guide.html":{"level":2,"children":[],"href":"/developers/core_dev_guide.html","text":"Core Developer Guide"},"/developers/contributing.html":{"level":2,"children":[],"href":"/developers/contributing.html","text":"Contributing Guide"},"/developers/benchmarks.html":{"level":2,"children":[],"href":"/developers/benchmarks.html","text":"Benchmarks"},"/guides/stable/index.html":{"level":1,"children":["/guides/stable/event_loop.html","/guides/stable/threading.html","/guides/stable/perfmon.html","/guides/stable/rendering.html","/guides/stable/docker.html","/guides/stable/performance.html","/guides/stable/magicgui.html","/guides/stable/translations.html","/guides/stable/rendering-explanation.html","/guides/stable/connecting_events.html","/guides/stable/3D_interactivity.html","/guides/stable/events_reference.html"],"href":"/guides/stable/index.html","text":"Developer guides"},"/guides/stable/events_reference.html":{"level":2,"children":[],"href":"/guides/stable/events_reference.html","text":"Events Reference"},"/guides/stable/3D_interactivity.html":{"level":2,"children":[],"href":"/guides/stable/3D_interactivity.html","text":"3D interactivity"},"/guides/stable/connecting_events.html":{"level":2,"children":[],"href":"/guides/stable/connecting_events.html","text":"Hooking up your own events"},"/guides/stable/rendering-explanation.html":{"level":2,"children":[],"href":"/guides/stable/rendering-explanation.html","text":"Rendering in napari"},"/guides/stable/translations.html":{"level":2,"children":[],"href":"/guides/stable/translations.html","text":"Translations"},"/guides/stable/magicgui.html":{"level":2,"children":[],"href":"/guides/stable/magicgui.html","text":"Using magicgui in napari"},"/guides/stable/performance.html":{"level":2,"children":[],"href":"/guides/stable/performance.html","text":"Napari Performance"},"/guides/stable/docker.html":{"level":2,"children":[],"href":"/guides/stable/docker.html","text":"Napari in Docker (WIP)"},"/guides/stable/rendering.html":{"level":2,"children":[],"href":"/guides/stable/rendering.html","text":"Asynchronous Rendering"},"/guides/stable/perfmon.html":{"level":2,"children":[],"href":"/guides/stable/perfmon.html","text":"Performance Monitoring"},"/guides/stable/threading.html":{"level":2,"children":[],"href":"/guides/stable/threading.html","text":"Multithreading in napari"},"/guides/stable/event_loop.html":{"level":2,"children":[],"href":"/guides/stable/event_loop.html","text":"An Introduction to the Event Loop in napari"},"/roadmaps/index.html":{"level":1,"children":["/roadmaps/0_4.html","/roadmaps/0_3_retrospective.html","/roadmaps/0_3.html"],"href":"/roadmaps/index.html","text":"Roadmaps"},"/roadmaps/0_3.html":{"level":2,"children":[],"href":"/roadmaps/0_3.html","text":"Roadmap 0.3"},"/roadmaps/0_3_retrospective.html":{"level":2,"children":[],"href":"/roadmaps/0_3_retrospective.html","text":"Roadmap 0.3 Retrospective"},"/roadmaps/0_4.html":{"level":2,"children":[],"href":"/roadmaps/0_4.html","text":"Roadmap 0.4"},"/api/stable/index.html":{"level":1,"children":["/api/stable/napari.layers.html","/api/stable/napari.view_layers.html","/api/stable/napari.types.html","/api/stable/napari.utils.html","/api/stable/napari.plugins.html","/api/stable/napari.components.html","/api/stable/napari.qt.threading.html","/api/stable/napari.utils.perf.html","/api/stable/napari.html"],"href":"/api/stable/index.html","text":"API reference"},"/api/stable/napari.html":{"level":2,"children":["/api/stable/napari.Viewer.html"],"href":"/api/stable/napari.html","text":"napari"},"/api/stable/napari.Viewer.html":{"level":3,"children":[],"href":"/api/stable/napari.Viewer.html","text":"napari.Viewer"},"/api/stable/napari.utils.perf.html":{"level":2,"children":["/api/stable/napari.utils.perf.PerfEvent.html"],"href":"/api/stable/napari.utils.perf.html","text":"napari.utils.perf"},"/api/stable/napari.utils.perf.PerfEvent.html":{"level":3,"children":[],"href":"/api/stable/napari.utils.perf.PerfEvent.html","text":"napari.utils.perf.PerfEvent"},"/api/stable/napari.qt.threading.html":{"level":2,"children":["/api/stable/napari.qt.threading.FunctionWorker.html","/api/stable/napari.qt.threading.GeneratorWorker.html","/api/stable/napari.qt.threading.GeneratorWorkerSignals.html","/api/stable/napari.qt.threading.WorkerBase.html","/api/stable/napari.qt.threading.WorkerBaseSignals.html"],"href":"/api/stable/napari.qt.threading.html","text":"napari.qt.threading"},"/api/stable/napari.qt.threading.WorkerBaseSignals.html":{"level":3,"children":[],"href":"/api/stable/napari.qt.threading.WorkerBaseSignals.html","text":"napari.qt.threading.WorkerBaseSignals"},"/api/stable/napari.qt.threading.WorkerBase.html":{"level":3,"children":[],"href":"/api/stable/napari.qt.threading.WorkerBase.html","text":"napari.qt.threading.WorkerBase"},"/api/stable/napari.qt.threading.GeneratorWorkerSignals.html":{"level":3,"children":[],"href":"/api/stable/napari.qt.threading.GeneratorWorkerSignals.html","text":"napari.qt.threading.GeneratorWorkerSignals"},"/api/stable/napari.qt.threading.GeneratorWorker.html":{"level":3,"children":[],"href":"/api/stable/napari.qt.threading.GeneratorWorker.html","text":"napari.qt.threading.GeneratorWorker"},"/api/stable/napari.qt.threading.FunctionWorker.html":{"level":3,"children":[],"href":"/api/stable/napari.qt.threading.FunctionWorker.html","text":"napari.qt.threading.FunctionWorker"},"/api/stable/napari.components.html":{"level":2,"children":["/api/stable/napari.components.Camera.html","/api/stable/napari.components.Dims.html","/api/stable/napari.components.LayerList.html","/api/stable/napari.components.ViewerModel.html"],"href":"/api/stable/napari.components.html","text":"napari.components"},"/api/stable/napari.components.ViewerModel.html":{"level":3,"children":[],"href":"/api/stable/napari.components.ViewerModel.html","text":"napari.components.ViewerModel"},"/api/stable/napari.components.LayerList.html":{"level":3,"children":[],"href":"/api/stable/napari.components.LayerList.html","text":"napari.components.LayerList"},"/api/stable/napari.components.Dims.html":{"level":3,"children":[],"href":"/api/stable/napari.components.Dims.html","text":"napari.components.Dims"},"/api/stable/napari.components.Camera.html":{"level":3,"children":[],"href":"/api/stable/napari.components.Camera.html","text":"napari.components.Camera"},"/api/stable/napari.plugins.html":{"level":2,"children":["/api/stable/napari.plugins.NapariPluginManager.html"],"href":"/api/stable/napari.plugins.html","text":"napari.plugins"},"/api/stable/napari.plugins.NapariPluginManager.html":{"level":3,"children":[],"href":"/api/stable/napari.plugins.NapariPluginManager.html","text":"napari.plugins.NapariPluginManager"},"/api/stable/napari.utils.html":{"level":2,"children":["/api/stable/napari.utils.Colormap.html","/api/stable/napari.utils.nbscreenshot.html","/api/stable/napari.utils.progress.html"],"href":"/api/stable/napari.utils.html","text":"napari.utils"},"/api/stable/napari.utils.progress.html":{"level":3,"children":[],"href":"/api/stable/napari.utils.progress.html","text":"napari.utils.progress"},"/api/stable/napari.utils.nbscreenshot.html":{"level":3,"children":[],"href":"/api/stable/napari.utils.nbscreenshot.html","text":"napari.utils.nbscreenshot"},"/api/stable/napari.utils.Colormap.html":{"level":3,"children":[],"href":"/api/stable/napari.utils.Colormap.html","text":"napari.utils.Colormap"},"/api/stable/napari.types.html":{"level":2,"children":["/api/stable/napari.types.ArrayBase.html","/api/stable/napari.types.Path.html","/api/stable/napari.types.SampleDict.html","/api/stable/napari.types.TracebackType.html","/api/stable/napari.types.TypedDict.html","/api/stable/napari.types.partial.html"],"href":"/api/stable/napari.types.html","text":"napari.types"},"/api/stable/napari.types.partial.html":{"level":3,"children":[],"href":"/api/stable/napari.types.partial.html","text":"napari.types.partial"},"/api/stable/napari.types.TypedDict.html":{"level":3,"children":[],"href":"/api/stable/napari.types.TypedDict.html","text":"napari.types.TypedDict"},"/api/stable/napari.types.TracebackType.html":{"level":3,"children":[],"href":"/api/stable/napari.types.TracebackType.html","text":"napari.types.TracebackType"},"/api/stable/napari.types.SampleDict.html":{"level":3,"children":[],"href":"/api/stable/napari.types.SampleDict.html","text":"napari.types.SampleDict"},"/api/stable/napari.types.Path.html":{"level":3,"children":[],"href":"/api/stable/napari.types.Path.html","text":"napari.types.Path"},"/api/stable/napari.types.ArrayBase.html":{"level":3,"children":[],"href":"/api/stable/napari.types.ArrayBase.html","text":"napari.types.ArrayBase"},"/api/stable/napari.view_layers.html":{"level":2,"children":["/api/stable/napari.view_layers.Viewer.html"],"href":"/api/stable/napari.view_layers.html","text":"napari.view_layers"},"/api/stable/napari.view_layers.Viewer.html":{"level":3,"children":[],"href":"/api/stable/napari.view_layers.Viewer.html","text":"napari.view_layers.Viewer"},"/api/stable/napari.layers.html":{"level":2,"children":["/api/stable/napari.layers.Image.html","/api/stable/napari.layers.Labels.html","/api/stable/napari.layers.Layer.html","/api/stable/napari.layers.Points.html","/api/stable/napari.layers.Shapes.html","/api/stable/napari.layers.Surface.html","/api/stable/napari.layers.Tracks.html","/api/stable/napari.layers.Vectors.html"],"href":"/api/stable/napari.layers.html","text":"napari.layers"},"/api/stable/napari.layers.Vectors.html":{"level":3,"children":[],"href":"/api/stable/napari.layers.Vectors.html","text":"napari.layers.Vectors"},"/api/stable/napari.layers.Tracks.html":{"level":3,"children":[],"href":"/api/stable/napari.layers.Tracks.html","text":"napari.layers.Tracks"},"/api/stable/napari.layers.Surface.html":{"level":3,"children":[],"href":"/api/stable/napari.layers.Surface.html","text":"napari.layers.Surface"},"/api/stable/napari.layers.Shapes.html":{"level":3,"children":[],"href":"/api/stable/napari.layers.Shapes.html","text":"napari.layers.Shapes"},"/api/stable/napari.layers.Points.html":{"level":3,"children":[],"href":"/api/stable/napari.layers.Points.html","text":"napari.layers.Points"},"/api/stable/napari.layers.Layer.html":{"level":3,"children":[],"href":"/api/stable/napari.layers.Layer.html","text":"napari.layers.Layer"},"/api/stable/napari.layers.Labels.html":{"level":3,"children":[],"href":"/api/stable/napari.layers.Labels.html","text":"napari.layers.Labels"},"/api/stable/napari.layers.Image.html":{"level":3,"children":[],"href":"/api/stable/napari.layers.Image.html","text":"napari.layers.Image"},"/release/index.html":{"level":1,"children":["/release/release_0_4_12.html","/release/release_0_4_11.html","/release/release_0_4_10.html","/release/release_0_4_9.html","/release/release_0_4_8.html","/release/release_0_4_7.html","/release/release_0_4_6.html","/release/release_0_4_5.html","/release/release_0_4_4.html","/release/release_0_4_3.html","/release/release_0_4_2.html","/release/release_0_4_1.html","/release/release_0_4_0.html","/release/release_0_3_8.html","/release/release_0_3_7.html","/release/release_0_3_6.html","/release/release_0_3_5.html","/release/release_0_3_4.html","/release/release_0_3_3.html","/release/release_0_3_2.html","/release/release_0_3_1.html","/release/release_0_3_0.html","/release/release_0_2_12.html","/release/release_0_2_11.html","/release/release_0_2_10.html","/release/release_0_2_9.html","/release/release_0_2_8.html","/release/release_0_2_7.html","/release/release_0_2_6.html","/release/release_0_2_5.html","/release/release_0_2_4.html","/release/release_0_2_3.html","/release/release_0_2_1.html","/release/release_0_2_0.html","/release/release_0_1_5.html","/release/release_0_1_3.html","/release/release_0_1_0.html"],"href":"/release/index.html","text":"Release notes"},"/release/release_0_1_0.html":{"level":2,"children":[],"href":"/release/release_0_1_0.html","text":"napari 0.1.0"},"/release/release_0_1_3.html":{"level":2,"children":[],"href":"/release/release_0_1_3.html","text":"napari 0.1.3"},"/release/release_0_1_5.html":{"level":2,"children":[],"href":"/release/release_0_1_5.html","text":"napari 0.1.5"},"/release/release_0_2_0.html":{"level":2,"children":[],"href":"/release/release_0_2_0.html","text":"napari 0.2.0"},"/release/release_0_2_1.html":{"level":2,"children":[],"href":"/release/release_0_2_1.html","text":"napari 0.2.1"},"/release/release_0_2_3.html":{"level":2,"children":[],"href":"/release/release_0_2_3.html","text":"napari 0.2.3"},"/release/release_0_2_4.html":{"level":2,"children":[],"href":"/release/release_0_2_4.html","text":"napari 0.2.4"},"/release/release_0_2_5.html":{"level":2,"children":[],"href":"/release/release_0_2_5.html","text":"napari 0.2.5"},"/release/release_0_2_6.html":{"level":2,"children":[],"href":"/release/release_0_2_6.html","text":"napari 0.2.6"},"/release/release_0_2_7.html":{"level":2,"children":[],"href":"/release/release_0_2_7.html","text":"napari 0.2.7"},"/release/release_0_2_8.html":{"level":2,"children":[],"href":"/release/release_0_2_8.html","text":"napari 0.2.8"},"/release/release_0_2_9.html":{"level":2,"children":[],"href":"/release/release_0_2_9.html","text":"napari 0.2.9"},"/release/release_0_2_10.html":{"level":2,"children":[],"href":"/release/release_0_2_10.html","text":"napari 0.2.10"},"/release/release_0_2_11.html":{"level":2,"children":[],"href":"/release/release_0_2_11.html","text":"napari 0.2.11"},"/release/release_0_2_12.html":{"level":2,"children":[],"href":"/release/release_0_2_12.html","text":"napari 0.2.12"},"/release/release_0_3_0.html":{"level":2,"children":[],"href":"/release/release_0_3_0.html","text":"napari 0.3.0"},"/release/release_0_3_1.html":{"level":2,"children":[],"href":"/release/release_0_3_1.html","text":"napari 0.3.1"},"/release/release_0_3_2.html":{"level":2,"children":[],"href":"/release/release_0_3_2.html","text":"napari 0.3.2"},"/release/release_0_3_3.html":{"level":2,"children":[],"href":"/release/release_0_3_3.html","text":"napari 0.3.3"},"/release/release_0_3_4.html":{"level":2,"children":[],"href":"/release/release_0_3_4.html","text":"napari 0.3.4"},"/release/release_0_3_5.html":{"level":2,"children":[],"href":"/release/release_0_3_5.html","text":"napari 0.3.5"},"/release/release_0_3_6.html":{"level":2,"children":[],"href":"/release/release_0_3_6.html","text":"napari 0.3.6"},"/release/release_0_3_7.html":{"level":2,"children":[],"href":"/release/release_0_3_7.html","text":"napari 0.3.7"},"/release/release_0_3_8.html":{"level":2,"children":[],"href":"/release/release_0_3_8.html","text":"napari 0.3.8"},"/release/release_0_4_0.html":{"level":2,"children":[],"href":"/release/release_0_4_0.html","text":"napari 0.4.0"},"/release/release_0_4_1.html":{"level":2,"children":[],"href":"/release/release_0_4_1.html","text":"napari 0.4.1"},"/release/release_0_4_2.html":{"level":2,"children":[],"href":"/release/release_0_4_2.html","text":"napari 0.4.2"},"/release/release_0_4_3.html":{"level":2,"children":[],"href":"/release/release_0_4_3.html","text":"napari 0.4.3"},"/release/release_0_4_4.html":{"level":2,"children":[],"href":"/release/release_0_4_4.html","text":"napari 0.4.4"},"/release/release_0_4_5.html":{"level":2,"children":[],"href":"/release/release_0_4_5.html","text":"napari 0.4.5"},"/release/release_0_4_6.html":{"level":2,"children":[],"href":"/release/release_0_4_6.html","text":"napari 0.4.6"},"/release/release_0_4_7.html":{"level":2,"children":[],"href":"/release/release_0_4_7.html","text":"napari 0.4.7"},"/release/release_0_4_8.html":{"level":2,"children":[],"href":"/release/release_0_4_8.html","text":"napari 0.4.8"},"/release/release_0_4_9.html":{"level":2,"children":[],"href":"/release/release_0_4_9.html","text":"napari 0.4.9"},"/release/release_0_4_10.html":{"level":2,"children":[],"href":"/release/release_0_4_10.html","text":"napari 0.4.10"},"/release/release_0_4_11.html":{"level":2,"children":[],"href":"/release/release_0_4_11.html","text":"napari 0.4.11"},"/release/release_0_4_12.html":{"level":2,"children":[],"href":"/release/release_0_4_12.html","text":"napari 0.4.12"},"/plugins/stable/index.html":{"level":1,"children":["/plugins/stable/for_napari_developers.html","/plugins/stable/for_plugin_developers.html","/plugins/stable/hook_specifications.html","/plugins/stable/find-and-install-plugin.html"],"href":"/plugins/stable/index.html","text":"Plugins"},"/plugins/stable/find-and-install-plugin.html":{"level":2,"children":[],"href":"/plugins/stable/find-and-install-plugin.html","text":"Finding and installing a napari plugin"},"/plugins/stable/hook_specifications.html":{"level":2,"children":[],"href":"/plugins/stable/hook_specifications.html","text":"napari hook specification reference"},"/plugins/stable/for_plugin_developers.html":{"level":2,"children":[],"href":"/plugins/stable/for_plugin_developers.html","text":"creating a napari plugin"},"/plugins/stable/for_napari_developers.html":{"level":2,"children":[],"href":"/plugins/stable/for_napari_developers.html","text":"napari plugin architecture"},"/tutorials/index.html":{"level":1,"children":["/tutorials/fundamentals/index.html","/tutorials/applications/index.html","/tutorials/further-resources/napari-workshops.html"],"href":"/tutorials/index.html","text":"Tutorials"},"/tutorials/further-resources/napari-workshops.html":{"level":2,"children":[],"href":"/tutorials/further-resources/napari-workshops.html","text":"napari workshops"},"/tutorials/applications/index.html":{"level":2,"children":["/tutorials/applications/annotate_segmentation.html","/tutorials/applications/annotate_points.html","/tutorials/applications/dask.html","/tutorials/applications/napari_imageJ.html","/tutorials/applications/cell_tracking.html"],"href":"/tutorials/applications/index.html","text":"Applications"},"/tutorials/applications/cell_tracking.html":{"level":3,"children":[],"href":"/tutorials/applications/cell_tracking.html","text":"single cell tracking with napari"},"/tutorials/applications/napari_imageJ.html":{"level":3,"children":[],"href":"/tutorials/applications/napari_imageJ.html","text":"Napari + ImageJ How-to-Guide"},"/tutorials/applications/dask.html":{"level":3,"children":[],"href":"/tutorials/applications/dask.html","text":"using dask and napari to process & view large datasets"},"/tutorials/applications/annotate_points.html":{"level":3,"children":[],"href":"/tutorials/applications/annotate_points.html","text":"annotating videos with napari"},"/tutorials/applications/annotate_segmentation.html":{"level":3,"children":[],"href":"/tutorials/applications/annotate_segmentation.html","text":"annotating segmentation with text and bounding boxes"},"/tutorials/fundamentals/index.html":{"level":2,"children":["/tutorials/fundamentals/installation.html","/tutorials/fundamentals/getting_started.html","/tutorials/fundamentals/viewer.html","/tutorials/fundamentals/image.html","/tutorials/fundamentals/labels.html","/tutorials/fundamentals/points.html","/tutorials/fundamentals/shapes.html","/tutorials/fundamentals/surface.html","/tutorials/fundamentals/tracks.html","/tutorials/fundamentals/vectors.html"],"href":"/tutorials/fundamentals/index.html","text":"Fundamentals"},"/tutorials/fundamentals/vectors.html":{"level":3,"children":[],"href":"/tutorials/fundamentals/vectors.html","text":"vectors layer tutorial"},"/tutorials/fundamentals/tracks.html":{"level":3,"children":[],"href":"/tutorials/fundamentals/tracks.html","text":"tracks layer tutorial"},"/tutorials/fundamentals/surface.html":{"level":3,"children":[],"href":"/tutorials/fundamentals/surface.html","text":"surface layer tutorial"},"/tutorials/fundamentals/shapes.html":{"level":3,"children":[],"href":"/tutorials/fundamentals/shapes.html","text":"shapes layer tutorial"},"/tutorials/fundamentals/points.html":{"level":3,"children":[],"href":"/tutorials/fundamentals/points.html","text":"points layer tutorial"},"/tutorials/fundamentals/labels.html":{"level":3,"children":[],"href":"/tutorials/fundamentals/labels.html","text":"labels layer tutorial"},"/tutorials/fundamentals/image.html":{"level":3,"children":[],"href":"/tutorials/fundamentals/image.html","text":"image layer tutorial"},"/tutorials/fundamentals/viewer.html":{"level":3,"children":[],"href":"/tutorials/fundamentals/viewer.html","text":"napari viewer tutorial"},"/tutorials/fundamentals/getting_started.html":{"level":3,"children":[],"href":"/tutorials/fundamentals/getting_started.html","text":"getting started with napari"},"/tutorials/fundamentals/installation.html":{"level":3,"children":[],"href":"/tutorials/fundamentals/installation.html","text":"napari installation tutorial"},"/community/index.html":{"level":1,"children":["/community/mission_and_values.html","/community/team.html","/community/code_of_conduct.html","/community/code_of_conduct_reporting.html","/community/governance.html"],"href":"/community/index.html","text":"Community"},"/community/governance.html":{"level":2,"children":[],"href":"/community/governance.html","text":"Governance Model"},"/community/code_of_conduct_reporting.html":{"level":2,"children":[],"href":"/community/code_of_conduct_reporting.html","text":"Handling Code of Conduct Reports"},"/community/code_of_conduct.html":{"level":2,"children":[],"href":"/community/code_of_conduct.html","text":"Code of Conduct"},"/community/team.html":{"level":2,"children":[],"href":"/community/team.html","text":"About the Project and Team"},"/community/mission_and_values.html":{"level":2,"children":[],"href":"/community/mission_and_values.html","text":"Mission and Values"}},"rootGlobalHeaders":["/community/index.html","/tutorials/index.html","/plugins/stable/index.html","/release/index.html","/api/stable/index.html","/roadmaps/index.html","/guides/stable/index.html","/developers/index.html","https://github.com/napari/napari","https://napari-hub.org"],"pageTitle":"Source code for napari.layers.shapes.shapes","pageFrontMatter":{},"appScripts":[{"src":"/_static/documentation_options.js"},{"src":"/_static/jquery.js"},{"src":"/_static/underscore.js"},{"src":"/_static/doctools.js"},{"src":"/_static/togglebutton.js"},{"src":"/_static/clipboard.min.js"},{"src":"/_static/copybutton.js"},{"children":"var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';"}],"appStyleSheets":[{"href":"/_static/pygments.css","rel":"stylesheet"},{"href":"/_static/togglebutton.css","rel":"stylesheet","type":"text/css"},{"href":"/_static/copybutton.css","rel":"stylesheet","type":"text/css"},{"href":"/_static/mystnb.css","rel":"stylesheet","type":"text/css"},{"href":"/_static/sphinx-thebe.css","rel":"stylesheet","type":"text/css"},{"href":"/_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css","rel":"stylesheet","type":"text/css"},{"href":"/_static/panels-variables.06eb56fa6e07937060861dad626602ad.css","rel":"stylesheet","type":"text/css"}],"pageBodyHtml":"\n        <div id=\"documentation_options\" data-url_root=\"../../../../\"></div>\n        <div class=\"highlight\"><pre><span></span><span class=\"kn\">import</span> <span class=\"nn\">warnings</span>\n<span class=\"kn\">from</span> <span class=\"nn\">contextlib</span> <span class=\"kn\">import</span> <span class=\"n\">contextmanager</span>\n<span class=\"kn\">from</span> <span class=\"nn\">copy</span> <span class=\"kn\">import</span> <span class=\"n\">copy</span><span class=\"p\">,</span> <span class=\"n\">deepcopy</span>\n<span class=\"kn\">from</span> <span class=\"nn\">itertools</span> <span class=\"kn\">import</span> <span class=\"n\">cycle</span>\n<span class=\"kn\">from</span> <span class=\"nn\">typing</span> <span class=\"kn\">import</span> <span class=\"n\">Dict</span><span class=\"p\">,</span> <span class=\"n\">List</span><span class=\"p\">,</span> <span class=\"n\">Tuple</span><span class=\"p\">,</span> <span class=\"n\">Union</span>\n\n<span class=\"kn\">import</span> <span class=\"nn\">numpy</span> <span class=\"k\">as</span> <span class=\"nn\">np</span>\n<span class=\"kn\">from</span> <span class=\"nn\">vispy.color</span> <span class=\"kn\">import</span> <span class=\"n\">get_color_names</span>\n\n<span class=\"kn\">from</span> <span class=\"nn\">...utils.colormaps</span> <span class=\"kn\">import</span> <span class=\"n\">Colormap</span><span class=\"p\">,</span> <span class=\"n\">ValidColormapArg</span><span class=\"p\">,</span> <span class=\"n\">ensure_colormap</span>\n<span class=\"kn\">from</span> <span class=\"nn\">...utils.colormaps.standardize_color</span> <span class=\"kn\">import</span> <span class=\"p\">(</span>\n    <span class=\"n\">hex_to_name</span><span class=\"p\">,</span>\n    <span class=\"n\">rgb_to_hex</span><span class=\"p\">,</span>\n    <span class=\"n\">transform_color</span><span class=\"p\">,</span>\n<span class=\"p\">)</span>\n<span class=\"kn\">from</span> <span class=\"nn\">...utils.events</span> <span class=\"kn\">import</span> <span class=\"n\">Event</span>\n<span class=\"kn\">from</span> <span class=\"nn\">...utils.events.custom_types</span> <span class=\"kn\">import</span> <span class=\"n\">Array</span>\n<span class=\"kn\">from</span> <span class=\"nn\">...utils.misc</span> <span class=\"kn\">import</span> <span class=\"n\">ensure_iterable</span>\n<span class=\"kn\">from</span> <span class=\"nn\">...utils.translations</span> <span class=\"kn\">import</span> <span class=\"n\">trans</span>\n<span class=\"kn\">from</span> <span class=\"nn\">..base</span> <span class=\"kn\">import</span> <span class=\"n\">Layer</span><span class=\"p\">,</span> <span class=\"n\">no_op</span>\n<span class=\"kn\">from</span> <span class=\"nn\">..utils.color_manager_utils</span> <span class=\"kn\">import</span> <span class=\"n\">guess_continuous</span><span class=\"p\">,</span> <span class=\"n\">map_property</span>\n<span class=\"kn\">from</span> <span class=\"nn\">..utils.color_transformations</span> <span class=\"kn\">import</span> <span class=\"p\">(</span>\n    <span class=\"n\">ColorType</span><span class=\"p\">,</span>\n    <span class=\"n\">normalize_and_broadcast_colors</span><span class=\"p\">,</span>\n    <span class=\"n\">transform_color_cycle</span><span class=\"p\">,</span>\n    <span class=\"n\">transform_color_with_defaults</span><span class=\"p\">,</span>\n<span class=\"p\">)</span>\n<span class=\"kn\">from</span> <span class=\"nn\">..utils.layer_utils</span> <span class=\"kn\">import</span> <span class=\"p\">(</span>\n    <span class=\"n\">coerce_current_properties</span><span class=\"p\">,</span>\n    <span class=\"n\">get_current_properties</span><span class=\"p\">,</span>\n    <span class=\"n\">prepare_properties</span><span class=\"p\">,</span>\n<span class=\"p\">)</span>\n<span class=\"kn\">from</span> <span class=\"nn\">..utils.text_manager</span> <span class=\"kn\">import</span> <span class=\"n\">TextManager</span>\n<span class=\"kn\">from</span> <span class=\"nn\">._shape_list</span> <span class=\"kn\">import</span> <span class=\"n\">ShapeList</span>\n<span class=\"kn\">from</span> <span class=\"nn\">._shapes_constants</span> <span class=\"kn\">import</span> <span class=\"p\">(</span>\n    <span class=\"n\">BACKSPACE</span><span class=\"p\">,</span>\n    <span class=\"n\">Box</span><span class=\"p\">,</span>\n    <span class=\"n\">ColorMode</span><span class=\"p\">,</span>\n    <span class=\"n\">Mode</span><span class=\"p\">,</span>\n    <span class=\"n\">ShapeType</span><span class=\"p\">,</span>\n    <span class=\"n\">shape_classes</span><span class=\"p\">,</span>\n<span class=\"p\">)</span>\n<span class=\"kn\">from</span> <span class=\"nn\">._shapes_mouse_bindings</span> <span class=\"kn\">import</span> <span class=\"p\">(</span>\n    <span class=\"n\">add_ellipse</span><span class=\"p\">,</span>\n    <span class=\"n\">add_line</span><span class=\"p\">,</span>\n    <span class=\"n\">add_path_polygon</span><span class=\"p\">,</span>\n    <span class=\"n\">add_path_polygon_creating</span><span class=\"p\">,</span>\n    <span class=\"n\">add_rectangle</span><span class=\"p\">,</span>\n    <span class=\"n\">finish_drawing_shape</span><span class=\"p\">,</span>\n    <span class=\"n\">highlight</span><span class=\"p\">,</span>\n    <span class=\"n\">select</span><span class=\"p\">,</span>\n    <span class=\"n\">vertex_insert</span><span class=\"p\">,</span>\n    <span class=\"n\">vertex_remove</span><span class=\"p\">,</span>\n<span class=\"p\">)</span>\n<span class=\"kn\">from</span> <span class=\"nn\">._shapes_utils</span> <span class=\"kn\">import</span> <span class=\"p\">(</span>\n    <span class=\"n\">create_box</span><span class=\"p\">,</span>\n    <span class=\"n\">extract_shape_type</span><span class=\"p\">,</span>\n    <span class=\"n\">get_default_shape_type</span><span class=\"p\">,</span>\n    <span class=\"n\">get_shape_ndim</span><span class=\"p\">,</span>\n    <span class=\"n\">number_of_shapes</span><span class=\"p\">,</span>\n    <span class=\"n\">validate_num_vertices</span><span class=\"p\">,</span>\n<span class=\"p\">)</span>\n\n<span class=\"n\">DEFAULT_COLOR_CYCLE</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">array</span><span class=\"p\">([[</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">],</span> <span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">]])</span>\n\n\n<span class=\"n\">_REV_SHAPE_HELP</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n    <span class=\"n\">trans</span><span class=\"o\">.</span><span class=\"n\">_</span><span class=\"p\">(</span><span class=\"s1\">'hold &lt;space&gt; to pan/zoom'</span><span class=\"p\">):</span> <span class=\"p\">{</span>\n        <span class=\"n\">Mode</span><span class=\"o\">.</span><span class=\"n\">VERTEX_INSERT</span><span class=\"p\">,</span>\n        <span class=\"n\">Mode</span><span class=\"o\">.</span><span class=\"n\">VERTEX_REMOVE</span><span class=\"p\">,</span>\n        <span class=\"n\">Mode</span><span class=\"o\">.</span><span class=\"n\">ADD_RECTANGLE</span><span class=\"p\">,</span>\n        <span class=\"n\">Mode</span><span class=\"o\">.</span><span class=\"n\">ADD_ELLIPSE</span><span class=\"p\">,</span>\n        <span class=\"n\">Mode</span><span class=\"o\">.</span><span class=\"n\">ADD_LINE</span><span class=\"p\">,</span>\n    <span class=\"p\">},</span>\n    <span class=\"n\">trans</span><span class=\"o\">.</span><span class=\"n\">_</span><span class=\"p\">(</span>\n        <span class=\"s1\">'hold &lt;space&gt; to pan/zoom, press &lt;esc&gt;, or double click to finish drawing'</span>\n    <span class=\"p\">):</span> <span class=\"p\">{</span>\n        <span class=\"n\">Mode</span><span class=\"o\">.</span><span class=\"n\">ADD_PATH</span><span class=\"p\">,</span>\n        <span class=\"n\">Mode</span><span class=\"o\">.</span><span class=\"n\">ADD_POLYGON</span><span class=\"p\">,</span>\n    <span class=\"p\">},</span>\n    <span class=\"n\">trans</span><span class=\"o\">.</span><span class=\"n\">_</span><span class=\"p\">(</span>\n        <span class=\"s1\">'hold &lt;space&gt; to pan/zoom, press &lt;</span><span class=\"si\">{BACKSPACE}</span><span class=\"s1\">&gt; to remove selected'</span><span class=\"p\">,</span>\n        <span class=\"n\">BACKSPACE</span><span class=\"o\">=</span><span class=\"n\">BACKSPACE</span><span class=\"p\">,</span>\n    <span class=\"p\">):</span> <span class=\"p\">{</span><span class=\"n\">Mode</span><span class=\"o\">.</span><span class=\"n\">SELECT</span><span class=\"p\">,</span> <span class=\"n\">Mode</span><span class=\"o\">.</span><span class=\"n\">DIRECT</span><span class=\"p\">},</span>\n    <span class=\"n\">trans</span><span class=\"o\">.</span><span class=\"n\">_</span><span class=\"p\">(</span><span class=\"s1\">'enter a selection mode to edit shape properties'</span><span class=\"p\">):</span> <span class=\"p\">{</span>\n        <span class=\"n\">Mode</span><span class=\"o\">.</span><span class=\"n\">PAN_ZOOM</span>\n    <span class=\"p\">},</span>\n<span class=\"p\">}</span>\n\n\n<span class=\"c1\"># This avoid duplicating the trans._ help messages above</span>\n<span class=\"c1\"># as some modes have the same help.</span>\n<span class=\"c1\"># while most tooling will recognise identical messages,</span>\n<span class=\"c1\"># this can lead to human error.</span>\n<span class=\"n\">_FWD_SHAPE_HELP</span> <span class=\"o\">=</span> <span class=\"p\">{}</span>\n<span class=\"k\">for</span> <span class=\"n\">t</span><span class=\"p\">,</span> <span class=\"n\">modes</span> <span class=\"ow\">in</span> <span class=\"n\">_REV_SHAPE_HELP</span><span class=\"o\">.</span><span class=\"n\">items</span><span class=\"p\">():</span>\n    <span class=\"k\">for</span> <span class=\"n\">m</span> <span class=\"ow\">in</span> <span class=\"n\">modes</span><span class=\"p\">:</span>\n        <span class=\"n\">_FWD_SHAPE_HELP</span><span class=\"p\">[</span><span class=\"n\">m</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">t</span>\n\n\n<div class=\"viewcode-block\" id=\"Shapes\"><a class=\"viewcode-back\" href=\"../../../../api/stable/napari.layers.Shapes.html#napari.layers.Shapes\">[docs]</a><span class=\"k\">class</span> <span class=\"nc\">Shapes</span><span class=\"p\">(</span><span class=\"n\">Layer</span><span class=\"p\">):</span>\n    <span class=\"sd\">\"\"\"Shapes layer.</span>\n\n<span class=\"sd\">    Parameters</span>\n<span class=\"sd\">    ----------</span>\n<span class=\"sd\">    data : list or array</span>\n<span class=\"sd\">        List of shape data, where each element is an (N, D) array of the</span>\n<span class=\"sd\">        N vertices of a shape in D dimensions. Can be an 3-dimensional</span>\n<span class=\"sd\">        array if each shape has the same number of vertices.</span>\n<span class=\"sd\">    ndim : int</span>\n<span class=\"sd\">        Number of dimensions for shapes. When data is not None, ndim must be D.</span>\n<span class=\"sd\">        An empty shapes layer can be instantiated with arbitrary ndim.</span>\n<span class=\"sd\">    properties : dict {str: array (N,)}, DataFrame</span>\n<span class=\"sd\">        Properties for each shape. Each property should be an array of length N,</span>\n<span class=\"sd\">        where N is the number of shapes.</span>\n<span class=\"sd\">    property_choices : dict {str: array (N,)}</span>\n<span class=\"sd\">        possible values for each property.</span>\n<span class=\"sd\">    text : str, dict</span>\n<span class=\"sd\">        Text to be displayed with the shapes. If text is set to a key in properties,</span>\n<span class=\"sd\">        the value of that property will be displayed. Multiple properties can be</span>\n<span class=\"sd\">        composed using f-string-like syntax (e.g., '{property_1}, {float_property:.2f}).</span>\n<span class=\"sd\">        A dictionary can be provided with keyword arguments to set the text values</span>\n<span class=\"sd\">        and display properties. See TextManager.__init__() for the valid keyword arguments.</span>\n<span class=\"sd\">        For example usage, see /napari/examples/add_shapes_with_text.py.</span>\n<span class=\"sd\">    shape_type : string or list</span>\n<span class=\"sd\">        String of shape shape_type, must be one of \"{'line', 'rectangle',</span>\n<span class=\"sd\">        'ellipse', 'path', 'polygon'}\". If a list is supplied it must be</span>\n<span class=\"sd\">        the same length as the length of `data` and each element will be</span>\n<span class=\"sd\">        applied to each shape otherwise the same value will be used for all</span>\n<span class=\"sd\">        shapes.</span>\n<span class=\"sd\">    edge_width : float or list</span>\n<span class=\"sd\">        Thickness of lines and edges. If a list is supplied it must be the</span>\n<span class=\"sd\">        same length as the length of `data` and each element will be</span>\n<span class=\"sd\">        applied to each shape otherwise the same value will be used for all</span>\n<span class=\"sd\">        shapes.</span>\n<span class=\"sd\">    edge_color : str, array-like</span>\n<span class=\"sd\">        If string can be any color name recognized by vispy or hex value if</span>\n<span class=\"sd\">        starting with `#`. If array-like must be 1-dimensional array with 3</span>\n<span class=\"sd\">        or 4 elements. If a list is supplied it must be the same length as</span>\n<span class=\"sd\">        the length of `data` and each element will be applied to each shape</span>\n<span class=\"sd\">        otherwise the same value will be used for all shapes.</span>\n<span class=\"sd\">    edge_color_cycle : np.ndarray, list</span>\n<span class=\"sd\">        Cycle of colors (provided as string name, RGB, or RGBA) to map to edge_color if a</span>\n<span class=\"sd\">        categorical attribute is used color the vectors.</span>\n<span class=\"sd\">    edge_colormap : str, napari.utils.Colormap</span>\n<span class=\"sd\">        Colormap to set edge_color if a continuous attribute is used to set face_color.</span>\n<span class=\"sd\">    edge_contrast_limits : None, (float, float)</span>\n<span class=\"sd\">        clims for mapping the property to a color map. These are the min and max value</span>\n<span class=\"sd\">        of the specified property that are mapped to 0 and 1, respectively.</span>\n<span class=\"sd\">        The default value is None. If set the none, the clims will be set to</span>\n<span class=\"sd\">        (property.min(), property.max())</span>\n<span class=\"sd\">    face_color : str, array-like</span>\n<span class=\"sd\">        If string can be any color name recognized by vispy or hex value if</span>\n<span class=\"sd\">        starting with `#`. If array-like must be 1-dimensional array with 3</span>\n<span class=\"sd\">        or 4 elements. If a list is supplied it must be the same length as</span>\n<span class=\"sd\">        the length of `data` and each element will be applied to each shape</span>\n<span class=\"sd\">        otherwise the same value will be used for all shapes.</span>\n<span class=\"sd\">    face_color_cycle : np.ndarray, list</span>\n<span class=\"sd\">        Cycle of colors (provided as string name, RGB, or RGBA) to map to face_color if a</span>\n<span class=\"sd\">        categorical attribute is used color the vectors.</span>\n<span class=\"sd\">    face_colormap : str, napari.utils.Colormap</span>\n<span class=\"sd\">        Colormap to set face_color if a continuous attribute is used to set face_color.</span>\n<span class=\"sd\">    face_contrast_limits : None, (float, float)</span>\n<span class=\"sd\">        clims for mapping the property to a color map. These are the min and max value</span>\n<span class=\"sd\">        of the specified property that are mapped to 0 and 1, respectively.</span>\n<span class=\"sd\">        The default value is None. If set the none, the clims will be set to</span>\n<span class=\"sd\">        (property.min(), property.max())</span>\n<span class=\"sd\">    z_index : int or list</span>\n<span class=\"sd\">        Specifier of z order priority. Shapes with higher z order are</span>\n<span class=\"sd\">        displayed ontop of others. If a list is supplied it must be the</span>\n<span class=\"sd\">        same length as the length of `data` and each element will be</span>\n<span class=\"sd\">        applied to each shape otherwise the same value will be used for all</span>\n<span class=\"sd\">        shapes.</span>\n<span class=\"sd\">    name : str</span>\n<span class=\"sd\">        Name of the layer.</span>\n<span class=\"sd\">    metadata : dict</span>\n<span class=\"sd\">        Layer metadata.</span>\n<span class=\"sd\">    scale : tuple of float</span>\n<span class=\"sd\">        Scale factors for the layer.</span>\n<span class=\"sd\">    translate : tuple of float</span>\n<span class=\"sd\">        Translation values for the layer.</span>\n<span class=\"sd\">    rotate : float, 3-tuple of float, or n-D array.</span>\n<span class=\"sd\">        If a float convert into a 2D rotation matrix using that value as an</span>\n<span class=\"sd\">        angle. If 3-tuple convert into a 3D rotation matrix, using a yaw,</span>\n<span class=\"sd\">        pitch, roll convention. Otherwise assume an nD rotation. Angles are</span>\n<span class=\"sd\">        assumed to be in degrees. They can be converted from radians with</span>\n<span class=\"sd\">        np.degrees if needed.</span>\n<span class=\"sd\">    shear : 1-D array or n-D array</span>\n<span class=\"sd\">        Either a vector of upper triangular values, or an nD shear matrix with</span>\n<span class=\"sd\">        ones along the main diagonal.</span>\n<span class=\"sd\">    affine : n-D array or napari.utils.transforms.Affine</span>\n<span class=\"sd\">        (N+1, N+1) affine transformation matrix in homogeneous coordinates.</span>\n<span class=\"sd\">        The first (N, N) entries correspond to a linear transform and</span>\n<span class=\"sd\">        the final column is a length N translation vector and a 1 or a napari</span>\n<span class=\"sd\">        `Affine` transform object. Applied as an extra transform on top of the</span>\n<span class=\"sd\">        provided scale, rotate, and shear values.</span>\n<span class=\"sd\">    opacity : float</span>\n<span class=\"sd\">        Opacity of the layer visual, between 0.0 and 1.0.</span>\n<span class=\"sd\">    blending : str</span>\n<span class=\"sd\">        One of a list of preset blending modes that determines how RGB and</span>\n<span class=\"sd\">        alpha values of the layer visual get mixed. Allowed values are</span>\n<span class=\"sd\">        {'opaque', 'translucent', and 'additive'}.</span>\n<span class=\"sd\">    visible : bool</span>\n<span class=\"sd\">        Whether the layer visual is currently being displayed.</span>\n<span class=\"sd\">    cache : bool</span>\n<span class=\"sd\">        Whether slices of out-of-core datasets should be cached upon retrieval.</span>\n<span class=\"sd\">        Currently, this only applies to dask arrays.</span>\n\n<span class=\"sd\">    Attributes</span>\n<span class=\"sd\">    ----------</span>\n<span class=\"sd\">    data : (N, ) list of array</span>\n<span class=\"sd\">        List of shape data, where each element is an (N, D) array of the</span>\n<span class=\"sd\">        N vertices of a shape in D dimensions.</span>\n<span class=\"sd\">    properties : dict {str: array (N,)}, DataFrame</span>\n<span class=\"sd\">        Properties for each shape. Each property should be an array of length N,</span>\n<span class=\"sd\">        where N is the number of shapes.</span>\n<span class=\"sd\">    text : str, dict</span>\n<span class=\"sd\">        Text to be displayed with the shapes. If text is set to a key in properties,</span>\n<span class=\"sd\">        the value of that property will be displayed. Multiple properties can be</span>\n<span class=\"sd\">        composed using f-string-like syntax (e.g., '{property_1}, {float_property:.2f}).</span>\n<span class=\"sd\">        For example usage, see /napari/examples/add_shapes_with_text.py.</span>\n<span class=\"sd\">    shape_type : (N, ) list of str</span>\n<span class=\"sd\">        Name of shape type for each shape.</span>\n<span class=\"sd\">    edge_color : str, array-like</span>\n<span class=\"sd\">        Color of the shape border. Numeric color values should be RGB(A).</span>\n<span class=\"sd\">    face_color : str, array-like</span>\n<span class=\"sd\">        Color of the shape face. Numeric color values should be RGB(A).</span>\n<span class=\"sd\">    edge_width : (N, ) list of float</span>\n<span class=\"sd\">        Edge width for each shape.</span>\n<span class=\"sd\">    z_index : (N, ) list of int</span>\n<span class=\"sd\">        z-index for each shape.</span>\n<span class=\"sd\">    current_edge_width : float</span>\n<span class=\"sd\">        Thickness of lines and edges of the next shape to be added or the</span>\n<span class=\"sd\">        currently selected shape.</span>\n<span class=\"sd\">    current_edge_color : str</span>\n<span class=\"sd\">        Color of the edge of the next shape to be added or the currently</span>\n<span class=\"sd\">        selected shape.</span>\n<span class=\"sd\">    current_face_color : str</span>\n<span class=\"sd\">        Color of the face of the next shape to be added or the currently</span>\n<span class=\"sd\">        selected shape.</span>\n<span class=\"sd\">    selected_data : set</span>\n<span class=\"sd\">        List of currently selected shapes.</span>\n<span class=\"sd\">    nshapes : int</span>\n<span class=\"sd\">        Total number of shapes.</span>\n<span class=\"sd\">    mode : Mode</span>\n<span class=\"sd\">        Interactive mode. The normal, default mode is PAN_ZOOM, which</span>\n<span class=\"sd\">        allows for normal interactivity with the canvas.</span>\n\n<span class=\"sd\">        The SELECT mode allows for entire shapes to be selected, moved and</span>\n<span class=\"sd\">        resized.</span>\n\n<span class=\"sd\">        The DIRECT mode allows for shapes to be selected and their individual</span>\n<span class=\"sd\">        vertices to be moved.</span>\n\n<span class=\"sd\">        The VERTEX_INSERT and VERTEX_REMOVE modes allow for individual</span>\n<span class=\"sd\">        vertices either to be added to or removed from shapes that are already</span>\n<span class=\"sd\">        selected. Note that shapes cannot be selected in this mode.</span>\n\n<span class=\"sd\">        The ADD_RECTANGLE, ADD_ELLIPSE, ADD_LINE, ADD_PATH, and ADD_POLYGON</span>\n<span class=\"sd\">        modes all allow for their corresponding shape type to be added.</span>\n\n<span class=\"sd\">    Notes</span>\n<span class=\"sd\">    -----</span>\n<span class=\"sd\">    _data_dict : Dict of ShapeList</span>\n<span class=\"sd\">        Dictionary containing all the shape data indexed by slice tuple</span>\n<span class=\"sd\">    _data_view : ShapeList</span>\n<span class=\"sd\">        Object containing the currently viewed shape data.</span>\n<span class=\"sd\">    _selected_data_history : set</span>\n<span class=\"sd\">        Set of currently selected captured on press of &lt;space&gt;.</span>\n<span class=\"sd\">    _selected_data_stored : set</span>\n<span class=\"sd\">        Set of selected previously displayed. Used to prevent rerendering the</span>\n<span class=\"sd\">        same highlighted shapes when no data has changed.</span>\n<span class=\"sd\">    _selected_box : None | np.ndarray</span>\n<span class=\"sd\">        `None` if no shapes are selected, otherwise a 10x2 array of vertices of</span>\n<span class=\"sd\">        the interaction box. The first 8 points are the corners and midpoints</span>\n<span class=\"sd\">        of the box. The 9th point is the center of the box, and the last point</span>\n<span class=\"sd\">        is the location of the rotation handle that can be used to rotate the</span>\n<span class=\"sd\">        box.</span>\n<span class=\"sd\">    _drag_start : None | np.ndarray</span>\n<span class=\"sd\">        If a drag has been started and is in progress then a length 2 array of</span>\n<span class=\"sd\">        the initial coordinates of the drag. `None` otherwise.</span>\n<span class=\"sd\">    _drag_box : None | np.ndarray</span>\n<span class=\"sd\">        If a drag box is being created to select shapes then this is a 2x2</span>\n<span class=\"sd\">        array of the two extreme corners of the drag. `None` otherwise.</span>\n<span class=\"sd\">    _drag_box_stored : None | np.ndarray</span>\n<span class=\"sd\">        If a drag box is being created to select shapes then this is a 2x2</span>\n<span class=\"sd\">        array of the two extreme corners of the drag that have previously been</span>\n<span class=\"sd\">        rendered. `None` otherwise. Used to prevent rerendering the same</span>\n<span class=\"sd\">        drag box when no data has changed.</span>\n<span class=\"sd\">    _is_moving : bool</span>\n<span class=\"sd\">        Bool indicating if any shapes are currently being moved.</span>\n<span class=\"sd\">    _is_selecting : bool</span>\n<span class=\"sd\">        Bool indicating if a drag box is currently being created in order to</span>\n<span class=\"sd\">        select shapes.</span>\n<span class=\"sd\">    _is_creating : bool</span>\n<span class=\"sd\">        Bool indicating if any shapes are currently being created.</span>\n<span class=\"sd\">    _fixed_aspect : bool</span>\n<span class=\"sd\">        Bool indicating if aspect ratio of shapes should be preserved on</span>\n<span class=\"sd\">        resizing.</span>\n<span class=\"sd\">    _aspect_ratio : float</span>\n<span class=\"sd\">        Value of aspect ratio to be preserved if `_fixed_aspect` is `True`.</span>\n<span class=\"sd\">    _fixed_vertex : None | np.ndarray</span>\n<span class=\"sd\">        If a scaling or rotation is in progress then a length 2 array of the</span>\n<span class=\"sd\">        coordinates that are remaining fixed during the move. `None` otherwise.</span>\n<span class=\"sd\">    _fixed_index : int</span>\n<span class=\"sd\">        If a scaling or rotation is in progress then the index of the vertex of</span>\n<span class=\"sd\">        the bounding box that is remaining fixed during the move. `None`</span>\n<span class=\"sd\">        otherwise.</span>\n<span class=\"sd\">    _update_properties : bool</span>\n<span class=\"sd\">        Bool indicating if properties are to allowed to update the selected</span>\n<span class=\"sd\">        shapes when they are changed. Blocking this prevents circular loops</span>\n<span class=\"sd\">        when shapes are selected and the properties are changed based on that</span>\n<span class=\"sd\">        selection</span>\n<span class=\"sd\">    _allow_thumbnail_update : bool</span>\n<span class=\"sd\">        Flag set to true to allow the thumbnail to be updated. Blocking the thumbnail</span>\n<span class=\"sd\">        can be advantageous where responsiveness is critical.</span>\n<span class=\"sd\">    _clipboard : dict</span>\n<span class=\"sd\">        Dict of shape objects that are to be used during a copy and paste.</span>\n<span class=\"sd\">    _colors : list</span>\n<span class=\"sd\">        List of supported vispy color names.</span>\n<span class=\"sd\">    _vertex_size : float</span>\n<span class=\"sd\">        Size of the vertices of the shapes and bounding box in Canvas</span>\n<span class=\"sd\">        coordinates.</span>\n<span class=\"sd\">    _rotation_handle_length : float</span>\n<span class=\"sd\">        Length of the rotation handle of the bounding box in Canvas</span>\n<span class=\"sd\">        coordinates.</span>\n<span class=\"sd\">    _input_ndim : int</span>\n<span class=\"sd\">        Dimensions of shape data.</span>\n<span class=\"sd\">    _thumbnail_update_thresh : int</span>\n<span class=\"sd\">        If there are more than this number of shapes, the thumbnail</span>\n<span class=\"sd\">        won't update during interactive events</span>\n<span class=\"sd\">    _property_choices : dict {str: array (N,)}</span>\n<span class=\"sd\">        Possible values for the properties in Shapes.properties.</span>\n<span class=\"sd\">    \"\"\"</span>\n\n    <span class=\"n\">_colors</span> <span class=\"o\">=</span> <span class=\"n\">get_color_names</span><span class=\"p\">()</span>\n    <span class=\"n\">_vertex_size</span> <span class=\"o\">=</span> <span class=\"mi\">10</span>\n    <span class=\"n\">_rotation_handle_length</span> <span class=\"o\">=</span> <span class=\"mi\">20</span>\n    <span class=\"n\">_highlight_color</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mf\">0.6</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">)</span>\n    <span class=\"n\">_highlight_width</span> <span class=\"o\">=</span> <span class=\"mf\">1.5</span>\n\n    <span class=\"c1\"># If more shapes are present then they are randomly subsampled</span>\n    <span class=\"c1\"># in the thumbnail</span>\n    <span class=\"n\">_max_shapes_thumbnail</span> <span class=\"o\">=</span> <span class=\"mi\">100</span>\n\n    <span class=\"n\">_drag_modes</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n        <span class=\"n\">Mode</span><span class=\"o\">.</span><span class=\"n\">PAN_ZOOM</span><span class=\"p\">:</span> <span class=\"n\">no_op</span><span class=\"p\">,</span>\n        <span class=\"n\">Mode</span><span class=\"o\">.</span><span class=\"n\">SELECT</span><span class=\"p\">:</span> <span class=\"n\">select</span><span class=\"p\">,</span>\n        <span class=\"n\">Mode</span><span class=\"o\">.</span><span class=\"n\">DIRECT</span><span class=\"p\">:</span> <span class=\"n\">select</span><span class=\"p\">,</span>\n        <span class=\"n\">Mode</span><span class=\"o\">.</span><span class=\"n\">VERTEX_INSERT</span><span class=\"p\">:</span> <span class=\"n\">vertex_insert</span><span class=\"p\">,</span>\n        <span class=\"n\">Mode</span><span class=\"o\">.</span><span class=\"n\">VERTEX_REMOVE</span><span class=\"p\">:</span> <span class=\"n\">vertex_remove</span><span class=\"p\">,</span>\n        <span class=\"n\">Mode</span><span class=\"o\">.</span><span class=\"n\">ADD_RECTANGLE</span><span class=\"p\">:</span> <span class=\"n\">add_rectangle</span><span class=\"p\">,</span>\n        <span class=\"n\">Mode</span><span class=\"o\">.</span><span class=\"n\">ADD_ELLIPSE</span><span class=\"p\">:</span> <span class=\"n\">add_ellipse</span><span class=\"p\">,</span>\n        <span class=\"n\">Mode</span><span class=\"o\">.</span><span class=\"n\">ADD_LINE</span><span class=\"p\">:</span> <span class=\"n\">add_line</span><span class=\"p\">,</span>\n        <span class=\"n\">Mode</span><span class=\"o\">.</span><span class=\"n\">ADD_PATH</span><span class=\"p\">:</span> <span class=\"n\">add_path_polygon</span><span class=\"p\">,</span>\n        <span class=\"n\">Mode</span><span class=\"o\">.</span><span class=\"n\">ADD_POLYGON</span><span class=\"p\">:</span> <span class=\"n\">add_path_polygon</span><span class=\"p\">,</span>\n    <span class=\"p\">}</span>\n\n    <span class=\"n\">_move_modes</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n        <span class=\"n\">Mode</span><span class=\"o\">.</span><span class=\"n\">PAN_ZOOM</span><span class=\"p\">:</span> <span class=\"n\">no_op</span><span class=\"p\">,</span>\n        <span class=\"n\">Mode</span><span class=\"o\">.</span><span class=\"n\">SELECT</span><span class=\"p\">:</span> <span class=\"n\">highlight</span><span class=\"p\">,</span>\n        <span class=\"n\">Mode</span><span class=\"o\">.</span><span class=\"n\">DIRECT</span><span class=\"p\">:</span> <span class=\"n\">highlight</span><span class=\"p\">,</span>\n        <span class=\"n\">Mode</span><span class=\"o\">.</span><span class=\"n\">VERTEX_INSERT</span><span class=\"p\">:</span> <span class=\"n\">highlight</span><span class=\"p\">,</span>\n        <span class=\"n\">Mode</span><span class=\"o\">.</span><span class=\"n\">VERTEX_REMOVE</span><span class=\"p\">:</span> <span class=\"n\">highlight</span><span class=\"p\">,</span>\n        <span class=\"n\">Mode</span><span class=\"o\">.</span><span class=\"n\">ADD_RECTANGLE</span><span class=\"p\">:</span> <span class=\"n\">no_op</span><span class=\"p\">,</span>\n        <span class=\"n\">Mode</span><span class=\"o\">.</span><span class=\"n\">ADD_ELLIPSE</span><span class=\"p\">:</span> <span class=\"n\">no_op</span><span class=\"p\">,</span>\n        <span class=\"n\">Mode</span><span class=\"o\">.</span><span class=\"n\">ADD_LINE</span><span class=\"p\">:</span> <span class=\"n\">no_op</span><span class=\"p\">,</span>\n        <span class=\"n\">Mode</span><span class=\"o\">.</span><span class=\"n\">ADD_PATH</span><span class=\"p\">:</span> <span class=\"n\">add_path_polygon_creating</span><span class=\"p\">,</span>\n        <span class=\"n\">Mode</span><span class=\"o\">.</span><span class=\"n\">ADD_POLYGON</span><span class=\"p\">:</span> <span class=\"n\">add_path_polygon_creating</span><span class=\"p\">,</span>\n    <span class=\"p\">}</span>\n\n    <span class=\"n\">_double_click_modes</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n        <span class=\"n\">Mode</span><span class=\"o\">.</span><span class=\"n\">PAN_ZOOM</span><span class=\"p\">:</span> <span class=\"n\">no_op</span><span class=\"p\">,</span>\n        <span class=\"n\">Mode</span><span class=\"o\">.</span><span class=\"n\">SELECT</span><span class=\"p\">:</span> <span class=\"n\">no_op</span><span class=\"p\">,</span>\n        <span class=\"n\">Mode</span><span class=\"o\">.</span><span class=\"n\">DIRECT</span><span class=\"p\">:</span> <span class=\"n\">no_op</span><span class=\"p\">,</span>\n        <span class=\"n\">Mode</span><span class=\"o\">.</span><span class=\"n\">VERTEX_INSERT</span><span class=\"p\">:</span> <span class=\"n\">no_op</span><span class=\"p\">,</span>\n        <span class=\"n\">Mode</span><span class=\"o\">.</span><span class=\"n\">VERTEX_REMOVE</span><span class=\"p\">:</span> <span class=\"n\">no_op</span><span class=\"p\">,</span>\n        <span class=\"n\">Mode</span><span class=\"o\">.</span><span class=\"n\">ADD_RECTANGLE</span><span class=\"p\">:</span> <span class=\"n\">no_op</span><span class=\"p\">,</span>\n        <span class=\"n\">Mode</span><span class=\"o\">.</span><span class=\"n\">ADD_ELLIPSE</span><span class=\"p\">:</span> <span class=\"n\">no_op</span><span class=\"p\">,</span>\n        <span class=\"n\">Mode</span><span class=\"o\">.</span><span class=\"n\">ADD_LINE</span><span class=\"p\">:</span> <span class=\"n\">no_op</span><span class=\"p\">,</span>\n        <span class=\"n\">Mode</span><span class=\"o\">.</span><span class=\"n\">ADD_PATH</span><span class=\"p\">:</span> <span class=\"n\">finish_drawing_shape</span><span class=\"p\">,</span>\n        <span class=\"n\">Mode</span><span class=\"o\">.</span><span class=\"n\">ADD_POLYGON</span><span class=\"p\">:</span> <span class=\"n\">finish_drawing_shape</span><span class=\"p\">,</span>\n    <span class=\"p\">}</span>\n\n    <span class=\"n\">_cursor_modes</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n        <span class=\"n\">Mode</span><span class=\"o\">.</span><span class=\"n\">PAN_ZOOM</span><span class=\"p\">:</span> <span class=\"s1\">'standard'</span><span class=\"p\">,</span>\n        <span class=\"n\">Mode</span><span class=\"o\">.</span><span class=\"n\">SELECT</span><span class=\"p\">:</span> <span class=\"s1\">'pointing'</span><span class=\"p\">,</span>\n        <span class=\"n\">Mode</span><span class=\"o\">.</span><span class=\"n\">DIRECT</span><span class=\"p\">:</span> <span class=\"s1\">'pointing'</span><span class=\"p\">,</span>\n        <span class=\"n\">Mode</span><span class=\"o\">.</span><span class=\"n\">VERTEX_INSERT</span><span class=\"p\">:</span> <span class=\"s1\">'cross'</span><span class=\"p\">,</span>\n        <span class=\"n\">Mode</span><span class=\"o\">.</span><span class=\"n\">VERTEX_REMOVE</span><span class=\"p\">:</span> <span class=\"s1\">'cross'</span><span class=\"p\">,</span>\n        <span class=\"n\">Mode</span><span class=\"o\">.</span><span class=\"n\">ADD_RECTANGLE</span><span class=\"p\">:</span> <span class=\"s1\">'cross'</span><span class=\"p\">,</span>\n        <span class=\"n\">Mode</span><span class=\"o\">.</span><span class=\"n\">ADD_ELLIPSE</span><span class=\"p\">:</span> <span class=\"s1\">'cross'</span><span class=\"p\">,</span>\n        <span class=\"n\">Mode</span><span class=\"o\">.</span><span class=\"n\">ADD_LINE</span><span class=\"p\">:</span> <span class=\"s1\">'cross'</span><span class=\"p\">,</span>\n        <span class=\"n\">Mode</span><span class=\"o\">.</span><span class=\"n\">ADD_PATH</span><span class=\"p\">:</span> <span class=\"s1\">'cross'</span><span class=\"p\">,</span>\n        <span class=\"n\">Mode</span><span class=\"o\">.</span><span class=\"n\">ADD_POLYGON</span><span class=\"p\">:</span> <span class=\"s1\">'cross'</span><span class=\"p\">,</span>\n    <span class=\"p\">}</span>\n\n    <span class=\"n\">_interactive_modes</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n        <span class=\"n\">Mode</span><span class=\"o\">.</span><span class=\"n\">PAN_ZOOM</span><span class=\"p\">,</span>\n    <span class=\"p\">}</span>\n\n    <span class=\"k\">def</span> <span class=\"fm\">__init__</span><span class=\"p\">(</span>\n        <span class=\"bp\">self</span><span class=\"p\">,</span>\n        <span class=\"n\">data</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"o\">*</span><span class=\"p\">,</span>\n        <span class=\"n\">ndim</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">properties</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">property_choices</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">text</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">shape_type</span><span class=\"o\">=</span><span class=\"s1\">'rectangle'</span><span class=\"p\">,</span>\n        <span class=\"n\">edge_width</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"p\">,</span>\n        <span class=\"n\">edge_color</span><span class=\"o\">=</span><span class=\"s1\">'#777777'</span><span class=\"p\">,</span>\n        <span class=\"n\">edge_color_cycle</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">edge_colormap</span><span class=\"o\">=</span><span class=\"s1\">'viridis'</span><span class=\"p\">,</span>\n        <span class=\"n\">edge_contrast_limits</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">face_color</span><span class=\"o\">=</span><span class=\"s1\">'white'</span><span class=\"p\">,</span>\n        <span class=\"n\">face_color_cycle</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">face_colormap</span><span class=\"o\">=</span><span class=\"s1\">'viridis'</span><span class=\"p\">,</span>\n        <span class=\"n\">face_contrast_limits</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">z_index</span><span class=\"o\">=</span><span class=\"mi\">0</span><span class=\"p\">,</span>\n        <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">metadata</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">scale</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">translate</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">rotate</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">shear</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">affine</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">opacity</span><span class=\"o\">=</span><span class=\"mf\">0.7</span><span class=\"p\">,</span>\n        <span class=\"n\">blending</span><span class=\"o\">=</span><span class=\"s1\">'translucent'</span><span class=\"p\">,</span>\n        <span class=\"n\">visible</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">,</span>\n        <span class=\"n\">cache</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">,</span>\n        <span class=\"n\">experimental_clipping_planes</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"p\">):</span>\n        <span class=\"k\">if</span> <span class=\"n\">data</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n            <span class=\"k\">if</span> <span class=\"n\">ndim</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n                <span class=\"n\">ndim</span> <span class=\"o\">=</span> <span class=\"mi\">2</span>\n            <span class=\"n\">data</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">empty</span><span class=\"p\">((</span><span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"n\">ndim</span><span class=\"p\">))</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"n\">data</span><span class=\"p\">,</span> <span class=\"n\">shape_type</span> <span class=\"o\">=</span> <span class=\"n\">extract_shape_type</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">,</span> <span class=\"n\">shape_type</span><span class=\"p\">)</span>\n            <span class=\"n\">data_ndim</span> <span class=\"o\">=</span> <span class=\"n\">get_shape_ndim</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">)</span>\n            <span class=\"k\">if</span> <span class=\"n\">ndim</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span> <span class=\"ow\">and</span> <span class=\"n\">ndim</span> <span class=\"o\">!=</span> <span class=\"n\">data_ndim</span><span class=\"p\">:</span>\n                <span class=\"k\">raise</span> <span class=\"ne\">ValueError</span><span class=\"p\">(</span>\n                    <span class=\"n\">trans</span><span class=\"o\">.</span><span class=\"n\">_</span><span class=\"p\">(</span>\n                        <span class=\"s2\">\"Shape dimensions must be equal to ndim\"</span><span class=\"p\">,</span>\n                        <span class=\"n\">deferred</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">,</span>\n                    <span class=\"p\">)</span>\n                <span class=\"p\">)</span>\n            <span class=\"n\">ndim</span> <span class=\"o\">=</span> <span class=\"n\">data_ndim</span>\n\n        <span class=\"nb\">super</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"fm\">__init__</span><span class=\"p\">(</span>\n            <span class=\"n\">data</span><span class=\"p\">,</span>\n            <span class=\"n\">ndim</span><span class=\"o\">=</span><span class=\"n\">ndim</span><span class=\"p\">,</span>\n            <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"n\">name</span><span class=\"p\">,</span>\n            <span class=\"n\">metadata</span><span class=\"o\">=</span><span class=\"n\">metadata</span><span class=\"p\">,</span>\n            <span class=\"n\">scale</span><span class=\"o\">=</span><span class=\"n\">scale</span><span class=\"p\">,</span>\n            <span class=\"n\">translate</span><span class=\"o\">=</span><span class=\"n\">translate</span><span class=\"p\">,</span>\n            <span class=\"n\">rotate</span><span class=\"o\">=</span><span class=\"n\">rotate</span><span class=\"p\">,</span>\n            <span class=\"n\">shear</span><span class=\"o\">=</span><span class=\"n\">shear</span><span class=\"p\">,</span>\n            <span class=\"n\">affine</span><span class=\"o\">=</span><span class=\"n\">affine</span><span class=\"p\">,</span>\n            <span class=\"n\">opacity</span><span class=\"o\">=</span><span class=\"n\">opacity</span><span class=\"p\">,</span>\n            <span class=\"n\">blending</span><span class=\"o\">=</span><span class=\"n\">blending</span><span class=\"p\">,</span>\n            <span class=\"n\">visible</span><span class=\"o\">=</span><span class=\"n\">visible</span><span class=\"p\">,</span>\n            <span class=\"n\">cache</span><span class=\"o\">=</span><span class=\"n\">cache</span><span class=\"p\">,</span>\n            <span class=\"n\">experimental_clipping_planes</span><span class=\"o\">=</span><span class=\"n\">experimental_clipping_planes</span><span class=\"p\">,</span>\n        <span class=\"p\">)</span>\n\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">events</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span>\n            <span class=\"n\">mode</span><span class=\"o\">=</span><span class=\"n\">Event</span><span class=\"p\">,</span>\n            <span class=\"n\">edge_width</span><span class=\"o\">=</span><span class=\"n\">Event</span><span class=\"p\">,</span>\n            <span class=\"n\">edge_color</span><span class=\"o\">=</span><span class=\"n\">Event</span><span class=\"p\">,</span>\n            <span class=\"n\">face_color</span><span class=\"o\">=</span><span class=\"n\">Event</span><span class=\"p\">,</span>\n            <span class=\"n\">properties</span><span class=\"o\">=</span><span class=\"n\">Event</span><span class=\"p\">,</span>\n            <span class=\"n\">current_edge_color</span><span class=\"o\">=</span><span class=\"n\">Event</span><span class=\"p\">,</span>\n            <span class=\"n\">current_face_color</span><span class=\"o\">=</span><span class=\"n\">Event</span><span class=\"p\">,</span>\n            <span class=\"n\">current_properties</span><span class=\"o\">=</span><span class=\"n\">Event</span><span class=\"p\">,</span>\n            <span class=\"n\">highlight</span><span class=\"o\">=</span><span class=\"n\">Event</span><span class=\"p\">,</span>\n        <span class=\"p\">)</span>\n\n        <span class=\"c1\"># Flag set to false to block thumbnail refresh</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_allow_thumbnail_update</span> <span class=\"o\">=</span> <span class=\"kc\">True</span>\n\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_display_order_stored</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_ndisplay_stored</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_ndisplay</span>\n\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_properties</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_property_choices</span> <span class=\"o\">=</span> <span class=\"n\">prepare_properties</span><span class=\"p\">(</span>\n            <span class=\"n\">properties</span><span class=\"p\">,</span> <span class=\"n\">property_choices</span><span class=\"p\">,</span> <span class=\"n\">num_data</span><span class=\"o\">=</span><span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">)</span>\n        <span class=\"p\">)</span>\n\n        <span class=\"c1\"># make the text</span>\n        <span class=\"k\">if</span> <span class=\"n\">text</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span> <span class=\"ow\">or</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">text</span><span class=\"p\">,</span> <span class=\"p\">(</span><span class=\"nb\">list</span><span class=\"p\">,</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">ndarray</span><span class=\"p\">,</span> <span class=\"nb\">str</span><span class=\"p\">)):</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_text</span> <span class=\"o\">=</span> <span class=\"n\">TextManager</span><span class=\"p\">(</span><span class=\"n\">text</span><span class=\"p\">,</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">),</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">properties</span><span class=\"p\">)</span>\n        <span class=\"k\">elif</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">text</span><span class=\"p\">,</span> <span class=\"nb\">dict</span><span class=\"p\">):</span>\n            <span class=\"n\">copied_text</span> <span class=\"o\">=</span> <span class=\"n\">deepcopy</span><span class=\"p\">(</span><span class=\"n\">text</span><span class=\"p\">)</span>\n            <span class=\"n\">copied_text</span><span class=\"p\">[</span><span class=\"s1\">'properties'</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">properties</span>\n            <span class=\"n\">copied_text</span><span class=\"p\">[</span><span class=\"s1\">'n_text'</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">)</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_text</span> <span class=\"o\">=</span> <span class=\"n\">TextManager</span><span class=\"p\">(</span><span class=\"o\">**</span><span class=\"n\">copied_text</span><span class=\"p\">)</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"k\">raise</span> <span class=\"ne\">TypeError</span><span class=\"p\">(</span>\n                <span class=\"n\">trans</span><span class=\"o\">.</span><span class=\"n\">_</span><span class=\"p\">(</span>\n                    <span class=\"s1\">'text should be a string, array, or dict'</span><span class=\"p\">,</span>\n                    <span class=\"n\">deferred</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">,</span>\n                <span class=\"p\">)</span>\n            <span class=\"p\">)</span>\n\n        <span class=\"c1\"># The following shape properties are for the new shapes that will</span>\n        <span class=\"c1\"># be drawn. Each shape has a corresponding property with the</span>\n        <span class=\"c1\"># value for itself</span>\n        <span class=\"k\">if</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">isscalar</span><span class=\"p\">(</span><span class=\"n\">edge_width</span><span class=\"p\">):</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_current_edge_width</span> <span class=\"o\">=</span> <span class=\"n\">edge_width</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_current_edge_width</span> <span class=\"o\">=</span> <span class=\"mi\">1</span>\n\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_data_view</span> <span class=\"o\">=</span> <span class=\"n\">ShapeList</span><span class=\"p\">(</span><span class=\"n\">ndisplay</span><span class=\"o\">=</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_ndisplay</span><span class=\"p\">)</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_data_view</span><span class=\"o\">.</span><span class=\"n\">slice_key</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">array</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_slice_indices</span><span class=\"p\">)[</span>\n            <span class=\"nb\">list</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_dims_not_displayed</span><span class=\"p\">)</span>\n        <span class=\"p\">]</span>\n\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_value</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"kc\">None</span><span class=\"p\">,</span> <span class=\"kc\">None</span><span class=\"p\">)</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_value_stored</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"kc\">None</span><span class=\"p\">,</span> <span class=\"kc\">None</span><span class=\"p\">)</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_moving_value</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"kc\">None</span><span class=\"p\">,</span> <span class=\"kc\">None</span><span class=\"p\">)</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_selected_data</span> <span class=\"o\">=</span> <span class=\"nb\">set</span><span class=\"p\">()</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_selected_data_stored</span> <span class=\"o\">=</span> <span class=\"nb\">set</span><span class=\"p\">()</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_selected_data_history</span> <span class=\"o\">=</span> <span class=\"nb\">set</span><span class=\"p\">()</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_selected_box</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_drag_start</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_fixed_vertex</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_fixed_aspect</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_aspect_ratio</span> <span class=\"o\">=</span> <span class=\"mi\">1</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_is_moving</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n\n        <span class=\"c1\"># _moving_coordinates are needed for fixing aspect ratio during</span>\n        <span class=\"c1\"># a resize, it stores the last pointer coordinate value that happened</span>\n        <span class=\"c1\"># during a mouse move to that pressing/releasing shift</span>\n        <span class=\"c1\"># can trigger a redraw of the shape with a fixed aspect ratio.</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_moving_coordinates</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_fixed_index</span> <span class=\"o\">=</span> <span class=\"mi\">0</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_is_selecting</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_drag_box</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_drag_box_stored</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_is_creating</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_clipboard</span> <span class=\"o\">=</span> <span class=\"p\">{}</span>\n\n        <span class=\"c1\"># change mode once to trigger the</span>\n        <span class=\"c1\"># Mode setting logic</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_mode</span> <span class=\"o\">=</span> <span class=\"n\">Mode</span><span class=\"o\">.</span><span class=\"n\">SELECT</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">mode</span> <span class=\"o\">=</span> <span class=\"n\">Mode</span><span class=\"o\">.</span><span class=\"n\">PAN_ZOOM</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_status</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">mode</span>\n\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_init_shapes</span><span class=\"p\">(</span>\n            <span class=\"n\">data</span><span class=\"p\">,</span>\n            <span class=\"n\">shape_type</span><span class=\"o\">=</span><span class=\"n\">shape_type</span><span class=\"p\">,</span>\n            <span class=\"n\">edge_width</span><span class=\"o\">=</span><span class=\"n\">edge_width</span><span class=\"p\">,</span>\n            <span class=\"n\">edge_color</span><span class=\"o\">=</span><span class=\"n\">edge_color</span><span class=\"p\">,</span>\n            <span class=\"n\">edge_color_cycle</span><span class=\"o\">=</span><span class=\"n\">edge_color_cycle</span><span class=\"p\">,</span>\n            <span class=\"n\">edge_colormap</span><span class=\"o\">=</span><span class=\"n\">edge_colormap</span><span class=\"p\">,</span>\n            <span class=\"n\">edge_contrast_limits</span><span class=\"o\">=</span><span class=\"n\">edge_contrast_limits</span><span class=\"p\">,</span>\n            <span class=\"n\">face_color</span><span class=\"o\">=</span><span class=\"n\">face_color</span><span class=\"p\">,</span>\n            <span class=\"n\">face_color_cycle</span><span class=\"o\">=</span><span class=\"n\">face_color_cycle</span><span class=\"p\">,</span>\n            <span class=\"n\">face_colormap</span><span class=\"o\">=</span><span class=\"n\">face_colormap</span><span class=\"p\">,</span>\n            <span class=\"n\">face_contrast_limits</span><span class=\"o\">=</span><span class=\"n\">face_contrast_limits</span><span class=\"p\">,</span>\n            <span class=\"n\">z_index</span><span class=\"o\">=</span><span class=\"n\">z_index</span><span class=\"p\">,</span>\n        <span class=\"p\">)</span>\n\n        <span class=\"c1\"># set the current_* properties</span>\n        <span class=\"k\">if</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">)</span> <span class=\"o\">&gt;</span> <span class=\"mi\">0</span><span class=\"p\">:</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_current_edge_color</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">edge_color</span><span class=\"p\">[</span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">]</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_current_face_color</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">face_color</span><span class=\"p\">[</span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">]</span>\n        <span class=\"k\">elif</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">)</span> <span class=\"o\">==</span> <span class=\"mi\">0</span> <span class=\"ow\">and</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">properties</span><span class=\"p\">)</span> <span class=\"o\">&gt;</span> <span class=\"mi\">0</span><span class=\"p\">:</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_initialize_current_color_for_empty_layer</span><span class=\"p\">(</span><span class=\"n\">edge_color</span><span class=\"p\">,</span> <span class=\"s1\">'edge'</span><span class=\"p\">)</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_initialize_current_color_for_empty_layer</span><span class=\"p\">(</span><span class=\"n\">face_color</span><span class=\"p\">,</span> <span class=\"s1\">'face'</span><span class=\"p\">)</span>\n        <span class=\"k\">elif</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">)</span> <span class=\"o\">==</span> <span class=\"mi\">0</span> <span class=\"ow\">and</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">properties</span><span class=\"p\">)</span> <span class=\"o\">==</span> <span class=\"mi\">0</span><span class=\"p\">:</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_current_edge_color</span> <span class=\"o\">=</span> <span class=\"n\">transform_color_with_defaults</span><span class=\"p\">(</span>\n                <span class=\"n\">num_entries</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"p\">,</span>\n                <span class=\"n\">colors</span><span class=\"o\">=</span><span class=\"n\">edge_color</span><span class=\"p\">,</span>\n                <span class=\"n\">elem_name</span><span class=\"o\">=</span><span class=\"s2\">\"edge_color\"</span><span class=\"p\">,</span>\n                <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s2\">\"black\"</span><span class=\"p\">,</span>\n            <span class=\"p\">)</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_current_face_color</span> <span class=\"o\">=</span> <span class=\"n\">transform_color_with_defaults</span><span class=\"p\">(</span>\n                <span class=\"n\">num_entries</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"p\">,</span>\n                <span class=\"n\">colors</span><span class=\"o\">=</span><span class=\"n\">face_color</span><span class=\"p\">,</span>\n                <span class=\"n\">elem_name</span><span class=\"o\">=</span><span class=\"s2\">\"face_color\"</span><span class=\"p\">,</span>\n                <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s2\">\"black\"</span><span class=\"p\">,</span>\n            <span class=\"p\">)</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">current_properties</span> <span class=\"o\">=</span> <span class=\"n\">get_current_properties</span><span class=\"p\">(</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_properties</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_property_choices</span><span class=\"p\">,</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">)</span>\n        <span class=\"p\">)</span>\n\n        <span class=\"c1\"># Trigger generation of view slice and thumbnail</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_update_dims</span><span class=\"p\">()</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">_initialize_current_color_for_empty_layer</span><span class=\"p\">(</span>\n        <span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">color</span><span class=\"p\">:</span> <span class=\"n\">ColorType</span><span class=\"p\">,</span> <span class=\"n\">attribute</span><span class=\"p\">:</span> <span class=\"nb\">str</span>\n    <span class=\"p\">):</span>\n        <span class=\"sd\">\"\"\"Initialize current_{edge,face}_color when starting with empty layer.</span>\n\n<span class=\"sd\">        Parameters</span>\n<span class=\"sd\">        ----------</span>\n<span class=\"sd\">        color : (N, 4) array or str</span>\n<span class=\"sd\">            The value for setting edge or face_color</span>\n<span class=\"sd\">        attribute : str in {'edge', 'face'}</span>\n<span class=\"sd\">            The name of the attribute to set the color of.</span>\n<span class=\"sd\">            Should be 'edge' for edge_color or 'face' for face_color.</span>\n<span class=\"sd\">        \"\"\"</span>\n        <span class=\"n\">color_mode</span> <span class=\"o\">=</span> <span class=\"nb\">getattr</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">'_</span><span class=\"si\">{</span><span class=\"n\">attribute</span><span class=\"si\">}</span><span class=\"s1\">_color_mode'</span><span class=\"p\">)</span>\n        <span class=\"k\">if</span> <span class=\"n\">color_mode</span> <span class=\"o\">==</span> <span class=\"n\">ColorMode</span><span class=\"o\">.</span><span class=\"n\">DIRECT</span><span class=\"p\">:</span>\n            <span class=\"n\">curr_color</span> <span class=\"o\">=</span> <span class=\"n\">transform_color_with_defaults</span><span class=\"p\">(</span>\n                <span class=\"n\">num_entries</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"p\">,</span>\n                <span class=\"n\">colors</span><span class=\"o\">=</span><span class=\"n\">color</span><span class=\"p\">,</span>\n                <span class=\"n\">elem_name</span><span class=\"o\">=</span><span class=\"sa\">f</span><span class=\"s1\">'</span><span class=\"si\">{</span><span class=\"n\">attribute</span><span class=\"si\">}</span><span class=\"s1\">_color'</span><span class=\"p\">,</span>\n                <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s2\">\"white\"</span><span class=\"p\">,</span>\n            <span class=\"p\">)</span>\n\n        <span class=\"k\">elif</span> <span class=\"n\">color_mode</span> <span class=\"o\">==</span> <span class=\"n\">ColorMode</span><span class=\"o\">.</span><span class=\"n\">CYCLE</span><span class=\"p\">:</span>\n            <span class=\"n\">color_cycle</span> <span class=\"o\">=</span> <span class=\"nb\">getattr</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">'_</span><span class=\"si\">{</span><span class=\"n\">attribute</span><span class=\"si\">}</span><span class=\"s1\">_color_cycle'</span><span class=\"p\">)</span>\n            <span class=\"n\">curr_color</span> <span class=\"o\">=</span> <span class=\"n\">transform_color</span><span class=\"p\">(</span><span class=\"nb\">next</span><span class=\"p\">(</span><span class=\"n\">color_cycle</span><span class=\"p\">))</span>\n\n            <span class=\"c1\"># add the new color cycle mapping</span>\n            <span class=\"n\">color_property</span> <span class=\"o\">=</span> <span class=\"nb\">getattr</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">'_</span><span class=\"si\">{</span><span class=\"n\">attribute</span><span class=\"si\">}</span><span class=\"s1\">_color_property'</span><span class=\"p\">)</span>\n            <span class=\"n\">prop_value</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_property_choices</span><span class=\"p\">[</span><span class=\"n\">color_property</span><span class=\"p\">][</span><span class=\"mi\">0</span><span class=\"p\">]</span>\n            <span class=\"n\">color_cycle_map</span> <span class=\"o\">=</span> <span class=\"nb\">getattr</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">'</span><span class=\"si\">{</span><span class=\"n\">attribute</span><span class=\"si\">}</span><span class=\"s1\">_color_cycle_map'</span><span class=\"p\">)</span>\n            <span class=\"n\">color_cycle_map</span><span class=\"p\">[</span><span class=\"n\">prop_value</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">squeeze</span><span class=\"p\">(</span><span class=\"n\">curr_color</span><span class=\"p\">)</span>\n            <span class=\"nb\">setattr</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">'</span><span class=\"si\">{</span><span class=\"n\">attribute</span><span class=\"si\">}</span><span class=\"s1\">_color_cycle_map'</span><span class=\"p\">,</span> <span class=\"n\">color_cycle_map</span><span class=\"p\">)</span>\n\n        <span class=\"k\">elif</span> <span class=\"n\">color_mode</span> <span class=\"o\">==</span> <span class=\"n\">ColorMode</span><span class=\"o\">.</span><span class=\"n\">COLORMAP</span><span class=\"p\">:</span>\n            <span class=\"n\">color_property</span> <span class=\"o\">=</span> <span class=\"nb\">getattr</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">'_</span><span class=\"si\">{</span><span class=\"n\">attribute</span><span class=\"si\">}</span><span class=\"s1\">_color_property'</span><span class=\"p\">)</span>\n            <span class=\"n\">prop_value</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_property_choices</span><span class=\"p\">[</span><span class=\"n\">color_property</span><span class=\"p\">][</span><span class=\"mi\">0</span><span class=\"p\">]</span>\n            <span class=\"n\">colormap</span> <span class=\"o\">=</span> <span class=\"nb\">getattr</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">'</span><span class=\"si\">{</span><span class=\"n\">attribute</span><span class=\"si\">}</span><span class=\"s1\">_colormap'</span><span class=\"p\">)</span>\n            <span class=\"n\">contrast_limits</span> <span class=\"o\">=</span> <span class=\"nb\">getattr</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">'_</span><span class=\"si\">{</span><span class=\"n\">attribute</span><span class=\"si\">}</span><span class=\"s1\">_contrast_limits'</span><span class=\"p\">)</span>\n            <span class=\"n\">curr_color</span><span class=\"p\">,</span> <span class=\"n\">_</span> <span class=\"o\">=</span> <span class=\"n\">map_property</span><span class=\"p\">(</span>\n                <span class=\"n\">prop</span><span class=\"o\">=</span><span class=\"n\">prop_value</span><span class=\"p\">,</span>\n                <span class=\"n\">colormap</span><span class=\"o\">=</span><span class=\"n\">colormap</span><span class=\"p\">,</span>\n                <span class=\"n\">contrast_limits</span><span class=\"o\">=</span><span class=\"n\">contrast_limits</span><span class=\"p\">,</span>\n            <span class=\"p\">)</span>\n        <span class=\"nb\">setattr</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">'_current_</span><span class=\"si\">{</span><span class=\"n\">attribute</span><span class=\"si\">}</span><span class=\"s1\">_color'</span><span class=\"p\">,</span> <span class=\"n\">curr_color</span><span class=\"p\">)</span>\n\n    <span class=\"nd\">@property</span>\n    <span class=\"k\">def</span> <span class=\"nf\">data</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"sd\">\"\"\"list: Each element is an (N, D) array of the vertices of a shape.\"\"\"</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_data_view</span><span class=\"o\">.</span><span class=\"n\">data</span>\n\n    <span class=\"nd\">@data</span><span class=\"o\">.</span><span class=\"n\">setter</span>\n    <span class=\"k\">def</span> <span class=\"nf\">data</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_finish_drawing</span><span class=\"p\">()</span>\n\n        <span class=\"n\">data</span><span class=\"p\">,</span> <span class=\"n\">shape_type</span> <span class=\"o\">=</span> <span class=\"n\">extract_shape_type</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">)</span>\n        <span class=\"n\">n_new_shapes</span> <span class=\"o\">=</span> <span class=\"n\">number_of_shapes</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">)</span>\n        <span class=\"c1\"># not given a shape_type through data</span>\n        <span class=\"k\">if</span> <span class=\"n\">shape_type</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n            <span class=\"n\">shape_type</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">shape_type</span>\n\n        <span class=\"n\">edge_widths</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_data_view</span><span class=\"o\">.</span><span class=\"n\">edge_widths</span>\n        <span class=\"n\">edge_color</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_data_view</span><span class=\"o\">.</span><span class=\"n\">edge_color</span>\n        <span class=\"n\">face_color</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_data_view</span><span class=\"o\">.</span><span class=\"n\">face_color</span>\n        <span class=\"n\">z_indices</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_data_view</span><span class=\"o\">.</span><span class=\"n\">z_indices</span>\n\n        <span class=\"c1\"># fewer shapes, trim attributes</span>\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">nshapes</span> <span class=\"o\">&gt;</span> <span class=\"n\">n_new_shapes</span><span class=\"p\">:</span>\n            <span class=\"n\">shape_type</span> <span class=\"o\">=</span> <span class=\"n\">shape_type</span><span class=\"p\">[:</span><span class=\"n\">n_new_shapes</span><span class=\"p\">]</span>\n            <span class=\"n\">edge_widths</span> <span class=\"o\">=</span> <span class=\"n\">edge_widths</span><span class=\"p\">[:</span><span class=\"n\">n_new_shapes</span><span class=\"p\">]</span>\n            <span class=\"n\">z_indices</span> <span class=\"o\">=</span> <span class=\"n\">z_indices</span><span class=\"p\">[:</span><span class=\"n\">n_new_shapes</span><span class=\"p\">]</span>\n            <span class=\"n\">edge_color</span> <span class=\"o\">=</span> <span class=\"n\">edge_color</span><span class=\"p\">[:</span><span class=\"n\">n_new_shapes</span><span class=\"p\">]</span>\n            <span class=\"n\">face_color</span> <span class=\"o\">=</span> <span class=\"n\">face_color</span><span class=\"p\">[:</span><span class=\"n\">n_new_shapes</span><span class=\"p\">]</span>\n        <span class=\"c1\"># more shapes, add attributes</span>\n        <span class=\"k\">elif</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">nshapes</span> <span class=\"o\">&lt;</span> <span class=\"n\">n_new_shapes</span><span class=\"p\">:</span>\n            <span class=\"n\">n_shapes_difference</span> <span class=\"o\">=</span> <span class=\"n\">n_new_shapes</span> <span class=\"o\">-</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">nshapes</span>\n            <span class=\"n\">shape_type</span> <span class=\"o\">=</span> <span class=\"p\">(</span>\n                <span class=\"n\">shape_type</span>\n                <span class=\"o\">+</span> <span class=\"p\">[</span><span class=\"n\">get_default_shape_type</span><span class=\"p\">(</span><span class=\"n\">shape_type</span><span class=\"p\">)]</span> <span class=\"o\">*</span> <span class=\"n\">n_shapes_difference</span>\n            <span class=\"p\">)</span>\n            <span class=\"n\">edge_widths</span> <span class=\"o\">=</span> <span class=\"n\">edge_widths</span> <span class=\"o\">+</span> <span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">]</span> <span class=\"o\">*</span> <span class=\"n\">n_shapes_difference</span>\n            <span class=\"n\">z_indices</span> <span class=\"o\">=</span> <span class=\"n\">z_indices</span> <span class=\"o\">+</span> <span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span> <span class=\"o\">*</span> <span class=\"n\">n_shapes_difference</span>\n            <span class=\"n\">edge_color</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">concatenate</span><span class=\"p\">(</span>\n                <span class=\"p\">(</span>\n                    <span class=\"n\">edge_color</span><span class=\"p\">,</span>\n                    <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_get_new_shape_color</span><span class=\"p\">(</span><span class=\"n\">n_shapes_difference</span><span class=\"p\">,</span> <span class=\"s1\">'edge'</span><span class=\"p\">),</span>\n                <span class=\"p\">)</span>\n            <span class=\"p\">)</span>\n            <span class=\"n\">face_color</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">concatenate</span><span class=\"p\">(</span>\n                <span class=\"p\">(</span>\n                    <span class=\"n\">face_color</span><span class=\"p\">,</span>\n                    <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_get_new_shape_color</span><span class=\"p\">(</span><span class=\"n\">n_shapes_difference</span><span class=\"p\">,</span> <span class=\"s1\">'face'</span><span class=\"p\">),</span>\n                <span class=\"p\">)</span>\n            <span class=\"p\">)</span>\n\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_data_view</span> <span class=\"o\">=</span> <span class=\"n\">ShapeList</span><span class=\"p\">()</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span>\n            <span class=\"n\">data</span><span class=\"p\">,</span>\n            <span class=\"n\">shape_type</span><span class=\"o\">=</span><span class=\"n\">shape_type</span><span class=\"p\">,</span>\n            <span class=\"n\">edge_width</span><span class=\"o\">=</span><span class=\"n\">edge_widths</span><span class=\"p\">,</span>\n            <span class=\"n\">edge_color</span><span class=\"o\">=</span><span class=\"n\">edge_color</span><span class=\"p\">,</span>\n            <span class=\"n\">face_color</span><span class=\"o\">=</span><span class=\"n\">face_color</span><span class=\"p\">,</span>\n            <span class=\"n\">z_index</span><span class=\"o\">=</span><span class=\"n\">z_indices</span><span class=\"p\">,</span>\n        <span class=\"p\">)</span>\n\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_update_dims</span><span class=\"p\">()</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">events</span><span class=\"o\">.</span><span class=\"n\">data</span><span class=\"p\">(</span><span class=\"n\">value</span><span class=\"o\">=</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">data</span><span class=\"p\">)</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_set_editable</span><span class=\"p\">()</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">_on_selection</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">selected</span><span class=\"p\">:</span> <span class=\"nb\">bool</span><span class=\"p\">):</span>\n        <span class=\"c1\"># this method is slated for removal.  don't add anything new.</span>\n        <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">selected</span><span class=\"p\">:</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_finish_drawing</span><span class=\"p\">()</span>\n\n    <span class=\"nd\">@property</span>\n    <span class=\"k\">def</span> <span class=\"nf\">properties</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">)</span> <span class=\"o\">-&gt;</span> <span class=\"n\">Dict</span><span class=\"p\">[</span><span class=\"nb\">str</span><span class=\"p\">,</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">ndarray</span><span class=\"p\">]:</span>\n        <span class=\"sd\">\"\"\"dict {str: np.ndarray (N,)}, DataFrame: Annotations for each shape\"\"\"</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_properties</span>\n\n    <span class=\"nd\">@properties</span><span class=\"o\">.</span><span class=\"n\">setter</span>\n    <span class=\"k\">def</span> <span class=\"nf\">properties</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">properties</span><span class=\"p\">:</span> <span class=\"n\">Dict</span><span class=\"p\">[</span><span class=\"nb\">str</span><span class=\"p\">,</span> <span class=\"n\">Array</span><span class=\"p\">]):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_properties</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_property_choices</span> <span class=\"o\">=</span> <span class=\"n\">prepare_properties</span><span class=\"p\">(</span>\n            <span class=\"n\">properties</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_property_choices</span><span class=\"p\">,</span> <span class=\"n\">num_data</span><span class=\"o\">=</span><span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">data</span><span class=\"p\">)</span>\n        <span class=\"p\">)</span>\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_face_color_property</span> <span class=\"ow\">and</span> <span class=\"p\">(</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_face_color_property</span> <span class=\"ow\">not</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_properties</span>\n        <span class=\"p\">):</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_face_color_property</span> <span class=\"o\">=</span> <span class=\"s1\">''</span>\n            <span class=\"n\">warnings</span><span class=\"o\">.</span><span class=\"n\">warn</span><span class=\"p\">(</span>\n                <span class=\"n\">trans</span><span class=\"o\">.</span><span class=\"n\">_</span><span class=\"p\">(</span>\n                    <span class=\"s1\">'property used for face_color dropped'</span><span class=\"p\">,</span>\n                    <span class=\"n\">deferred</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">,</span>\n                <span class=\"p\">),</span>\n                <span class=\"ne\">RuntimeWarning</span><span class=\"p\">,</span>\n            <span class=\"p\">)</span>\n\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_edge_color_property</span> <span class=\"ow\">and</span> <span class=\"p\">(</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_edge_color_property</span> <span class=\"ow\">not</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_properties</span>\n        <span class=\"p\">):</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_edge_color_property</span> <span class=\"o\">=</span> <span class=\"s1\">''</span>\n            <span class=\"n\">warnings</span><span class=\"o\">.</span><span class=\"n\">warn</span><span class=\"p\">(</span>\n                <span class=\"n\">trans</span><span class=\"o\">.</span><span class=\"n\">_</span><span class=\"p\">(</span>\n                    <span class=\"s1\">'property used for edge_color dropped'</span><span class=\"p\">,</span>\n                    <span class=\"n\">deferred</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">,</span>\n                <span class=\"p\">),</span>\n                <span class=\"ne\">RuntimeWarning</span><span class=\"p\">,</span>\n            <span class=\"p\">)</span>\n\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">text</span><span class=\"o\">.</span><span class=\"n\">values</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">refresh_text</span><span class=\"p\">()</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">events</span><span class=\"o\">.</span><span class=\"n\">properties</span><span class=\"p\">()</span>\n\n    <span class=\"nd\">@property</span>\n    <span class=\"k\">def</span> <span class=\"nf\">property_choices</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">)</span> <span class=\"o\">-&gt;</span> <span class=\"n\">Dict</span><span class=\"p\">[</span><span class=\"nb\">str</span><span class=\"p\">,</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">ndarray</span><span class=\"p\">]:</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_property_choices</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">_get_ndim</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"sd\">\"\"\"Determine number of dimensions of the layer.\"\"\"</span>\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">nshapes</span> <span class=\"o\">==</span> <span class=\"mi\">0</span><span class=\"p\">:</span>\n            <span class=\"n\">ndim</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">ndim</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"n\">ndim</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">data</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">shape</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">]</span>\n        <span class=\"k\">return</span> <span class=\"n\">ndim</span>\n\n    <span class=\"nd\">@property</span>\n    <span class=\"k\">def</span> <span class=\"nf\">_extent_data</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">)</span> <span class=\"o\">-&gt;</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">ndarray</span><span class=\"p\">:</span>\n        <span class=\"sd\">\"\"\"Extent of layer in data coordinates.</span>\n\n<span class=\"sd\">        Returns</span>\n<span class=\"sd\">        -------</span>\n<span class=\"sd\">        extent_data : array, shape (2, D)</span>\n<span class=\"sd\">        \"\"\"</span>\n        <span class=\"k\">if</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">data</span><span class=\"p\">)</span> <span class=\"o\">==</span> <span class=\"mi\">0</span><span class=\"p\">:</span>\n            <span class=\"n\">extrema</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">full</span><span class=\"p\">((</span><span class=\"mi\">2</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">ndim</span><span class=\"p\">),</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">nan</span><span class=\"p\">)</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"n\">maxs</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">max</span><span class=\"p\">([</span><span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">max</span><span class=\"p\">(</span><span class=\"n\">d</span><span class=\"p\">,</span> <span class=\"n\">axis</span><span class=\"o\">=</span><span class=\"mi\">0</span><span class=\"p\">)</span> <span class=\"k\">for</span> <span class=\"n\">d</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">data</span><span class=\"p\">],</span> <span class=\"n\">axis</span><span class=\"o\">=</span><span class=\"mi\">0</span><span class=\"p\">)</span>\n            <span class=\"n\">mins</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">min</span><span class=\"p\">([</span><span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">min</span><span class=\"p\">(</span><span class=\"n\">d</span><span class=\"p\">,</span> <span class=\"n\">axis</span><span class=\"o\">=</span><span class=\"mi\">0</span><span class=\"p\">)</span> <span class=\"k\">for</span> <span class=\"n\">d</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">data</span><span class=\"p\">],</span> <span class=\"n\">axis</span><span class=\"o\">=</span><span class=\"mi\">0</span><span class=\"p\">)</span>\n            <span class=\"n\">extrema</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">vstack</span><span class=\"p\">([</span><span class=\"n\">mins</span><span class=\"p\">,</span> <span class=\"n\">maxs</span><span class=\"p\">])</span>\n        <span class=\"k\">return</span> <span class=\"n\">extrema</span>\n\n    <span class=\"nd\">@property</span>\n    <span class=\"k\">def</span> <span class=\"nf\">nshapes</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"sd\">\"\"\"int: Total number of shapes.\"\"\"</span>\n        <span class=\"k\">return</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_data_view</span><span class=\"o\">.</span><span class=\"n\">shapes</span><span class=\"p\">)</span>\n\n    <span class=\"nd\">@property</span>\n    <span class=\"k\">def</span> <span class=\"nf\">current_edge_width</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"sd\">\"\"\"float: Width of shape edges including lines and paths.\"\"\"</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_current_edge_width</span>\n\n    <span class=\"nd\">@current_edge_width</span><span class=\"o\">.</span><span class=\"n\">setter</span>\n    <span class=\"k\">def</span> <span class=\"nf\">current_edge_width</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">edge_width</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_current_edge_width</span> <span class=\"o\">=</span> <span class=\"n\">edge_width</span>\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_update_properties</span><span class=\"p\">:</span>\n            <span class=\"k\">for</span> <span class=\"n\">i</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">selected_data</span><span class=\"p\">:</span>\n                <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_data_view</span><span class=\"o\">.</span><span class=\"n\">update_edge_width</span><span class=\"p\">(</span><span class=\"n\">i</span><span class=\"p\">,</span> <span class=\"n\">edge_width</span><span class=\"p\">)</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">events</span><span class=\"o\">.</span><span class=\"n\">edge_width</span><span class=\"p\">()</span>\n\n    <span class=\"nd\">@property</span>\n    <span class=\"k\">def</span> <span class=\"nf\">current_edge_color</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"sd\">\"\"\"str: color of shape edges including lines and paths.\"\"\"</span>\n        <span class=\"n\">hex_</span> <span class=\"o\">=</span> <span class=\"n\">rgb_to_hex</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_current_edge_color</span><span class=\"p\">)[</span><span class=\"mi\">0</span><span class=\"p\">]</span>\n        <span class=\"k\">return</span> <span class=\"n\">hex_to_name</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"n\">hex_</span><span class=\"p\">,</span> <span class=\"n\">hex_</span><span class=\"p\">)</span>\n\n    <span class=\"nd\">@current_edge_color</span><span class=\"o\">.</span><span class=\"n\">setter</span>\n    <span class=\"k\">def</span> <span class=\"nf\">current_edge_color</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">edge_color</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_current_edge_color</span> <span class=\"o\">=</span> <span class=\"n\">transform_color</span><span class=\"p\">(</span><span class=\"n\">edge_color</span><span class=\"p\">)</span>\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_update_properties</span><span class=\"p\">:</span>\n            <span class=\"k\">for</span> <span class=\"n\">i</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">selected_data</span><span class=\"p\">:</span>\n                <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_data_view</span><span class=\"o\">.</span><span class=\"n\">update_edge_color</span><span class=\"p\">(</span><span class=\"n\">i</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_current_edge_color</span><span class=\"p\">)</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">events</span><span class=\"o\">.</span><span class=\"n\">edge_color</span><span class=\"p\">()</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_update_thumbnail</span><span class=\"p\">()</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">events</span><span class=\"o\">.</span><span class=\"n\">current_edge_color</span><span class=\"p\">()</span>\n\n    <span class=\"nd\">@property</span>\n    <span class=\"k\">def</span> <span class=\"nf\">current_face_color</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"sd\">\"\"\"str: color of shape faces.\"\"\"</span>\n        <span class=\"n\">hex_</span> <span class=\"o\">=</span> <span class=\"n\">rgb_to_hex</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_current_face_color</span><span class=\"p\">)[</span><span class=\"mi\">0</span><span class=\"p\">]</span>\n        <span class=\"k\">return</span> <span class=\"n\">hex_to_name</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"n\">hex_</span><span class=\"p\">,</span> <span class=\"n\">hex_</span><span class=\"p\">)</span>\n\n    <span class=\"nd\">@current_face_color</span><span class=\"o\">.</span><span class=\"n\">setter</span>\n    <span class=\"k\">def</span> <span class=\"nf\">current_face_color</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">face_color</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_current_face_color</span> <span class=\"o\">=</span> <span class=\"n\">transform_color</span><span class=\"p\">(</span><span class=\"n\">face_color</span><span class=\"p\">)</span>\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_update_properties</span><span class=\"p\">:</span>\n            <span class=\"k\">for</span> <span class=\"n\">i</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">selected_data</span><span class=\"p\">:</span>\n                <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_data_view</span><span class=\"o\">.</span><span class=\"n\">update_face_color</span><span class=\"p\">(</span><span class=\"n\">i</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_current_face_color</span><span class=\"p\">)</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">events</span><span class=\"o\">.</span><span class=\"n\">face_color</span><span class=\"p\">()</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_update_thumbnail</span><span class=\"p\">()</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">events</span><span class=\"o\">.</span><span class=\"n\">current_face_color</span><span class=\"p\">()</span>\n\n    <span class=\"nd\">@property</span>\n    <span class=\"k\">def</span> <span class=\"nf\">current_properties</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">)</span> <span class=\"o\">-&gt;</span> <span class=\"n\">Dict</span><span class=\"p\">[</span><span class=\"nb\">str</span><span class=\"p\">,</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">ndarray</span><span class=\"p\">]:</span>\n        <span class=\"sd\">\"\"\"dict{str: np.ndarray(1,)}: properties for the next added shape.\"\"\"</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_current_properties</span>\n\n    <span class=\"nd\">@current_properties</span><span class=\"o\">.</span><span class=\"n\">setter</span>\n    <span class=\"k\">def</span> <span class=\"nf\">current_properties</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">current_properties</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_current_properties</span> <span class=\"o\">=</span> <span class=\"n\">coerce_current_properties</span><span class=\"p\">(</span>\n            <span class=\"n\">current_properties</span>\n        <span class=\"p\">)</span>\n\n        <span class=\"k\">if</span> <span class=\"p\">(</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_update_properties</span>\n            <span class=\"ow\">and</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">selected_data</span><span class=\"p\">)</span> <span class=\"o\">&gt;</span> <span class=\"mi\">0</span>\n            <span class=\"ow\">and</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_mode</span> <span class=\"ow\">in</span> <span class=\"p\">[</span><span class=\"n\">Mode</span><span class=\"o\">.</span><span class=\"n\">SELECT</span><span class=\"p\">,</span> <span class=\"n\">Mode</span><span class=\"o\">.</span><span class=\"n\">PAN_ZOOM</span><span class=\"p\">]</span>\n        <span class=\"p\">):</span>\n            <span class=\"n\">props</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">properties</span>\n            <span class=\"k\">for</span> <span class=\"n\">k</span> <span class=\"ow\">in</span> <span class=\"n\">props</span><span class=\"p\">:</span>\n                <span class=\"n\">props</span><span class=\"p\">[</span><span class=\"n\">k</span><span class=\"p\">][</span><span class=\"nb\">list</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">selected_data</span><span class=\"p\">)]</span> <span class=\"o\">=</span> <span class=\"n\">current_properties</span><span class=\"p\">[</span><span class=\"n\">k</span><span class=\"p\">]</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">properties</span> <span class=\"o\">=</span> <span class=\"n\">props</span>\n\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">refresh_colors</span><span class=\"p\">()</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">events</span><span class=\"o\">.</span><span class=\"n\">current_properties</span><span class=\"p\">()</span>\n\n    <span class=\"nd\">@property</span>\n    <span class=\"k\">def</span> <span class=\"nf\">shape_type</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"sd\">\"\"\"list of str: name of shape type for each shape.\"\"\"</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_data_view</span><span class=\"o\">.</span><span class=\"n\">shape_types</span>\n\n    <span class=\"nd\">@shape_type</span><span class=\"o\">.</span><span class=\"n\">setter</span>\n    <span class=\"k\">def</span> <span class=\"nf\">shape_type</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">shape_type</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_finish_drawing</span><span class=\"p\">()</span>\n\n        <span class=\"n\">new_data_view</span> <span class=\"o\">=</span> <span class=\"n\">ShapeList</span><span class=\"p\">()</span>\n        <span class=\"n\">shape_inputs</span> <span class=\"o\">=</span> <span class=\"nb\">zip</span><span class=\"p\">(</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_data_view</span><span class=\"o\">.</span><span class=\"n\">data</span><span class=\"p\">,</span>\n            <span class=\"n\">ensure_iterable</span><span class=\"p\">(</span><span class=\"n\">shape_type</span><span class=\"p\">),</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_data_view</span><span class=\"o\">.</span><span class=\"n\">edge_widths</span><span class=\"p\">,</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_data_view</span><span class=\"o\">.</span><span class=\"n\">edge_color</span><span class=\"p\">,</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_data_view</span><span class=\"o\">.</span><span class=\"n\">face_color</span><span class=\"p\">,</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_data_view</span><span class=\"o\">.</span><span class=\"n\">z_indices</span><span class=\"p\">,</span>\n        <span class=\"p\">)</span>\n\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_add_shapes_to_view</span><span class=\"p\">(</span><span class=\"n\">shape_inputs</span><span class=\"p\">,</span> <span class=\"n\">new_data_view</span><span class=\"p\">)</span>\n\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_data_view</span> <span class=\"o\">=</span> <span class=\"n\">new_data_view</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_update_dims</span><span class=\"p\">()</span>\n\n    <span class=\"nd\">@property</span>\n    <span class=\"k\">def</span> <span class=\"nf\">edge_color</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"sd\">\"\"\"(N x 4) np.ndarray: Array of RGBA face colors for each shape\"\"\"</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_data_view</span><span class=\"o\">.</span><span class=\"n\">edge_color</span>\n\n    <span class=\"nd\">@edge_color</span><span class=\"o\">.</span><span class=\"n\">setter</span>\n    <span class=\"k\">def</span> <span class=\"nf\">edge_color</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">edge_color</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_set_color</span><span class=\"p\">(</span><span class=\"n\">edge_color</span><span class=\"p\">,</span> <span class=\"s1\">'edge'</span><span class=\"p\">)</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">events</span><span class=\"o\">.</span><span class=\"n\">edge_color</span><span class=\"p\">()</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_update_thumbnail</span><span class=\"p\">()</span>\n\n    <span class=\"nd\">@property</span>\n    <span class=\"k\">def</span> <span class=\"nf\">edge_color_cycle</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">)</span> <span class=\"o\">-&gt;</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">ndarray</span><span class=\"p\">:</span>\n        <span class=\"sd\">\"\"\"Union[list, np.ndarray] :  Color cycle for edge_color.</span>\n\n<span class=\"sd\">        Can be a list of colors defined by name, RGB or RGBA</span>\n<span class=\"sd\">        \"\"\"</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_edge_color_cycle_values</span>\n\n    <span class=\"nd\">@edge_color_cycle</span><span class=\"o\">.</span><span class=\"n\">setter</span>\n    <span class=\"k\">def</span> <span class=\"nf\">edge_color_cycle</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">edge_color_cycle</span><span class=\"p\">:</span> <span class=\"n\">Union</span><span class=\"p\">[</span><span class=\"nb\">list</span><span class=\"p\">,</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">ndarray</span><span class=\"p\">]):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_set_color_cycle</span><span class=\"p\">(</span><span class=\"n\">edge_color_cycle</span><span class=\"p\">,</span> <span class=\"s1\">'edge'</span><span class=\"p\">)</span>\n\n    <span class=\"nd\">@property</span>\n    <span class=\"k\">def</span> <span class=\"nf\">edge_colormap</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">)</span> <span class=\"o\">-&gt;</span> <span class=\"n\">Tuple</span><span class=\"p\">[</span><span class=\"nb\">str</span><span class=\"p\">,</span> <span class=\"n\">Colormap</span><span class=\"p\">]:</span>\n        <span class=\"sd\">\"\"\"Return the colormap to be applied to a property to get the edge color.</span>\n\n<span class=\"sd\">        Returns</span>\n<span class=\"sd\">        -------</span>\n<span class=\"sd\">        colormap : napari.utils.Colormap</span>\n<span class=\"sd\">            The Colormap object.</span>\n<span class=\"sd\">        \"\"\"</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_edge_colormap</span>\n\n    <span class=\"nd\">@edge_colormap</span><span class=\"o\">.</span><span class=\"n\">setter</span>\n    <span class=\"k\">def</span> <span class=\"nf\">edge_colormap</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">colormap</span><span class=\"p\">:</span> <span class=\"n\">ValidColormapArg</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_edge_colormap</span> <span class=\"o\">=</span> <span class=\"n\">ensure_colormap</span><span class=\"p\">(</span><span class=\"n\">colormap</span><span class=\"p\">)</span>\n\n    <span class=\"nd\">@property</span>\n    <span class=\"k\">def</span> <span class=\"nf\">edge_contrast_limits</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">)</span> <span class=\"o\">-&gt;</span> <span class=\"n\">Tuple</span><span class=\"p\">[</span><span class=\"nb\">float</span><span class=\"p\">,</span> <span class=\"nb\">float</span><span class=\"p\">]:</span>\n        <span class=\"sd\">\"\"\"None, (float, float): contrast limits for mapping</span>\n<span class=\"sd\">        the edge_color colormap property to 0 and 1</span>\n<span class=\"sd\">        \"\"\"</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_edge_contrast_limits</span>\n\n    <span class=\"nd\">@edge_contrast_limits</span><span class=\"o\">.</span><span class=\"n\">setter</span>\n    <span class=\"k\">def</span> <span class=\"nf\">edge_contrast_limits</span><span class=\"p\">(</span>\n        <span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">contrast_limits</span><span class=\"p\">:</span> <span class=\"n\">Union</span><span class=\"p\">[</span><span class=\"kc\">None</span><span class=\"p\">,</span> <span class=\"n\">Tuple</span><span class=\"p\">[</span><span class=\"nb\">float</span><span class=\"p\">,</span> <span class=\"nb\">float</span><span class=\"p\">]]</span>\n    <span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_edge_contrast_limits</span> <span class=\"o\">=</span> <span class=\"n\">contrast_limits</span>\n\n    <span class=\"nd\">@property</span>\n    <span class=\"k\">def</span> <span class=\"nf\">edge_color_mode</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">)</span> <span class=\"o\">-&gt;</span> <span class=\"nb\">str</span><span class=\"p\">:</span>\n        <span class=\"sd\">\"\"\"str: Edge color setting mode</span>\n\n<span class=\"sd\">        DIRECT (default mode) allows each shape color to be set arbitrarily</span>\n\n<span class=\"sd\">        CYCLE allows the color to be set via a color cycle over an attribute</span>\n\n<span class=\"sd\">        COLORMAP allows color to be set via a color map over an attribute</span>\n<span class=\"sd\">        \"\"\"</span>\n        <span class=\"k\">return</span> <span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_edge_color_mode</span><span class=\"p\">)</span>\n\n    <span class=\"nd\">@edge_color_mode</span><span class=\"o\">.</span><span class=\"n\">setter</span>\n    <span class=\"k\">def</span> <span class=\"nf\">edge_color_mode</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">edge_color_mode</span><span class=\"p\">:</span> <span class=\"n\">Union</span><span class=\"p\">[</span><span class=\"nb\">str</span><span class=\"p\">,</span> <span class=\"n\">ColorMode</span><span class=\"p\">]):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_set_color_mode</span><span class=\"p\">(</span><span class=\"n\">edge_color_mode</span><span class=\"p\">,</span> <span class=\"s1\">'edge'</span><span class=\"p\">)</span>\n\n    <span class=\"nd\">@property</span>\n    <span class=\"k\">def</span> <span class=\"nf\">face_color</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"sd\">\"\"\"(N x 4) np.ndarray: Array of RGBA face colors for each shape\"\"\"</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_data_view</span><span class=\"o\">.</span><span class=\"n\">face_color</span>\n\n    <span class=\"nd\">@face_color</span><span class=\"o\">.</span><span class=\"n\">setter</span>\n    <span class=\"k\">def</span> <span class=\"nf\">face_color</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">face_color</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_set_color</span><span class=\"p\">(</span><span class=\"n\">face_color</span><span class=\"p\">,</span> <span class=\"s1\">'face'</span><span class=\"p\">)</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">events</span><span class=\"o\">.</span><span class=\"n\">face_color</span><span class=\"p\">()</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_update_thumbnail</span><span class=\"p\">()</span>\n\n    <span class=\"nd\">@property</span>\n    <span class=\"k\">def</span> <span class=\"nf\">face_color_cycle</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">)</span> <span class=\"o\">-&gt;</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">ndarray</span><span class=\"p\">:</span>\n        <span class=\"sd\">\"\"\"Union[np.ndarray, cycle]:  Color cycle for face_color</span>\n<span class=\"sd\">        Can be a list of colors defined by name, RGB or RGBA</span>\n<span class=\"sd\">        \"\"\"</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_face_color_cycle_values</span>\n\n    <span class=\"nd\">@face_color_cycle</span><span class=\"o\">.</span><span class=\"n\">setter</span>\n    <span class=\"k\">def</span> <span class=\"nf\">face_color_cycle</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">face_color_cycle</span><span class=\"p\">:</span> <span class=\"n\">Union</span><span class=\"p\">[</span><span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">ndarray</span><span class=\"p\">,</span> <span class=\"n\">cycle</span><span class=\"p\">]):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_set_color_cycle</span><span class=\"p\">(</span><span class=\"n\">face_color_cycle</span><span class=\"p\">,</span> <span class=\"s1\">'face'</span><span class=\"p\">)</span>\n\n    <span class=\"nd\">@property</span>\n    <span class=\"k\">def</span> <span class=\"nf\">face_colormap</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">)</span> <span class=\"o\">-&gt;</span> <span class=\"n\">Tuple</span><span class=\"p\">[</span><span class=\"nb\">str</span><span class=\"p\">,</span> <span class=\"n\">Colormap</span><span class=\"p\">]:</span>\n        <span class=\"sd\">\"\"\"Return the colormap to be applied to a property to get the face color.</span>\n\n<span class=\"sd\">        Returns</span>\n<span class=\"sd\">        -------</span>\n<span class=\"sd\">        colormap : napari.utils.Colormap</span>\n<span class=\"sd\">            The Colormap object.</span>\n<span class=\"sd\">        \"\"\"</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_face_colormap</span>\n\n    <span class=\"nd\">@face_colormap</span><span class=\"o\">.</span><span class=\"n\">setter</span>\n    <span class=\"k\">def</span> <span class=\"nf\">face_colormap</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">colormap</span><span class=\"p\">:</span> <span class=\"n\">ValidColormapArg</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_face_colormap</span> <span class=\"o\">=</span> <span class=\"n\">ensure_colormap</span><span class=\"p\">(</span><span class=\"n\">colormap</span><span class=\"p\">)</span>\n\n    <span class=\"nd\">@property</span>\n    <span class=\"k\">def</span> <span class=\"nf\">face_contrast_limits</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">)</span> <span class=\"o\">-&gt;</span> <span class=\"n\">Union</span><span class=\"p\">[</span><span class=\"kc\">None</span><span class=\"p\">,</span> <span class=\"n\">Tuple</span><span class=\"p\">[</span><span class=\"nb\">float</span><span class=\"p\">,</span> <span class=\"nb\">float</span><span class=\"p\">]]:</span>\n        <span class=\"sd\">\"\"\"None, (float, float) : clims for mapping the face_color</span>\n<span class=\"sd\">        colormap property to 0 and 1</span>\n<span class=\"sd\">        \"\"\"</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_face_contrast_limits</span>\n\n    <span class=\"nd\">@face_contrast_limits</span><span class=\"o\">.</span><span class=\"n\">setter</span>\n    <span class=\"k\">def</span> <span class=\"nf\">face_contrast_limits</span><span class=\"p\">(</span>\n        <span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">contrast_limits</span><span class=\"p\">:</span> <span class=\"n\">Union</span><span class=\"p\">[</span><span class=\"kc\">None</span><span class=\"p\">,</span> <span class=\"n\">Tuple</span><span class=\"p\">[</span><span class=\"nb\">float</span><span class=\"p\">,</span> <span class=\"nb\">float</span><span class=\"p\">]]</span>\n    <span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_face_contrast_limits</span> <span class=\"o\">=</span> <span class=\"n\">contrast_limits</span>\n\n    <span class=\"nd\">@property</span>\n    <span class=\"k\">def</span> <span class=\"nf\">face_color_mode</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">)</span> <span class=\"o\">-&gt;</span> <span class=\"nb\">str</span><span class=\"p\">:</span>\n        <span class=\"sd\">\"\"\"str: Face color setting mode</span>\n\n<span class=\"sd\">        DIRECT (default mode) allows each shape color to be set arbitrarily</span>\n\n<span class=\"sd\">        CYCLE allows the color to be set via a color cycle over an attribute</span>\n\n<span class=\"sd\">        COLORMAP allows color to be set via a color map over an attribute</span>\n<span class=\"sd\">        \"\"\"</span>\n        <span class=\"k\">return</span> <span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_face_color_mode</span><span class=\"p\">)</span>\n\n    <span class=\"nd\">@face_color_mode</span><span class=\"o\">.</span><span class=\"n\">setter</span>\n    <span class=\"k\">def</span> <span class=\"nf\">face_color_mode</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">face_color_mode</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_set_color_mode</span><span class=\"p\">(</span><span class=\"n\">face_color_mode</span><span class=\"p\">,</span> <span class=\"s1\">'face'</span><span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">_set_color_mode</span><span class=\"p\">(</span>\n        <span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">color_mode</span><span class=\"p\">:</span> <span class=\"n\">Union</span><span class=\"p\">[</span><span class=\"n\">ColorMode</span><span class=\"p\">,</span> <span class=\"nb\">str</span><span class=\"p\">],</span> <span class=\"n\">attribute</span><span class=\"p\">:</span> <span class=\"nb\">str</span>\n    <span class=\"p\">):</span>\n        <span class=\"sd\">\"\"\"Set the face_color_mode or edge_color_mode property</span>\n\n<span class=\"sd\">        Parameters</span>\n<span class=\"sd\">        ----------</span>\n<span class=\"sd\">        color_mode : str, ColorMode</span>\n<span class=\"sd\">            The value for setting edge or face_color_mode. If color_mode is a string,</span>\n<span class=\"sd\">            it should be one of: 'direct', 'cycle', or 'colormap'</span>\n<span class=\"sd\">        attribute : str in {'edge', 'face'}</span>\n<span class=\"sd\">            The name of the attribute to set the color of.</span>\n<span class=\"sd\">            Should be 'edge' for edge_colo_moder or 'face' for face_color_mode.</span>\n<span class=\"sd\">        \"\"\"</span>\n        <span class=\"n\">color_mode</span> <span class=\"o\">=</span> <span class=\"n\">ColorMode</span><span class=\"p\">(</span><span class=\"n\">color_mode</span><span class=\"p\">)</span>\n\n        <span class=\"k\">if</span> <span class=\"n\">color_mode</span> <span class=\"o\">==</span> <span class=\"n\">ColorMode</span><span class=\"o\">.</span><span class=\"n\">DIRECT</span><span class=\"p\">:</span>\n            <span class=\"nb\">setattr</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">'_</span><span class=\"si\">{</span><span class=\"n\">attribute</span><span class=\"si\">}</span><span class=\"s1\">_color_mode'</span><span class=\"p\">,</span> <span class=\"n\">color_mode</span><span class=\"p\">)</span>\n        <span class=\"k\">elif</span> <span class=\"n\">color_mode</span> <span class=\"ow\">in</span> <span class=\"p\">(</span><span class=\"n\">ColorMode</span><span class=\"o\">.</span><span class=\"n\">CYCLE</span><span class=\"p\">,</span> <span class=\"n\">ColorMode</span><span class=\"o\">.</span><span class=\"n\">COLORMAP</span><span class=\"p\">):</span>\n            <span class=\"n\">color_property</span> <span class=\"o\">=</span> <span class=\"nb\">getattr</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">'_</span><span class=\"si\">{</span><span class=\"n\">attribute</span><span class=\"si\">}</span><span class=\"s1\">_color_property'</span><span class=\"p\">)</span>\n            <span class=\"k\">if</span> <span class=\"n\">color_property</span> <span class=\"o\">==</span> <span class=\"s1\">''</span><span class=\"p\">:</span>\n                <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">properties</span><span class=\"p\">:</span>\n                    <span class=\"n\">new_color_property</span> <span class=\"o\">=</span> <span class=\"nb\">next</span><span class=\"p\">(</span><span class=\"nb\">iter</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">properties</span><span class=\"p\">))</span>\n                    <span class=\"nb\">setattr</span><span class=\"p\">(</span>\n                        <span class=\"bp\">self</span><span class=\"p\">,</span>\n                        <span class=\"sa\">f</span><span class=\"s1\">'_</span><span class=\"si\">{</span><span class=\"n\">attribute</span><span class=\"si\">}</span><span class=\"s1\">_color_property'</span><span class=\"p\">,</span>\n                        <span class=\"n\">new_color_property</span><span class=\"p\">,</span>\n                    <span class=\"p\">)</span>\n                    <span class=\"n\">warnings</span><span class=\"o\">.</span><span class=\"n\">warn</span><span class=\"p\">(</span>\n                        <span class=\"n\">trans</span><span class=\"o\">.</span><span class=\"n\">_</span><span class=\"p\">(</span>\n                            <span class=\"s1\">'_</span><span class=\"si\">{attribute}</span><span class=\"s1\">_color_property was not set, setting to: </span><span class=\"si\">{new_color_property}</span><span class=\"s1\">'</span><span class=\"p\">,</span>\n                            <span class=\"n\">deferred</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">,</span>\n                            <span class=\"n\">attribute</span><span class=\"o\">=</span><span class=\"n\">attribute</span><span class=\"p\">,</span>\n                            <span class=\"n\">new_color_property</span><span class=\"o\">=</span><span class=\"n\">new_color_property</span><span class=\"p\">,</span>\n                        <span class=\"p\">)</span>\n                    <span class=\"p\">)</span>\n                <span class=\"k\">else</span><span class=\"p\">:</span>\n                    <span class=\"k\">raise</span> <span class=\"ne\">ValueError</span><span class=\"p\">(</span>\n                        <span class=\"n\">trans</span><span class=\"o\">.</span><span class=\"n\">_</span><span class=\"p\">(</span>\n                            <span class=\"s1\">'There must be a valid Shapes.properties to use </span><span class=\"si\">{color_mode}</span><span class=\"s1\">'</span><span class=\"p\">,</span>\n                            <span class=\"n\">deferred</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">,</span>\n                            <span class=\"n\">color_mode</span><span class=\"o\">=</span><span class=\"n\">color_mode</span><span class=\"p\">,</span>\n                        <span class=\"p\">)</span>\n                    <span class=\"p\">)</span>\n\n            <span class=\"c1\"># ColorMode.COLORMAP can only be applied to numeric properties</span>\n            <span class=\"n\">color_property</span> <span class=\"o\">=</span> <span class=\"nb\">getattr</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">'_</span><span class=\"si\">{</span><span class=\"n\">attribute</span><span class=\"si\">}</span><span class=\"s1\">_color_property'</span><span class=\"p\">)</span>\n            <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"n\">color_mode</span> <span class=\"o\">==</span> <span class=\"n\">ColorMode</span><span class=\"o\">.</span><span class=\"n\">COLORMAP</span><span class=\"p\">)</span> <span class=\"ow\">and</span> <span class=\"ow\">not</span> <span class=\"nb\">issubclass</span><span class=\"p\">(</span>\n                <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">properties</span><span class=\"p\">[</span><span class=\"n\">color_property</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">dtype</span><span class=\"o\">.</span><span class=\"n\">type</span><span class=\"p\">,</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">number</span>\n            <span class=\"p\">):</span>\n                <span class=\"k\">raise</span> <span class=\"ne\">TypeError</span><span class=\"p\">(</span>\n                    <span class=\"n\">trans</span><span class=\"o\">.</span><span class=\"n\">_</span><span class=\"p\">(</span>\n                        <span class=\"s1\">'selected property must be numeric to use ColorMode.COLORMAP'</span><span class=\"p\">,</span>\n                        <span class=\"n\">deferred</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">,</span>\n                    <span class=\"p\">)</span>\n                <span class=\"p\">)</span>\n            <span class=\"nb\">setattr</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">'_</span><span class=\"si\">{</span><span class=\"n\">attribute</span><span class=\"si\">}</span><span class=\"s1\">_color_mode'</span><span class=\"p\">,</span> <span class=\"n\">color_mode</span><span class=\"p\">)</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">refresh_colors</span><span class=\"p\">()</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">_set_color_cycle</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">color_cycle</span><span class=\"p\">:</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">ndarray</span><span class=\"p\">,</span> <span class=\"n\">attribute</span><span class=\"p\">:</span> <span class=\"nb\">str</span><span class=\"p\">):</span>\n        <span class=\"sd\">\"\"\"Set the face_color_cycle or edge_color_cycle property</span>\n\n<span class=\"sd\">        Parameters</span>\n<span class=\"sd\">        ----------</span>\n<span class=\"sd\">        color_cycle : (N, 4) or (N, 1) array</span>\n<span class=\"sd\">            The value for setting edge or face_color_cycle</span>\n<span class=\"sd\">        attribute : str in {'edge', 'face'}</span>\n<span class=\"sd\">            The name of the attribute to set the color of.</span>\n<span class=\"sd\">            Should be 'edge' for edge_color or 'face' for face_color.</span>\n<span class=\"sd\">        \"\"\"</span>\n        <span class=\"n\">transformed_color_cycle</span><span class=\"p\">,</span> <span class=\"n\">transformed_colors</span> <span class=\"o\">=</span> <span class=\"n\">transform_color_cycle</span><span class=\"p\">(</span>\n            <span class=\"n\">color_cycle</span><span class=\"o\">=</span><span class=\"n\">color_cycle</span><span class=\"p\">,</span>\n            <span class=\"n\">elem_name</span><span class=\"o\">=</span><span class=\"sa\">f</span><span class=\"s1\">'</span><span class=\"si\">{</span><span class=\"n\">attribute</span><span class=\"si\">}</span><span class=\"s1\">_color_cycle'</span><span class=\"p\">,</span>\n            <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s2\">\"white\"</span><span class=\"p\">,</span>\n        <span class=\"p\">)</span>\n        <span class=\"nb\">setattr</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">'_</span><span class=\"si\">{</span><span class=\"n\">attribute</span><span class=\"si\">}</span><span class=\"s1\">_color_cycle_values'</span><span class=\"p\">,</span> <span class=\"n\">transformed_colors</span><span class=\"p\">)</span>\n        <span class=\"nb\">setattr</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">'_</span><span class=\"si\">{</span><span class=\"n\">attribute</span><span class=\"si\">}</span><span class=\"s1\">_color_cycle'</span><span class=\"p\">,</span> <span class=\"n\">transformed_color_cycle</span><span class=\"p\">)</span>\n\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_update_properties</span> <span class=\"ow\">is</span> <span class=\"kc\">True</span><span class=\"p\">:</span>\n            <span class=\"n\">color_mode</span> <span class=\"o\">=</span> <span class=\"nb\">getattr</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">'_</span><span class=\"si\">{</span><span class=\"n\">attribute</span><span class=\"si\">}</span><span class=\"s1\">_color_mode'</span><span class=\"p\">)</span>\n            <span class=\"k\">if</span> <span class=\"n\">color_mode</span> <span class=\"o\">==</span> <span class=\"n\">ColorMode</span><span class=\"o\">.</span><span class=\"n\">CYCLE</span><span class=\"p\">:</span>\n                <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">refresh_colors</span><span class=\"p\">(</span><span class=\"n\">update_color_mapping</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n\n    <span class=\"nd\">@property</span>\n    <span class=\"k\">def</span> <span class=\"nf\">edge_width</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"sd\">\"\"\"list of float: edge width for each shape.\"\"\"</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_data_view</span><span class=\"o\">.</span><span class=\"n\">edge_widths</span>\n\n    <span class=\"nd\">@edge_width</span><span class=\"o\">.</span><span class=\"n\">setter</span>\n    <span class=\"k\">def</span> <span class=\"nf\">edge_width</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">width</span><span class=\"p\">):</span>\n        <span class=\"sd\">\"\"\"Set edge width of shapes using float or list of float.</span>\n\n<span class=\"sd\">        If list of float, must be of equal length to n shapes</span>\n\n<span class=\"sd\">        Parameters</span>\n<span class=\"sd\">        ----------</span>\n<span class=\"sd\">        width : float or list of float</span>\n<span class=\"sd\">            width of all shapes, or each shape if list</span>\n<span class=\"sd\">        \"\"\"</span>\n        <span class=\"k\">if</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">width</span><span class=\"p\">,</span> <span class=\"nb\">list</span><span class=\"p\">):</span>\n            <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">width</span><span class=\"p\">)</span> <span class=\"o\">==</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">nshapes</span><span class=\"p\">:</span>\n                <span class=\"k\">raise</span> <span class=\"ne\">ValueError</span><span class=\"p\">(</span>\n                    <span class=\"n\">trans</span><span class=\"o\">.</span><span class=\"n\">_</span><span class=\"p\">(</span><span class=\"s1\">'Length of list does not match number of shapes'</span><span class=\"p\">)</span>\n                <span class=\"p\">)</span>\n            <span class=\"k\">else</span><span class=\"p\">:</span>\n                <span class=\"n\">widths</span> <span class=\"o\">=</span> <span class=\"n\">width</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"n\">widths</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"n\">width</span> <span class=\"k\">for</span> <span class=\"n\">_</span> <span class=\"ow\">in</span> <span class=\"nb\">range</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">nshapes</span><span class=\"p\">)]</span>\n\n        <span class=\"k\">for</span> <span class=\"n\">i</span><span class=\"p\">,</span> <span class=\"n\">width</span> <span class=\"ow\">in</span> <span class=\"nb\">enumerate</span><span class=\"p\">(</span><span class=\"n\">widths</span><span class=\"p\">):</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_data_view</span><span class=\"o\">.</span><span class=\"n\">update_edge_width</span><span class=\"p\">(</span><span class=\"n\">i</span><span class=\"p\">,</span> <span class=\"n\">width</span><span class=\"p\">)</span>\n\n    <span class=\"nd\">@property</span>\n    <span class=\"k\">def</span> <span class=\"nf\">z_index</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"sd\">\"\"\"list of int: z_index for each shape.\"\"\"</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_data_view</span><span class=\"o\">.</span><span class=\"n\">z_indices</span>\n\n    <span class=\"nd\">@z_index</span><span class=\"o\">.</span><span class=\"n\">setter</span>\n    <span class=\"k\">def</span> <span class=\"nf\">z_index</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">z_index</span><span class=\"p\">):</span>\n        <span class=\"sd\">\"\"\"Set z_index of shape using either int or list of int.</span>\n\n<span class=\"sd\">        When list of int is provided, must be of equal length to n shapes.</span>\n\n<span class=\"sd\">        Parameters</span>\n<span class=\"sd\">        ----------</span>\n<span class=\"sd\">        z_index : int or list of int</span>\n<span class=\"sd\">            z-index of shapes</span>\n<span class=\"sd\">        \"\"\"</span>\n        <span class=\"k\">if</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">z_index</span><span class=\"p\">,</span> <span class=\"nb\">list</span><span class=\"p\">):</span>\n            <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">z_index</span><span class=\"p\">)</span> <span class=\"o\">==</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">nshapes</span><span class=\"p\">:</span>\n                <span class=\"k\">raise</span> <span class=\"ne\">ValueError</span><span class=\"p\">(</span>\n                    <span class=\"n\">trans</span><span class=\"o\">.</span><span class=\"n\">_</span><span class=\"p\">(</span><span class=\"s1\">'Length of list does not match number of shapes'</span><span class=\"p\">)</span>\n                <span class=\"p\">)</span>\n            <span class=\"k\">else</span><span class=\"p\">:</span>\n                <span class=\"n\">z_indices</span> <span class=\"o\">=</span> <span class=\"n\">z_index</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"n\">z_indices</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"n\">z_index</span> <span class=\"k\">for</span> <span class=\"n\">_</span> <span class=\"ow\">in</span> <span class=\"nb\">range</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">nshapes</span><span class=\"p\">)]</span>\n\n        <span class=\"k\">for</span> <span class=\"n\">i</span><span class=\"p\">,</span> <span class=\"n\">z_idx</span> <span class=\"ow\">in</span> <span class=\"nb\">enumerate</span><span class=\"p\">(</span><span class=\"n\">z_indices</span><span class=\"p\">):</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_data_view</span><span class=\"o\">.</span><span class=\"n\">update_z_index</span><span class=\"p\">(</span><span class=\"n\">i</span><span class=\"p\">,</span> <span class=\"n\">z_idx</span><span class=\"p\">)</span>\n\n    <span class=\"nd\">@property</span>\n    <span class=\"k\">def</span> <span class=\"nf\">selected_data</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"sd\">\"\"\"set: set of currently selected shapes.\"\"\"</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_selected_data</span>\n\n    <span class=\"nd\">@selected_data</span><span class=\"o\">.</span><span class=\"n\">setter</span>\n    <span class=\"k\">def</span> <span class=\"nf\">selected_data</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">selected_data</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_selected_data</span> <span class=\"o\">=</span> <span class=\"nb\">set</span><span class=\"p\">(</span><span class=\"n\">selected_data</span><span class=\"p\">)</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_selected_box</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">interaction_box</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_selected_data</span><span class=\"p\">)</span>\n\n        <span class=\"c1\"># Update properties based on selected shapes</span>\n        <span class=\"k\">if</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">selected_data</span><span class=\"p\">)</span> <span class=\"o\">&gt;</span> <span class=\"mi\">0</span><span class=\"p\">:</span>\n            <span class=\"n\">selected_data_indices</span> <span class=\"o\">=</span> <span class=\"nb\">list</span><span class=\"p\">(</span><span class=\"n\">selected_data</span><span class=\"p\">)</span>\n            <span class=\"n\">selected_face_colors</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_data_view</span><span class=\"o\">.</span><span class=\"n\">_face_color</span><span class=\"p\">[</span>\n                <span class=\"n\">selected_data_indices</span>\n            <span class=\"p\">]</span>\n            <span class=\"n\">face_colors</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">unique</span><span class=\"p\">(</span><span class=\"n\">selected_face_colors</span><span class=\"p\">,</span> <span class=\"n\">axis</span><span class=\"o\">=</span><span class=\"mi\">0</span><span class=\"p\">)</span>\n            <span class=\"k\">if</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">face_colors</span><span class=\"p\">)</span> <span class=\"o\">==</span> <span class=\"mi\">1</span><span class=\"p\">:</span>\n                <span class=\"n\">face_color</span> <span class=\"o\">=</span> <span class=\"n\">face_colors</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span>\n                <span class=\"k\">with</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">block_update_properties</span><span class=\"p\">():</span>\n                    <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">current_face_color</span> <span class=\"o\">=</span> <span class=\"n\">face_color</span>\n\n            <span class=\"n\">selected_edge_colors</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_data_view</span><span class=\"o\">.</span><span class=\"n\">_edge_color</span><span class=\"p\">[</span>\n                <span class=\"n\">selected_data_indices</span>\n            <span class=\"p\">]</span>\n            <span class=\"n\">edge_colors</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">unique</span><span class=\"p\">(</span><span class=\"n\">selected_edge_colors</span><span class=\"p\">,</span> <span class=\"n\">axis</span><span class=\"o\">=</span><span class=\"mi\">0</span><span class=\"p\">)</span>\n            <span class=\"k\">if</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">edge_colors</span><span class=\"p\">)</span> <span class=\"o\">==</span> <span class=\"mi\">1</span><span class=\"p\">:</span>\n                <span class=\"n\">edge_color</span> <span class=\"o\">=</span> <span class=\"n\">edge_colors</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span>\n                <span class=\"k\">with</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">block_update_properties</span><span class=\"p\">():</span>\n                    <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">current_edge_color</span> <span class=\"o\">=</span> <span class=\"n\">edge_color</span>\n\n            <span class=\"n\">edge_width</span> <span class=\"o\">=</span> <span class=\"nb\">list</span><span class=\"p\">(</span>\n                <span class=\"p\">{</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_data_view</span><span class=\"o\">.</span><span class=\"n\">shapes</span><span class=\"p\">[</span><span class=\"n\">i</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">edge_width</span> <span class=\"k\">for</span> <span class=\"n\">i</span> <span class=\"ow\">in</span> <span class=\"n\">selected_data</span><span class=\"p\">}</span>\n            <span class=\"p\">)</span>\n            <span class=\"k\">if</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">edge_width</span><span class=\"p\">)</span> <span class=\"o\">==</span> <span class=\"mi\">1</span><span class=\"p\">:</span>\n                <span class=\"n\">edge_width</span> <span class=\"o\">=</span> <span class=\"n\">edge_width</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span>\n                <span class=\"k\">with</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">block_update_properties</span><span class=\"p\">():</span>\n                    <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">current_edge_width</span> <span class=\"o\">=</span> <span class=\"n\">edge_width</span>\n\n            <span class=\"n\">properties</span> <span class=\"o\">=</span> <span class=\"p\">{}</span>\n            <span class=\"k\">for</span> <span class=\"n\">k</span><span class=\"p\">,</span> <span class=\"n\">v</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">properties</span><span class=\"o\">.</span><span class=\"n\">items</span><span class=\"p\">():</span>\n                <span class=\"c1\"># pandas uses `object` as dtype for strings by default, which</span>\n                <span class=\"c1\"># combined with the axis argument breaks np.unique</span>\n                <span class=\"n\">axis</span> <span class=\"o\">=</span> <span class=\"mi\">0</span> <span class=\"k\">if</span> <span class=\"n\">v</span><span class=\"o\">.</span><span class=\"n\">ndim</span> <span class=\"o\">&gt;</span> <span class=\"mi\">1</span> <span class=\"k\">else</span> <span class=\"kc\">None</span>\n                <span class=\"n\">properties</span><span class=\"p\">[</span><span class=\"n\">k</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">unique</span><span class=\"p\">(</span><span class=\"n\">v</span><span class=\"p\">[</span><span class=\"n\">selected_data_indices</span><span class=\"p\">],</span> <span class=\"n\">axis</span><span class=\"o\">=</span><span class=\"n\">axis</span><span class=\"p\">)</span>\n\n            <span class=\"n\">n_unique_properties</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">array</span><span class=\"p\">(</span>\n                <span class=\"p\">[</span><span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">v</span><span class=\"p\">)</span> <span class=\"k\">for</span> <span class=\"n\">v</span> <span class=\"ow\">in</span> <span class=\"n\">properties</span><span class=\"o\">.</span><span class=\"n\">values</span><span class=\"p\">()]</span>\n            <span class=\"p\">)</span>\n            <span class=\"k\">if</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">all</span><span class=\"p\">(</span><span class=\"n\">n_unique_properties</span> <span class=\"o\">==</span> <span class=\"mi\">1</span><span class=\"p\">):</span>\n                <span class=\"k\">with</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">block_update_properties</span><span class=\"p\">():</span>\n                    <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">current_properties</span> <span class=\"o\">=</span> <span class=\"n\">properties</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">_set_color</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">color</span><span class=\"p\">,</span> <span class=\"n\">attribute</span><span class=\"p\">:</span> <span class=\"nb\">str</span><span class=\"p\">):</span>\n        <span class=\"sd\">\"\"\"Set the face_color or edge_color property</span>\n\n<span class=\"sd\">        Parameters</span>\n<span class=\"sd\">        ----------</span>\n<span class=\"sd\">        color : (N, 4) array or str</span>\n<span class=\"sd\">            The value for setting edge or face_color</span>\n<span class=\"sd\">        attribute : str in {'edge', 'face'}</span>\n<span class=\"sd\">            The name of the attribute to set the color of.</span>\n<span class=\"sd\">            Should be 'edge' for edge_color or 'face' for face_color.</span>\n<span class=\"sd\">        \"\"\"</span>\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_is_color_mapped</span><span class=\"p\">(</span><span class=\"n\">color</span><span class=\"p\">):</span>\n            <span class=\"k\">if</span> <span class=\"n\">guess_continuous</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">properties</span><span class=\"p\">[</span><span class=\"n\">color</span><span class=\"p\">]):</span>\n                <span class=\"nb\">setattr</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">'_</span><span class=\"si\">{</span><span class=\"n\">attribute</span><span class=\"si\">}</span><span class=\"s1\">_color_mode'</span><span class=\"p\">,</span> <span class=\"n\">ColorMode</span><span class=\"o\">.</span><span class=\"n\">COLORMAP</span><span class=\"p\">)</span>\n            <span class=\"k\">else</span><span class=\"p\">:</span>\n                <span class=\"nb\">setattr</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">'_</span><span class=\"si\">{</span><span class=\"n\">attribute</span><span class=\"si\">}</span><span class=\"s1\">_color_mode'</span><span class=\"p\">,</span> <span class=\"n\">ColorMode</span><span class=\"o\">.</span><span class=\"n\">CYCLE</span><span class=\"p\">)</span>\n            <span class=\"nb\">setattr</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">'_</span><span class=\"si\">{</span><span class=\"n\">attribute</span><span class=\"si\">}</span><span class=\"s1\">_color_property'</span><span class=\"p\">,</span> <span class=\"n\">color</span><span class=\"p\">)</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">refresh_colors</span><span class=\"p\">()</span>\n\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"k\">if</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">data</span><span class=\"p\">)</span> <span class=\"o\">&gt;</span> <span class=\"mi\">0</span><span class=\"p\">:</span>\n                <span class=\"n\">transformed_color</span> <span class=\"o\">=</span> <span class=\"n\">transform_color_with_defaults</span><span class=\"p\">(</span>\n                    <span class=\"n\">num_entries</span><span class=\"o\">=</span><span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">data</span><span class=\"p\">),</span>\n                    <span class=\"n\">colors</span><span class=\"o\">=</span><span class=\"n\">color</span><span class=\"p\">,</span>\n                    <span class=\"n\">elem_name</span><span class=\"o\">=</span><span class=\"s2\">\"face_color\"</span><span class=\"p\">,</span>\n                    <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s2\">\"white\"</span><span class=\"p\">,</span>\n                <span class=\"p\">)</span>\n                <span class=\"n\">colors</span> <span class=\"o\">=</span> <span class=\"n\">normalize_and_broadcast_colors</span><span class=\"p\">(</span>\n                    <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">data</span><span class=\"p\">),</span> <span class=\"n\">transformed_color</span>\n                <span class=\"p\">)</span>\n            <span class=\"k\">else</span><span class=\"p\">:</span>\n                <span class=\"n\">colors</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">empty</span><span class=\"p\">((</span><span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">4</span><span class=\"p\">))</span>\n\n            <span class=\"nb\">setattr</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_data_view</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">'</span><span class=\"si\">{</span><span class=\"n\">attribute</span><span class=\"si\">}</span><span class=\"s1\">_color'</span><span class=\"p\">,</span> <span class=\"n\">colors</span><span class=\"p\">)</span>\n            <span class=\"nb\">setattr</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">'_</span><span class=\"si\">{</span><span class=\"n\">attribute</span><span class=\"si\">}</span><span class=\"s1\">_color_mode'</span><span class=\"p\">,</span> <span class=\"n\">ColorMode</span><span class=\"o\">.</span><span class=\"n\">DIRECT</span><span class=\"p\">)</span>\n\n            <span class=\"n\">color_event</span> <span class=\"o\">=</span> <span class=\"nb\">getattr</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">events</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">'</span><span class=\"si\">{</span><span class=\"n\">attribute</span><span class=\"si\">}</span><span class=\"s1\">_color'</span><span class=\"p\">)</span>\n            <span class=\"n\">color_event</span><span class=\"p\">()</span>\n\n<div class=\"viewcode-block\" id=\"Shapes.refresh_colors\"><a class=\"viewcode-back\" href=\"../../../../api/stable/napari.layers.Shapes.html#napari.layers.Shapes.refresh_colors\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">refresh_colors</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">update_color_mapping</span><span class=\"p\">:</span> <span class=\"nb\">bool</span> <span class=\"o\">=</span> <span class=\"kc\">False</span><span class=\"p\">):</span>\n        <span class=\"sd\">\"\"\"Calculate and update face and edge colors if using a cycle or color map</span>\n\n<span class=\"sd\">        Parameters</span>\n<span class=\"sd\">        ----------</span>\n<span class=\"sd\">        update_color_mapping : bool</span>\n<span class=\"sd\">            If set to True, the function will recalculate the color cycle map</span>\n<span class=\"sd\">            or colormap (whichever is being used). If set to False, the function</span>\n<span class=\"sd\">            will use the current color cycle map or color map. For example, if you</span>\n<span class=\"sd\">            are adding/modifying shapes and want them to be colored with the same</span>\n<span class=\"sd\">            mapping as the other shapes (i.e., the new shapes shouldn't affect</span>\n<span class=\"sd\">            the color cycle map or colormap), set update_color_mapping=False.</span>\n<span class=\"sd\">            Default value is False.</span>\n<span class=\"sd\">        \"\"\"</span>\n\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_refresh_color</span><span class=\"p\">(</span><span class=\"s1\">'face'</span><span class=\"p\">,</span> <span class=\"n\">update_color_mapping</span><span class=\"p\">)</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_refresh_color</span><span class=\"p\">(</span><span class=\"s1\">'edge'</span><span class=\"p\">,</span> <span class=\"n\">update_color_mapping</span><span class=\"p\">)</span></div>\n\n    <span class=\"k\">def</span> <span class=\"nf\">_refresh_color</span><span class=\"p\">(</span>\n        <span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">attribute</span><span class=\"p\">:</span> <span class=\"nb\">str</span><span class=\"p\">,</span> <span class=\"n\">update_color_mapping</span><span class=\"p\">:</span> <span class=\"nb\">bool</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n    <span class=\"p\">):</span>\n        <span class=\"sd\">\"\"\"Calculate and update face or edge colors if using a cycle or color map</span>\n\n<span class=\"sd\">        Parameters</span>\n<span class=\"sd\">        ----------</span>\n<span class=\"sd\">        attribute : str  in {'edge', 'face'}</span>\n<span class=\"sd\">            The name of the attribute to set the color of.</span>\n<span class=\"sd\">            Should be 'edge' for edge_color or 'face' for face_color.</span>\n<span class=\"sd\">        update_color_mapping : bool</span>\n<span class=\"sd\">            If set to True, the function will recalculate the color cycle map</span>\n<span class=\"sd\">            or colormap (whichever is being used). If set to False, the function</span>\n<span class=\"sd\">            will use the current color cycle map or color map. For example, if you</span>\n<span class=\"sd\">            are adding/modifying shapes and want them to be colored with the same</span>\n<span class=\"sd\">            mapping as the other shapes (i.e., the new shapes shouldn't affect</span>\n<span class=\"sd\">            the color cycle map or colormap), set update_color_mapping=False.</span>\n<span class=\"sd\">            Default value is False.</span>\n<span class=\"sd\">        \"\"\"</span>\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_update_properties</span><span class=\"p\">:</span>\n            <span class=\"n\">color_mode</span> <span class=\"o\">=</span> <span class=\"nb\">getattr</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">'_</span><span class=\"si\">{</span><span class=\"n\">attribute</span><span class=\"si\">}</span><span class=\"s1\">_color_mode'</span><span class=\"p\">)</span>\n            <span class=\"k\">if</span> <span class=\"n\">color_mode</span> <span class=\"ow\">in</span> <span class=\"p\">[</span><span class=\"n\">ColorMode</span><span class=\"o\">.</span><span class=\"n\">CYCLE</span><span class=\"p\">,</span> <span class=\"n\">ColorMode</span><span class=\"o\">.</span><span class=\"n\">COLORMAP</span><span class=\"p\">]:</span>\n                <span class=\"n\">colors</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_map_color</span><span class=\"p\">(</span><span class=\"n\">attribute</span><span class=\"p\">,</span> <span class=\"n\">update_color_mapping</span><span class=\"p\">)</span>\n                <span class=\"nb\">setattr</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_data_view</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">'</span><span class=\"si\">{</span><span class=\"n\">attribute</span><span class=\"si\">}</span><span class=\"s1\">_color'</span><span class=\"p\">,</span> <span class=\"n\">colors</span><span class=\"p\">)</span>\n\n                <span class=\"n\">color_event</span> <span class=\"o\">=</span> <span class=\"nb\">getattr</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">events</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">'</span><span class=\"si\">{</span><span class=\"n\">attribute</span><span class=\"si\">}</span><span class=\"s1\">_color'</span><span class=\"p\">)</span>\n                <span class=\"n\">color_event</span><span class=\"p\">()</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">_initialize_color</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">color</span><span class=\"p\">,</span> <span class=\"n\">attribute</span><span class=\"p\">:</span> <span class=\"nb\">str</span><span class=\"p\">,</span> <span class=\"n\">n_shapes</span><span class=\"p\">:</span> <span class=\"nb\">int</span><span class=\"p\">):</span>\n        <span class=\"sd\">\"\"\"Get the face/edge colors the Shapes layer will be initialized with</span>\n\n<span class=\"sd\">        Parameters</span>\n<span class=\"sd\">        ----------</span>\n<span class=\"sd\">        color : (N, 4) array or str</span>\n<span class=\"sd\">            The value for setting edge or face_color</span>\n<span class=\"sd\">        attribute : str in {'edge', 'face'}</span>\n<span class=\"sd\">            The name of the attribute to set the color of.</span>\n<span class=\"sd\">            Should be 'edge' for edge_color or 'face' for face_color.</span>\n\n<span class=\"sd\">        Returns</span>\n<span class=\"sd\">        -------</span>\n<span class=\"sd\">        init_colors : (N, 4) array or str</span>\n<span class=\"sd\">            The calculated values for setting edge or face_color</span>\n<span class=\"sd\">        \"\"\"</span>\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_is_color_mapped</span><span class=\"p\">(</span><span class=\"n\">color</span><span class=\"p\">):</span>\n            <span class=\"k\">if</span> <span class=\"n\">guess_continuous</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">properties</span><span class=\"p\">[</span><span class=\"n\">color</span><span class=\"p\">]):</span>\n                <span class=\"nb\">setattr</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">'_</span><span class=\"si\">{</span><span class=\"n\">attribute</span><span class=\"si\">}</span><span class=\"s1\">_color_mode'</span><span class=\"p\">,</span> <span class=\"n\">ColorMode</span><span class=\"o\">.</span><span class=\"n\">COLORMAP</span><span class=\"p\">)</span>\n            <span class=\"k\">else</span><span class=\"p\">:</span>\n                <span class=\"nb\">setattr</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">'_</span><span class=\"si\">{</span><span class=\"n\">attribute</span><span class=\"si\">}</span><span class=\"s1\">_color_mode'</span><span class=\"p\">,</span> <span class=\"n\">ColorMode</span><span class=\"o\">.</span><span class=\"n\">CYCLE</span><span class=\"p\">)</span>\n            <span class=\"nb\">setattr</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">'_</span><span class=\"si\">{</span><span class=\"n\">attribute</span><span class=\"si\">}</span><span class=\"s1\">_color_property'</span><span class=\"p\">,</span> <span class=\"n\">color</span><span class=\"p\">)</span>\n            <span class=\"n\">init_colors</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_map_color</span><span class=\"p\">(</span>\n                <span class=\"n\">attribute</span><span class=\"p\">,</span> <span class=\"n\">update_color_mapping</span><span class=\"o\">=</span><span class=\"kc\">False</span>\n            <span class=\"p\">)</span>\n\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"k\">if</span> <span class=\"n\">n_shapes</span> <span class=\"o\">&gt;</span> <span class=\"mi\">0</span><span class=\"p\">:</span>\n                <span class=\"n\">transformed_color</span> <span class=\"o\">=</span> <span class=\"n\">transform_color_with_defaults</span><span class=\"p\">(</span>\n                    <span class=\"n\">num_entries</span><span class=\"o\">=</span><span class=\"n\">n_shapes</span><span class=\"p\">,</span>\n                    <span class=\"n\">colors</span><span class=\"o\">=</span><span class=\"n\">color</span><span class=\"p\">,</span>\n                    <span class=\"n\">elem_name</span><span class=\"o\">=</span><span class=\"s2\">\"face_color\"</span><span class=\"p\">,</span>\n                    <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s2\">\"white\"</span><span class=\"p\">,</span>\n                <span class=\"p\">)</span>\n                <span class=\"n\">init_colors</span> <span class=\"o\">=</span> <span class=\"n\">normalize_and_broadcast_colors</span><span class=\"p\">(</span>\n                    <span class=\"n\">n_shapes</span><span class=\"p\">,</span> <span class=\"n\">transformed_color</span>\n                <span class=\"p\">)</span>\n            <span class=\"k\">else</span><span class=\"p\">:</span>\n                <span class=\"n\">init_colors</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">empty</span><span class=\"p\">((</span><span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">4</span><span class=\"p\">))</span>\n\n            <span class=\"nb\">setattr</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">'_</span><span class=\"si\">{</span><span class=\"n\">attribute</span><span class=\"si\">}</span><span class=\"s1\">_color_mode'</span><span class=\"p\">,</span> <span class=\"n\">ColorMode</span><span class=\"o\">.</span><span class=\"n\">DIRECT</span><span class=\"p\">)</span>\n\n        <span class=\"k\">return</span> <span class=\"n\">init_colors</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">_map_color</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">attribute</span><span class=\"p\">:</span> <span class=\"nb\">str</span><span class=\"p\">,</span> <span class=\"n\">update_color_mapping</span><span class=\"p\">:</span> <span class=\"nb\">bool</span> <span class=\"o\">=</span> <span class=\"kc\">False</span><span class=\"p\">):</span>\n        <span class=\"sd\">\"\"\"Calculate the mapping for face or edge colors if using a cycle or color map</span>\n\n<span class=\"sd\">        Parameters</span>\n<span class=\"sd\">        ----------</span>\n<span class=\"sd\">        attribute : str  in {'edge', 'face'}</span>\n<span class=\"sd\">            The name of the attribute to set the color of.</span>\n<span class=\"sd\">            Should be 'edge' for edge_color or 'face' for face_color.</span>\n<span class=\"sd\">        update_color_mapping : bool</span>\n<span class=\"sd\">            If set to True, the function will recalculate the color cycle map</span>\n<span class=\"sd\">            or colormap (whichever is being used). If set to False, the function</span>\n<span class=\"sd\">            will use the current color cycle map or color map. For example, if you</span>\n<span class=\"sd\">            are adding/modifying shapes and want them to be colored with the same</span>\n<span class=\"sd\">            mapping as the other shapes (i.e., the new shapes shouldn't affect</span>\n<span class=\"sd\">            the color cycle map or colormap), set update_color_mapping=False.</span>\n<span class=\"sd\">            Default value is False.</span>\n\n<span class=\"sd\">        Returns</span>\n<span class=\"sd\">        -------</span>\n<span class=\"sd\">        colors : (N, 4) array or str</span>\n<span class=\"sd\">            The calculated values for setting edge or face_color</span>\n<span class=\"sd\">        \"\"\"</span>\n        <span class=\"n\">color_mode</span> <span class=\"o\">=</span> <span class=\"nb\">getattr</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">'_</span><span class=\"si\">{</span><span class=\"n\">attribute</span><span class=\"si\">}</span><span class=\"s1\">_color_mode'</span><span class=\"p\">)</span>\n        <span class=\"k\">if</span> <span class=\"n\">color_mode</span> <span class=\"o\">==</span> <span class=\"n\">ColorMode</span><span class=\"o\">.</span><span class=\"n\">CYCLE</span><span class=\"p\">:</span>\n            <span class=\"n\">color_property</span> <span class=\"o\">=</span> <span class=\"nb\">getattr</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">'_</span><span class=\"si\">{</span><span class=\"n\">attribute</span><span class=\"si\">}</span><span class=\"s1\">_color_property'</span><span class=\"p\">)</span>\n            <span class=\"n\">color_properties</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">properties</span><span class=\"p\">[</span><span class=\"n\">color_property</span><span class=\"p\">]</span>\n            <span class=\"k\">if</span> <span class=\"n\">update_color_mapping</span><span class=\"p\">:</span>\n                <span class=\"n\">color_cycle</span> <span class=\"o\">=</span> <span class=\"nb\">getattr</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">'_</span><span class=\"si\">{</span><span class=\"n\">attribute</span><span class=\"si\">}</span><span class=\"s1\">_color_cycle'</span><span class=\"p\">)</span>\n                <span class=\"n\">color_cycle_map</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n                    <span class=\"n\">k</span><span class=\"p\">:</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">squeeze</span><span class=\"p\">(</span><span class=\"n\">transform_color</span><span class=\"p\">(</span><span class=\"n\">c</span><span class=\"p\">))</span>\n                    <span class=\"k\">for</span> <span class=\"n\">k</span><span class=\"p\">,</span> <span class=\"n\">c</span> <span class=\"ow\">in</span> <span class=\"nb\">zip</span><span class=\"p\">(</span><span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">unique</span><span class=\"p\">(</span><span class=\"n\">color_properties</span><span class=\"p\">),</span> <span class=\"n\">color_cycle</span><span class=\"p\">)</span>\n                <span class=\"p\">}</span>\n                <span class=\"nb\">setattr</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">'</span><span class=\"si\">{</span><span class=\"n\">attribute</span><span class=\"si\">}</span><span class=\"s1\">_color_cycle_map'</span><span class=\"p\">,</span> <span class=\"n\">color_cycle_map</span><span class=\"p\">)</span>\n\n            <span class=\"k\">else</span><span class=\"p\">:</span>\n                <span class=\"c1\"># add properties if they are not in the colormap</span>\n                <span class=\"c1\"># and update_color_mapping==False</span>\n                <span class=\"n\">color_cycle_map</span> <span class=\"o\">=</span> <span class=\"nb\">getattr</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">'</span><span class=\"si\">{</span><span class=\"n\">attribute</span><span class=\"si\">}</span><span class=\"s1\">_color_cycle_map'</span><span class=\"p\">)</span>\n                <span class=\"n\">color_cycle_keys</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"o\">*</span><span class=\"n\">color_cycle_map</span><span class=\"p\">]</span>\n                <span class=\"n\">props_in_map</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">in1d</span><span class=\"p\">(</span><span class=\"n\">color_properties</span><span class=\"p\">,</span> <span class=\"n\">color_cycle_keys</span><span class=\"p\">)</span>\n                <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">all</span><span class=\"p\">(</span><span class=\"n\">props_in_map</span><span class=\"p\">):</span>\n                    <span class=\"n\">props_to_add</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">unique</span><span class=\"p\">(</span>\n                        <span class=\"n\">color_properties</span><span class=\"p\">[</span><span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">logical_not</span><span class=\"p\">(</span><span class=\"n\">props_in_map</span><span class=\"p\">)]</span>\n                    <span class=\"p\">)</span>\n                    <span class=\"n\">color_cycle</span> <span class=\"o\">=</span> <span class=\"nb\">getattr</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">'_</span><span class=\"si\">{</span><span class=\"n\">attribute</span><span class=\"si\">}</span><span class=\"s1\">_color_cycle'</span><span class=\"p\">)</span>\n                    <span class=\"k\">for</span> <span class=\"n\">prop</span> <span class=\"ow\">in</span> <span class=\"n\">props_to_add</span><span class=\"p\">:</span>\n                        <span class=\"n\">color_cycle_map</span><span class=\"p\">[</span><span class=\"n\">prop</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">squeeze</span><span class=\"p\">(</span>\n                            <span class=\"n\">transform_color</span><span class=\"p\">(</span><span class=\"nb\">next</span><span class=\"p\">(</span><span class=\"n\">color_cycle</span><span class=\"p\">))</span>\n                        <span class=\"p\">)</span>\n                    <span class=\"nb\">setattr</span><span class=\"p\">(</span>\n                        <span class=\"bp\">self</span><span class=\"p\">,</span>\n                        <span class=\"sa\">f</span><span class=\"s1\">'</span><span class=\"si\">{</span><span class=\"n\">attribute</span><span class=\"si\">}</span><span class=\"s1\">_color_cycle_map'</span><span class=\"p\">,</span>\n                        <span class=\"n\">color_cycle_map</span><span class=\"p\">,</span>\n                    <span class=\"p\">)</span>\n            <span class=\"n\">colors</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">array</span><span class=\"p\">([</span><span class=\"n\">color_cycle_map</span><span class=\"p\">[</span><span class=\"n\">x</span><span class=\"p\">]</span> <span class=\"k\">for</span> <span class=\"n\">x</span> <span class=\"ow\">in</span> <span class=\"n\">color_properties</span><span class=\"p\">])</span>\n            <span class=\"k\">if</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">colors</span><span class=\"p\">)</span> <span class=\"o\">==</span> <span class=\"mi\">0</span><span class=\"p\">:</span>\n                <span class=\"n\">colors</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">empty</span><span class=\"p\">((</span><span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">4</span><span class=\"p\">))</span>\n\n        <span class=\"k\">elif</span> <span class=\"n\">color_mode</span> <span class=\"o\">==</span> <span class=\"n\">ColorMode</span><span class=\"o\">.</span><span class=\"n\">COLORMAP</span><span class=\"p\">:</span>\n            <span class=\"n\">color_property</span> <span class=\"o\">=</span> <span class=\"nb\">getattr</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">'_</span><span class=\"si\">{</span><span class=\"n\">attribute</span><span class=\"si\">}</span><span class=\"s1\">_color_property'</span><span class=\"p\">)</span>\n            <span class=\"n\">color_properties</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">properties</span><span class=\"p\">[</span><span class=\"n\">color_property</span><span class=\"p\">]</span>\n            <span class=\"k\">if</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">color_properties</span><span class=\"p\">)</span> <span class=\"o\">&gt;</span> <span class=\"mi\">0</span><span class=\"p\">:</span>\n                <span class=\"n\">contrast_limits</span> <span class=\"o\">=</span> <span class=\"nb\">getattr</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">'</span><span class=\"si\">{</span><span class=\"n\">attribute</span><span class=\"si\">}</span><span class=\"s1\">_contrast_limits'</span><span class=\"p\">)</span>\n                <span class=\"n\">colormap</span> <span class=\"o\">=</span> <span class=\"nb\">getattr</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">'</span><span class=\"si\">{</span><span class=\"n\">attribute</span><span class=\"si\">}</span><span class=\"s1\">_colormap'</span><span class=\"p\">)</span>\n                <span class=\"k\">if</span> <span class=\"n\">update_color_mapping</span> <span class=\"ow\">or</span> <span class=\"n\">contrast_limits</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n\n                    <span class=\"n\">colors</span><span class=\"p\">,</span> <span class=\"n\">contrast_limits</span> <span class=\"o\">=</span> <span class=\"n\">map_property</span><span class=\"p\">(</span>\n                        <span class=\"n\">prop</span><span class=\"o\">=</span><span class=\"n\">color_properties</span><span class=\"p\">,</span> <span class=\"n\">colormap</span><span class=\"o\">=</span><span class=\"n\">colormap</span>\n                    <span class=\"p\">)</span>\n                    <span class=\"nb\">setattr</span><span class=\"p\">(</span>\n                        <span class=\"bp\">self</span><span class=\"p\">,</span>\n                        <span class=\"sa\">f</span><span class=\"s1\">'</span><span class=\"si\">{</span><span class=\"n\">attribute</span><span class=\"si\">}</span><span class=\"s1\">_contrast_limits'</span><span class=\"p\">,</span>\n                        <span class=\"n\">contrast_limits</span><span class=\"p\">,</span>\n                    <span class=\"p\">)</span>\n                <span class=\"k\">else</span><span class=\"p\">:</span>\n\n                    <span class=\"n\">colors</span><span class=\"p\">,</span> <span class=\"n\">_</span> <span class=\"o\">=</span> <span class=\"n\">map_property</span><span class=\"p\">(</span>\n                        <span class=\"n\">prop</span><span class=\"o\">=</span><span class=\"n\">color_properties</span><span class=\"p\">,</span>\n                        <span class=\"n\">colormap</span><span class=\"o\">=</span><span class=\"n\">colormap</span><span class=\"p\">,</span>\n                        <span class=\"n\">contrast_limits</span><span class=\"o\">=</span><span class=\"n\">contrast_limits</span><span class=\"p\">,</span>\n                    <span class=\"p\">)</span>\n            <span class=\"k\">else</span><span class=\"p\">:</span>\n                <span class=\"n\">colors</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">empty</span><span class=\"p\">((</span><span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">4</span><span class=\"p\">))</span>\n\n        <span class=\"k\">return</span> <span class=\"n\">colors</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">_get_new_shape_color</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">adding</span><span class=\"p\">:</span> <span class=\"nb\">int</span><span class=\"p\">,</span> <span class=\"n\">attribute</span><span class=\"p\">:</span> <span class=\"nb\">str</span><span class=\"p\">):</span>\n        <span class=\"sd\">\"\"\"Get the color for the shape(s) to be added.</span>\n\n<span class=\"sd\">        Parameters</span>\n<span class=\"sd\">        ----------</span>\n<span class=\"sd\">        adding : int</span>\n<span class=\"sd\">            the number of shapes that were added</span>\n<span class=\"sd\">            (and thus the number of color entries to add)</span>\n<span class=\"sd\">        attribute : str in {'edge', 'face'}</span>\n<span class=\"sd\">            The name of the attribute to set the color of.</span>\n<span class=\"sd\">            Should be 'edge' for edge_color_mode or 'face' for face_color_mode.</span>\n\n<span class=\"sd\">        Returns</span>\n<span class=\"sd\">        -------</span>\n<span class=\"sd\">        new_colors : (N, 4) array</span>\n<span class=\"sd\">            (Nx4) RGBA array of colors for the N new shapes</span>\n<span class=\"sd\">        \"\"\"</span>\n        <span class=\"n\">color_mode</span> <span class=\"o\">=</span> <span class=\"nb\">getattr</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">'_</span><span class=\"si\">{</span><span class=\"n\">attribute</span><span class=\"si\">}</span><span class=\"s1\">_color_mode'</span><span class=\"p\">)</span>\n        <span class=\"k\">if</span> <span class=\"n\">color_mode</span> <span class=\"o\">==</span> <span class=\"n\">ColorMode</span><span class=\"o\">.</span><span class=\"n\">DIRECT</span><span class=\"p\">:</span>\n            <span class=\"n\">current_face_color</span> <span class=\"o\">=</span> <span class=\"nb\">getattr</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">'_current_</span><span class=\"si\">{</span><span class=\"n\">attribute</span><span class=\"si\">}</span><span class=\"s1\">_color'</span><span class=\"p\">)</span>\n            <span class=\"n\">new_colors</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">tile</span><span class=\"p\">(</span><span class=\"n\">current_face_color</span><span class=\"p\">,</span> <span class=\"p\">(</span><span class=\"n\">adding</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">))</span>\n        <span class=\"k\">elif</span> <span class=\"n\">color_mode</span> <span class=\"o\">==</span> <span class=\"n\">ColorMode</span><span class=\"o\">.</span><span class=\"n\">CYCLE</span><span class=\"p\">:</span>\n            <span class=\"n\">property_name</span> <span class=\"o\">=</span> <span class=\"nb\">getattr</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">'_</span><span class=\"si\">{</span><span class=\"n\">attribute</span><span class=\"si\">}</span><span class=\"s1\">_color_property'</span><span class=\"p\">)</span>\n            <span class=\"n\">color_property_value</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">current_properties</span><span class=\"p\">[</span><span class=\"n\">property_name</span><span class=\"p\">][</span><span class=\"mi\">0</span><span class=\"p\">]</span>\n\n            <span class=\"c1\"># check if the new color property is in the cycle map</span>\n            <span class=\"c1\"># and add it if it is not</span>\n            <span class=\"n\">color_cycle_map</span> <span class=\"o\">=</span> <span class=\"nb\">getattr</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">'</span><span class=\"si\">{</span><span class=\"n\">attribute</span><span class=\"si\">}</span><span class=\"s1\">_color_cycle_map'</span><span class=\"p\">)</span>\n            <span class=\"n\">color_cycle_keys</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"o\">*</span><span class=\"n\">color_cycle_map</span><span class=\"p\">]</span>\n            <span class=\"k\">if</span> <span class=\"n\">color_property_value</span> <span class=\"ow\">not</span> <span class=\"ow\">in</span> <span class=\"n\">color_cycle_keys</span><span class=\"p\">:</span>\n                <span class=\"n\">color_cycle</span> <span class=\"o\">=</span> <span class=\"nb\">getattr</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">'_</span><span class=\"si\">{</span><span class=\"n\">attribute</span><span class=\"si\">}</span><span class=\"s1\">_color_cycle'</span><span class=\"p\">)</span>\n                <span class=\"n\">color_cycle_map</span><span class=\"p\">[</span><span class=\"n\">color_property_value</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">squeeze</span><span class=\"p\">(</span>\n                    <span class=\"n\">transform_color</span><span class=\"p\">(</span><span class=\"nb\">next</span><span class=\"p\">(</span><span class=\"n\">color_cycle</span><span class=\"p\">))</span>\n                <span class=\"p\">)</span>\n\n                <span class=\"nb\">setattr</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">'</span><span class=\"si\">{</span><span class=\"n\">attribute</span><span class=\"si\">}</span><span class=\"s1\">_color_cycle_map'</span><span class=\"p\">,</span> <span class=\"n\">color_cycle_map</span><span class=\"p\">)</span>\n\n            <span class=\"n\">new_colors</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">tile</span><span class=\"p\">(</span>\n                <span class=\"n\">color_cycle_map</span><span class=\"p\">[</span><span class=\"n\">color_property_value</span><span class=\"p\">],</span> <span class=\"p\">(</span><span class=\"n\">adding</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">)</span>\n            <span class=\"p\">)</span>\n        <span class=\"k\">elif</span> <span class=\"n\">color_mode</span> <span class=\"o\">==</span> <span class=\"n\">ColorMode</span><span class=\"o\">.</span><span class=\"n\">COLORMAP</span><span class=\"p\">:</span>\n            <span class=\"n\">property_name</span> <span class=\"o\">=</span> <span class=\"nb\">getattr</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">'_</span><span class=\"si\">{</span><span class=\"n\">attribute</span><span class=\"si\">}</span><span class=\"s1\">_color_property'</span><span class=\"p\">)</span>\n            <span class=\"n\">color_property_value</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">current_properties</span><span class=\"p\">[</span><span class=\"n\">property_name</span><span class=\"p\">][</span><span class=\"mi\">0</span><span class=\"p\">]</span>\n            <span class=\"n\">colormap</span> <span class=\"o\">=</span> <span class=\"nb\">getattr</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">'</span><span class=\"si\">{</span><span class=\"n\">attribute</span><span class=\"si\">}</span><span class=\"s1\">_colormap'</span><span class=\"p\">)</span>\n            <span class=\"n\">contrast_limits</span> <span class=\"o\">=</span> <span class=\"nb\">getattr</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"sa\">f</span><span class=\"s1\">'_</span><span class=\"si\">{</span><span class=\"n\">attribute</span><span class=\"si\">}</span><span class=\"s1\">_contrast_limits'</span><span class=\"p\">)</span>\n\n            <span class=\"n\">fc</span><span class=\"p\">,</span> <span class=\"n\">_</span> <span class=\"o\">=</span> <span class=\"n\">map_property</span><span class=\"p\">(</span>\n                <span class=\"n\">prop</span><span class=\"o\">=</span><span class=\"n\">color_property_value</span><span class=\"p\">,</span>\n                <span class=\"n\">colormap</span><span class=\"o\">=</span><span class=\"n\">colormap</span><span class=\"p\">,</span>\n                <span class=\"n\">contrast_limits</span><span class=\"o\">=</span><span class=\"n\">contrast_limits</span><span class=\"p\">,</span>\n            <span class=\"p\">)</span>\n            <span class=\"n\">new_colors</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">tile</span><span class=\"p\">(</span><span class=\"n\">fc</span><span class=\"p\">,</span> <span class=\"p\">(</span><span class=\"n\">adding</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">))</span>\n\n        <span class=\"k\">return</span> <span class=\"n\">new_colors</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">_is_color_mapped</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">color</span><span class=\"p\">):</span>\n        <span class=\"sd\">\"\"\"determines if the new color argument is for directly setting or cycle/colormap\"\"\"</span>\n        <span class=\"k\">if</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">color</span><span class=\"p\">,</span> <span class=\"nb\">str</span><span class=\"p\">):</span>\n            <span class=\"k\">if</span> <span class=\"n\">color</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">properties</span><span class=\"p\">:</span>\n                <span class=\"k\">return</span> <span class=\"kc\">True</span>\n            <span class=\"k\">else</span><span class=\"p\">:</span>\n                <span class=\"k\">return</span> <span class=\"kc\">False</span>\n        <span class=\"k\">elif</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">color</span><span class=\"p\">,</span> <span class=\"p\">(</span><span class=\"nb\">list</span><span class=\"p\">,</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">ndarray</span><span class=\"p\">)):</span>\n            <span class=\"k\">return</span> <span class=\"kc\">False</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"k\">raise</span> <span class=\"ne\">ValueError</span><span class=\"p\">(</span>\n                <span class=\"n\">trans</span><span class=\"o\">.</span><span class=\"n\">_</span><span class=\"p\">(</span>\n                    <span class=\"s1\">'face_color should be the name of a color, an array of colors, or the name of an property'</span><span class=\"p\">,</span>\n                    <span class=\"n\">deferred</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">,</span>\n                <span class=\"p\">)</span>\n            <span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">_get_state</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"sd\">\"\"\"Get dictionary of layer state.</span>\n\n<span class=\"sd\">        Returns</span>\n<span class=\"sd\">        -------</span>\n<span class=\"sd\">        state : dict</span>\n<span class=\"sd\">            Dictionary of layer state.</span>\n<span class=\"sd\">        \"\"\"</span>\n        <span class=\"n\">state</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_get_base_state</span><span class=\"p\">()</span>\n        <span class=\"n\">state</span><span class=\"o\">.</span><span class=\"n\">update</span><span class=\"p\">(</span>\n            <span class=\"p\">{</span>\n                <span class=\"s1\">'ndim'</span><span class=\"p\">:</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">ndim</span><span class=\"p\">,</span>\n                <span class=\"s1\">'properties'</span><span class=\"p\">:</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">properties</span><span class=\"p\">,</span>\n                <span class=\"s1\">'property_choices'</span><span class=\"p\">:</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_property_choices</span><span class=\"p\">,</span>\n                <span class=\"s1\">'text'</span><span class=\"p\">:</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">text</span><span class=\"o\">.</span><span class=\"n\">dict</span><span class=\"p\">(),</span>\n                <span class=\"s1\">'shape_type'</span><span class=\"p\">:</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">shape_type</span><span class=\"p\">,</span>\n                <span class=\"s1\">'opacity'</span><span class=\"p\">:</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">opacity</span><span class=\"p\">,</span>\n                <span class=\"s1\">'z_index'</span><span class=\"p\">:</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">z_index</span><span class=\"p\">,</span>\n                <span class=\"s1\">'edge_width'</span><span class=\"p\">:</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">edge_width</span><span class=\"p\">,</span>\n                <span class=\"s1\">'face_color'</span><span class=\"p\">:</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">face_color</span><span class=\"p\">,</span>\n                <span class=\"s1\">'face_color_cycle'</span><span class=\"p\">:</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">face_color_cycle</span><span class=\"p\">,</span>\n                <span class=\"s1\">'face_colormap'</span><span class=\"p\">:</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">face_colormap</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span>\n                <span class=\"s1\">'face_contrast_limits'</span><span class=\"p\">:</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">face_contrast_limits</span><span class=\"p\">,</span>\n                <span class=\"s1\">'edge_color'</span><span class=\"p\">:</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">edge_color</span><span class=\"p\">,</span>\n                <span class=\"s1\">'edge_color_cycle'</span><span class=\"p\">:</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">edge_color_cycle</span><span class=\"p\">,</span>\n                <span class=\"s1\">'edge_colormap'</span><span class=\"p\">:</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">edge_colormap</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span>\n                <span class=\"s1\">'edge_contrast_limits'</span><span class=\"p\">:</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">edge_contrast_limits</span><span class=\"p\">,</span>\n                <span class=\"s1\">'data'</span><span class=\"p\">:</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">data</span><span class=\"p\">,</span>\n            <span class=\"p\">}</span>\n        <span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">state</span>\n\n    <span class=\"nd\">@property</span>\n    <span class=\"k\">def</span> <span class=\"nf\">_indices_view</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">where</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_data_view</span><span class=\"o\">.</span><span class=\"n\">_displayed</span><span class=\"p\">)[</span><span class=\"mi\">0</span><span class=\"p\">]</span>\n\n    <span class=\"nd\">@property</span>\n    <span class=\"k\">def</span> <span class=\"nf\">_view_text</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">)</span> <span class=\"o\">-&gt;</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">ndarray</span><span class=\"p\">:</span>\n        <span class=\"sd\">\"\"\"Get the values of the text elements in view</span>\n\n<span class=\"sd\">        Returns</span>\n<span class=\"sd\">        -------</span>\n<span class=\"sd\">        text : (N x 1) np.ndarray</span>\n<span class=\"sd\">            Array of text strings for the N text elements in view</span>\n<span class=\"sd\">        \"\"\"</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">text</span><span class=\"o\">.</span><span class=\"n\">view_text</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_indices_view</span><span class=\"p\">)</span>\n\n    <span class=\"nd\">@property</span>\n    <span class=\"k\">def</span> <span class=\"nf\">_view_text_coords</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">)</span> <span class=\"o\">-&gt;</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">ndarray</span><span class=\"p\">:</span>\n        <span class=\"sd\">\"\"\"Get the coordinates of the text elements in view</span>\n\n<span class=\"sd\">        Returns</span>\n<span class=\"sd\">        -------</span>\n<span class=\"sd\">        text_coords : (N x D) np.ndarray</span>\n<span class=\"sd\">            Array of coordinates for the N text elements in view</span>\n<span class=\"sd\">        \"\"\"</span>\n        <span class=\"c1\"># get the coordinates of the vertices for the shapes in view</span>\n        <span class=\"n\">in_view_shapes_coords</span> <span class=\"o\">=</span> <span class=\"p\">[</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_data_view</span><span class=\"o\">.</span><span class=\"n\">data</span><span class=\"p\">[</span><span class=\"n\">i</span><span class=\"p\">]</span> <span class=\"k\">for</span> <span class=\"n\">i</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_indices_view</span>\n        <span class=\"p\">]</span>\n\n        <span class=\"c1\"># get the coordinates for the dimensions being displayed</span>\n        <span class=\"n\">sliced_in_view_coords</span> <span class=\"o\">=</span> <span class=\"p\">[</span>\n            <span class=\"n\">position</span><span class=\"p\">[:,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_dims_displayed</span><span class=\"p\">]</span>\n            <span class=\"k\">for</span> <span class=\"n\">position</span> <span class=\"ow\">in</span> <span class=\"n\">in_view_shapes_coords</span>\n        <span class=\"p\">]</span>\n\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">text</span><span class=\"o\">.</span><span class=\"n\">compute_text_coords</span><span class=\"p\">(</span>\n            <span class=\"n\">sliced_in_view_coords</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_ndisplay</span>\n        <span class=\"p\">)</span>\n\n    <span class=\"nd\">@property</span>\n    <span class=\"k\">def</span> <span class=\"nf\">mode</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"sd\">\"\"\"MODE: Interactive mode. The normal, default mode is PAN_ZOOM, which</span>\n<span class=\"sd\">        allows for normal interactivity with the canvas.</span>\n\n<span class=\"sd\">        The SELECT mode allows for entire shapes to be selected, moved and</span>\n<span class=\"sd\">        resized.</span>\n\n<span class=\"sd\">        The DIRECT mode allows for shapes to be selected and their individual</span>\n<span class=\"sd\">        vertices to be moved.</span>\n\n<span class=\"sd\">        The VERTEX_INSERT and VERTEX_REMOVE modes allow for individual</span>\n<span class=\"sd\">        vertices either to be added to or removed from shapes that are already</span>\n<span class=\"sd\">        selected. Note that shapes cannot be selected in this mode.</span>\n\n<span class=\"sd\">        The ADD_RECTANGLE, ADD_ELLIPSE, ADD_LINE, ADD_PATH, and ADD_POLYGON</span>\n<span class=\"sd\">        modes all allow for their corresponding shape type to be added.</span>\n<span class=\"sd\">        \"\"\"</span>\n        <span class=\"k\">return</span> <span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_mode</span><span class=\"p\">)</span>\n\n    <span class=\"nd\">@mode</span><span class=\"o\">.</span><span class=\"n\">setter</span>\n    <span class=\"k\">def</span> <span class=\"nf\">mode</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">mode</span><span class=\"p\">:</span> <span class=\"n\">Union</span><span class=\"p\">[</span><span class=\"nb\">str</span><span class=\"p\">,</span> <span class=\"n\">Mode</span><span class=\"p\">]):</span>\n        <span class=\"n\">old_mode</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_mode</span>\n        <span class=\"n\">mode</span><span class=\"p\">,</span> <span class=\"n\">changed</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_mode_setter_helper</span><span class=\"p\">(</span><span class=\"n\">mode</span><span class=\"p\">,</span> <span class=\"n\">Mode</span><span class=\"p\">)</span>\n        <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">changed</span><span class=\"p\">:</span>\n            <span class=\"k\">return</span>\n\n        <span class=\"k\">if</span> <span class=\"n\">mode</span><span class=\"o\">.</span><span class=\"n\">value</span> <span class=\"ow\">not</span> <span class=\"ow\">in</span> <span class=\"n\">Mode</span><span class=\"o\">.</span><span class=\"n\">keys</span><span class=\"p\">():</span>\n            <span class=\"k\">raise</span> <span class=\"ne\">ValueError</span><span class=\"p\">(</span>\n                <span class=\"n\">trans</span><span class=\"o\">.</span><span class=\"n\">_</span><span class=\"p\">(</span>\n                    <span class=\"s2\">\"Mode not recognized: </span><span class=\"si\">{mode}</span><span class=\"s2\">\"</span><span class=\"p\">,</span> <span class=\"n\">deferred</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">,</span> <span class=\"n\">mode</span><span class=\"o\">=</span><span class=\"n\">mode</span>\n                <span class=\"p\">)</span>\n            <span class=\"p\">)</span>\n\n        <span class=\"n\">old_mode</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_mode</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_mode</span> <span class=\"o\">=</span> <span class=\"n\">mode</span>\n\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">help</span> <span class=\"o\">=</span> <span class=\"n\">_FWD_SHAPE_HELP</span><span class=\"p\">[</span><span class=\"n\">mode</span><span class=\"p\">]</span>\n\n        <span class=\"n\">draw_modes</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n            <span class=\"n\">Mode</span><span class=\"o\">.</span><span class=\"n\">SELECT</span><span class=\"p\">,</span>\n            <span class=\"n\">Mode</span><span class=\"o\">.</span><span class=\"n\">DIRECT</span><span class=\"p\">,</span>\n            <span class=\"n\">Mode</span><span class=\"o\">.</span><span class=\"n\">VERTEX_INSERT</span><span class=\"p\">,</span>\n            <span class=\"n\">Mode</span><span class=\"o\">.</span><span class=\"n\">VERTEX_REMOVE</span><span class=\"p\">,</span>\n        <span class=\"p\">}</span>\n\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">events</span><span class=\"o\">.</span><span class=\"n\">mode</span><span class=\"p\">(</span><span class=\"n\">mode</span><span class=\"o\">=</span><span class=\"n\">mode</span><span class=\"p\">)</span>\n\n        <span class=\"c1\"># don't update thumbnail on mode changes</span>\n        <span class=\"k\">with</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">block_thumbnail_update</span><span class=\"p\">():</span>\n            <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"p\">(</span><span class=\"n\">mode</span> <span class=\"ow\">in</span> <span class=\"n\">draw_modes</span> <span class=\"ow\">and</span> <span class=\"n\">old_mode</span> <span class=\"ow\">in</span> <span class=\"n\">draw_modes</span><span class=\"p\">):</span>\n                <span class=\"c1\"># Shapes._finish_drawing() calls Shapes.refresh()</span>\n                <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_finish_drawing</span><span class=\"p\">()</span>\n            <span class=\"k\">else</span><span class=\"p\">:</span>\n                <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">refresh</span><span class=\"p\">()</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">_set_editable</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">editable</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n        <span class=\"sd\">\"\"\"Set editable mode based on layer properties.\"\"\"</span>\n        <span class=\"k\">if</span> <span class=\"n\">editable</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n            <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_ndisplay</span> <span class=\"o\">==</span> <span class=\"mi\">3</span><span class=\"p\">:</span>\n                <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">editable</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n            <span class=\"k\">else</span><span class=\"p\">:</span>\n                <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">editable</span> <span class=\"o\">=</span> <span class=\"kc\">True</span>\n\n        <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">editable</span><span class=\"p\">:</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">mode</span> <span class=\"o\">=</span> <span class=\"n\">Mode</span><span class=\"o\">.</span><span class=\"n\">PAN_ZOOM</span>\n\n<div class=\"viewcode-block\" id=\"Shapes.add_rectangles\"><a class=\"viewcode-back\" href=\"../../../../api/stable/napari.layers.Shapes.html#napari.layers.Shapes.add_rectangles\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">add_rectangles</span><span class=\"p\">(</span>\n        <span class=\"bp\">self</span><span class=\"p\">,</span>\n        <span class=\"n\">data</span><span class=\"p\">,</span>\n        <span class=\"o\">*</span><span class=\"p\">,</span>\n        <span class=\"n\">edge_width</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">edge_color</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">face_color</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">z_index</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"p\">):</span>\n        <span class=\"sd\">\"\"\"Add rectangles to the current layer.</span>\n\n<span class=\"sd\">        Parameters</span>\n<span class=\"sd\">        ----------</span>\n<span class=\"sd\">        data : Array | List[Array]</span>\n<span class=\"sd\">            List of rectangle data where each element is a (4, D) array of 4 vertices</span>\n<span class=\"sd\">            in D dimensions, or a (2, D) array of 2 vertices in D dimensions, where</span>\n<span class=\"sd\">            the vertices are top-left and bottom-right corners.</span>\n<span class=\"sd\">            Can be a 3-dimensional array for multiple shapes, or list of 2 or 4</span>\n<span class=\"sd\">            vertices for a single shape.</span>\n<span class=\"sd\">        edge_width : float | list</span>\n<span class=\"sd\">            thickness of lines and edges. If a list is supplied it must be the</span>\n<span class=\"sd\">            same length as the length of `data` and each element will be</span>\n<span class=\"sd\">            applied to each shape otherwise the same value will be used for all</span>\n<span class=\"sd\">            shapes.</span>\n<span class=\"sd\">        edge_color : str | tuple | list</span>\n<span class=\"sd\">            If string can be any color name recognized by vispy or hex value if</span>\n<span class=\"sd\">            starting with `#`. If array-like must be 1-dimensional array with 3</span>\n<span class=\"sd\">            or 4 elements. If a list is supplied it must be the same length as</span>\n<span class=\"sd\">            the length of `data` and each element will be applied to each shape</span>\n<span class=\"sd\">            otherwise the same value will be used for all shapes.</span>\n<span class=\"sd\">        face_color : str | tuple | list</span>\n<span class=\"sd\">            If string can be any color name recognized by vispy or hex value if</span>\n<span class=\"sd\">            starting with `#`. If array-like must be 1-dimensional array with 3</span>\n<span class=\"sd\">            or 4 elements. If a list is supplied it must be the same length as</span>\n<span class=\"sd\">            the length of `data` and each element will be applied to each shape</span>\n<span class=\"sd\">            otherwise the same value will be used for all shapes.</span>\n<span class=\"sd\">        z_index : int | list</span>\n<span class=\"sd\">            Specifier of z order priority. Shapes with higher z order are</span>\n<span class=\"sd\">            displayed ontop of others. If a list is supplied it must be the</span>\n<span class=\"sd\">            same length as the length of `data` and each element will be</span>\n<span class=\"sd\">            applied to each shape otherwise the same value will be used for all</span>\n<span class=\"sd\">            shapes.</span>\n<span class=\"sd\">        \"\"\"</span>\n        <span class=\"c1\"># rectangles can have either 4 vertices or (top left, bottom right)</span>\n        <span class=\"n\">valid_vertices_per_shape</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"mi\">2</span><span class=\"p\">,</span> <span class=\"mi\">4</span><span class=\"p\">)</span>\n        <span class=\"n\">validate_num_vertices</span><span class=\"p\">(</span>\n            <span class=\"n\">data</span><span class=\"p\">,</span> <span class=\"s1\">'rectangle'</span><span class=\"p\">,</span> <span class=\"n\">valid_vertices</span><span class=\"o\">=</span><span class=\"n\">valid_vertices_per_shape</span>\n        <span class=\"p\">)</span>\n\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span>\n            <span class=\"n\">data</span><span class=\"p\">,</span>\n            <span class=\"n\">shape_type</span><span class=\"o\">=</span><span class=\"s1\">'rectangle'</span><span class=\"p\">,</span>\n            <span class=\"n\">edge_width</span><span class=\"o\">=</span><span class=\"n\">edge_width</span><span class=\"p\">,</span>\n            <span class=\"n\">edge_color</span><span class=\"o\">=</span><span class=\"n\">edge_color</span><span class=\"p\">,</span>\n            <span class=\"n\">face_color</span><span class=\"o\">=</span><span class=\"n\">face_color</span><span class=\"p\">,</span>\n            <span class=\"n\">z_index</span><span class=\"o\">=</span><span class=\"n\">z_index</span><span class=\"p\">,</span>\n        <span class=\"p\">)</span></div>\n\n<div class=\"viewcode-block\" id=\"Shapes.add_ellipses\"><a class=\"viewcode-back\" href=\"../../../../api/stable/napari.layers.Shapes.html#napari.layers.Shapes.add_ellipses\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">add_ellipses</span><span class=\"p\">(</span>\n        <span class=\"bp\">self</span><span class=\"p\">,</span>\n        <span class=\"n\">data</span><span class=\"p\">,</span>\n        <span class=\"o\">*</span><span class=\"p\">,</span>\n        <span class=\"n\">edge_width</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">edge_color</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">face_color</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">z_index</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"p\">):</span>\n        <span class=\"sd\">\"\"\"Add ellipses to the current layer.</span>\n\n<span class=\"sd\">        Parameters</span>\n<span class=\"sd\">        ----------</span>\n<span class=\"sd\">        data : Array | List[Array]</span>\n<span class=\"sd\">            List of ellipse data where each element is a (4, D) array of 4 vertices</span>\n<span class=\"sd\">            in D dimensions representing a bounding box, or a (2, D) array of</span>\n<span class=\"sd\">            center position and radii magnitudes in D dimensions.</span>\n<span class=\"sd\">            Can be a 3-dimensional array for multiple shapes, or list of 2 or 4</span>\n<span class=\"sd\">            vertices for a single shape.</span>\n<span class=\"sd\">        edge_width : float | list</span>\n<span class=\"sd\">            thickness of lines and edges. If a list is supplied it must be the</span>\n<span class=\"sd\">            same length as the length of `data` and each element will be</span>\n<span class=\"sd\">            applied to each shape otherwise the same value will be used for all</span>\n<span class=\"sd\">            shapes.</span>\n<span class=\"sd\">        edge_color : str | tuple | list</span>\n<span class=\"sd\">            If string can be any color name recognized by vispy or hex value if</span>\n<span class=\"sd\">            starting with `#`. If array-like must be 1-dimensional array with 3</span>\n<span class=\"sd\">            or 4 elements. If a list is supplied it must be the same length as</span>\n<span class=\"sd\">            the length of `data` and each element will be applied to each shape</span>\n<span class=\"sd\">            otherwise the same value will be used for all shapes.</span>\n<span class=\"sd\">        face_color : str | tuple | list</span>\n<span class=\"sd\">            If string can be any color name recognized by vispy or hex value if</span>\n<span class=\"sd\">            starting with `#`. If array-like must be 1-dimensional array with 3</span>\n<span class=\"sd\">            or 4 elements. If a list is supplied it must be the same length as</span>\n<span class=\"sd\">            the length of `data` and each element will be applied to each shape</span>\n<span class=\"sd\">            otherwise the same value will be used for all shapes.</span>\n<span class=\"sd\">        z_index : int | list</span>\n<span class=\"sd\">            Specifier of z order priority. Shapes with higher z order are</span>\n<span class=\"sd\">            displayed ontop of others. If a list is supplied it must be the</span>\n<span class=\"sd\">            same length as the length of `data` and each element will be</span>\n<span class=\"sd\">            applied to each shape otherwise the same value will be used for all</span>\n<span class=\"sd\">            shapes.</span>\n<span class=\"sd\">        \"\"\"</span>\n\n        <span class=\"n\">valid_elem_per_shape</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"mi\">2</span><span class=\"p\">,</span> <span class=\"mi\">4</span><span class=\"p\">)</span>\n        <span class=\"n\">validate_num_vertices</span><span class=\"p\">(</span>\n            <span class=\"n\">data</span><span class=\"p\">,</span> <span class=\"s1\">'ellipse'</span><span class=\"p\">,</span> <span class=\"n\">valid_vertices</span><span class=\"o\">=</span><span class=\"n\">valid_elem_per_shape</span>\n        <span class=\"p\">)</span>\n\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span>\n            <span class=\"n\">data</span><span class=\"p\">,</span>\n            <span class=\"n\">shape_type</span><span class=\"o\">=</span><span class=\"s1\">'ellipse'</span><span class=\"p\">,</span>\n            <span class=\"n\">edge_width</span><span class=\"o\">=</span><span class=\"n\">edge_width</span><span class=\"p\">,</span>\n            <span class=\"n\">edge_color</span><span class=\"o\">=</span><span class=\"n\">edge_color</span><span class=\"p\">,</span>\n            <span class=\"n\">face_color</span><span class=\"o\">=</span><span class=\"n\">face_color</span><span class=\"p\">,</span>\n            <span class=\"n\">z_index</span><span class=\"o\">=</span><span class=\"n\">z_index</span><span class=\"p\">,</span>\n        <span class=\"p\">)</span></div>\n\n<div class=\"viewcode-block\" id=\"Shapes.add_polygons\"><a class=\"viewcode-back\" href=\"../../../../api/stable/napari.layers.Shapes.html#napari.layers.Shapes.add_polygons\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">add_polygons</span><span class=\"p\">(</span>\n        <span class=\"bp\">self</span><span class=\"p\">,</span>\n        <span class=\"n\">data</span><span class=\"p\">,</span>\n        <span class=\"o\">*</span><span class=\"p\">,</span>\n        <span class=\"n\">edge_width</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">edge_color</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">face_color</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">z_index</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"p\">):</span>\n        <span class=\"sd\">\"\"\"Add polygons to the current layer.</span>\n\n<span class=\"sd\">        Parameters</span>\n<span class=\"sd\">        ----------</span>\n<span class=\"sd\">        data : Array | List[Array]</span>\n<span class=\"sd\">            List of polygon data where each element is a (V, D) array of V vertices</span>\n<span class=\"sd\">            in D dimensions representing a polygon. Can be a 3-dimensional array if</span>\n<span class=\"sd\">            polygons have same number of vertices, or a list of V vertices for a</span>\n<span class=\"sd\">            single polygon.</span>\n<span class=\"sd\">        edge_width : float | list</span>\n<span class=\"sd\">            thickness of lines and edges. If a list is supplied it must be the</span>\n<span class=\"sd\">            same length as the length of `data` and each element will be</span>\n<span class=\"sd\">            applied to each shape otherwise the same value will be used for all</span>\n<span class=\"sd\">            shapes.</span>\n<span class=\"sd\">        edge_color : str | tuple | list</span>\n<span class=\"sd\">            If string can be any color name recognized by vispy or hex value if</span>\n<span class=\"sd\">            starting with `#`. If array-like must be 1-dimensional array with 3</span>\n<span class=\"sd\">            or 4 elements. If a list is supplied it must be the same length as</span>\n<span class=\"sd\">            the length of `data` and each element will be applied to each shape</span>\n<span class=\"sd\">            otherwise the same value will be used for all shapes.</span>\n<span class=\"sd\">        face_color : str | tuple | list</span>\n<span class=\"sd\">            If string can be any color name recognized by vispy or hex value if</span>\n<span class=\"sd\">            starting with `#`. If array-like must be 1-dimensional array with 3</span>\n<span class=\"sd\">            or 4 elements. If a list is supplied it must be the same length as</span>\n<span class=\"sd\">            the length of `data` and each element will be applied to each shape</span>\n<span class=\"sd\">            otherwise the same value will be used for all shapes.</span>\n<span class=\"sd\">        z_index : int | list</span>\n<span class=\"sd\">            Specifier of z order priority. Shapes with higher z order are</span>\n<span class=\"sd\">            displayed ontop of others. If a list is supplied it must be the</span>\n<span class=\"sd\">            same length as the length of `data` and each element will be</span>\n<span class=\"sd\">            applied to each shape otherwise the same value will be used for all</span>\n<span class=\"sd\">            shapes.</span>\n<span class=\"sd\">        \"\"\"</span>\n\n        <span class=\"n\">min_vertices</span> <span class=\"o\">=</span> <span class=\"mi\">3</span>\n        <span class=\"n\">validate_num_vertices</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">,</span> <span class=\"s1\">'polygon'</span><span class=\"p\">,</span> <span class=\"n\">min_vertices</span><span class=\"o\">=</span><span class=\"n\">min_vertices</span><span class=\"p\">)</span>\n\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span>\n            <span class=\"n\">data</span><span class=\"p\">,</span>\n            <span class=\"n\">shape_type</span><span class=\"o\">=</span><span class=\"s1\">'polygon'</span><span class=\"p\">,</span>\n            <span class=\"n\">edge_width</span><span class=\"o\">=</span><span class=\"n\">edge_width</span><span class=\"p\">,</span>\n            <span class=\"n\">edge_color</span><span class=\"o\">=</span><span class=\"n\">edge_color</span><span class=\"p\">,</span>\n            <span class=\"n\">face_color</span><span class=\"o\">=</span><span class=\"n\">face_color</span><span class=\"p\">,</span>\n            <span class=\"n\">z_index</span><span class=\"o\">=</span><span class=\"n\">z_index</span><span class=\"p\">,</span>\n        <span class=\"p\">)</span></div>\n\n<div class=\"viewcode-block\" id=\"Shapes.add_lines\"><a class=\"viewcode-back\" href=\"../../../../api/stable/napari.layers.Shapes.html#napari.layers.Shapes.add_lines\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">add_lines</span><span class=\"p\">(</span>\n        <span class=\"bp\">self</span><span class=\"p\">,</span>\n        <span class=\"n\">data</span><span class=\"p\">,</span>\n        <span class=\"o\">*</span><span class=\"p\">,</span>\n        <span class=\"n\">edge_width</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">edge_color</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">face_color</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">z_index</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"p\">):</span>\n        <span class=\"sd\">\"\"\"Add lines to the current layer.</span>\n\n<span class=\"sd\">        Parameters</span>\n<span class=\"sd\">        ----------</span>\n<span class=\"sd\">        data : Array | List[Array]</span>\n<span class=\"sd\">            List of line data where each element is a (2, D) array of 2 vertices</span>\n<span class=\"sd\">            in D dimensions representing a line. Can be a 3-dimensional array for</span>\n<span class=\"sd\">            multiple shapes, or list of 2 vertices for a single shape.</span>\n<span class=\"sd\">        edge_width : float | list</span>\n<span class=\"sd\">            thickness of lines and edges. If a list is supplied it must be the</span>\n<span class=\"sd\">            same length as the length of `data` and each element will be</span>\n<span class=\"sd\">            applied to each shape otherwise the same value will be used for all</span>\n<span class=\"sd\">            shapes.</span>\n<span class=\"sd\">        edge_color : str | tuple | list</span>\n<span class=\"sd\">            If string can be any color name recognized by vispy or hex value if</span>\n<span class=\"sd\">            starting with `#`. If array-like must be 1-dimensional array with 3</span>\n<span class=\"sd\">            or 4 elements. If a list is supplied it must be the same length as</span>\n<span class=\"sd\">            the length of `data` and each element will be applied to each shape</span>\n<span class=\"sd\">            otherwise the same value will be used for all shapes.</span>\n<span class=\"sd\">        face_color : str | tuple | list</span>\n<span class=\"sd\">            If string can be any color name recognized by vispy or hex value if</span>\n<span class=\"sd\">            starting with `#`. If array-like must be 1-dimensional array with 3</span>\n<span class=\"sd\">            or 4 elements. If a list is supplied it must be the same length as</span>\n<span class=\"sd\">            the length of `data` and each element will be applied to each shape</span>\n<span class=\"sd\">            otherwise the same value will be used for all shapes.</span>\n<span class=\"sd\">        z_index : int | list</span>\n<span class=\"sd\">            Specifier of z order priority. Shapes with higher z order are</span>\n<span class=\"sd\">            displayed ontop of others. If a list is supplied it must be the</span>\n<span class=\"sd\">            same length as the length of `data` and each element will be</span>\n<span class=\"sd\">            applied to each shape otherwise the same value will be used for all</span>\n<span class=\"sd\">            shapes.</span>\n<span class=\"sd\">        \"\"\"</span>\n\n        <span class=\"n\">valid_vertices_per_line</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"mi\">2</span><span class=\"p\">,)</span>\n        <span class=\"n\">validate_num_vertices</span><span class=\"p\">(</span>\n            <span class=\"n\">data</span><span class=\"p\">,</span> <span class=\"s1\">'line'</span><span class=\"p\">,</span> <span class=\"n\">valid_vertices</span><span class=\"o\">=</span><span class=\"n\">valid_vertices_per_line</span>\n        <span class=\"p\">)</span>\n\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span>\n            <span class=\"n\">data</span><span class=\"p\">,</span>\n            <span class=\"n\">shape_type</span><span class=\"o\">=</span><span class=\"s1\">'line'</span><span class=\"p\">,</span>\n            <span class=\"n\">edge_width</span><span class=\"o\">=</span><span class=\"n\">edge_width</span><span class=\"p\">,</span>\n            <span class=\"n\">edge_color</span><span class=\"o\">=</span><span class=\"n\">edge_color</span><span class=\"p\">,</span>\n            <span class=\"n\">face_color</span><span class=\"o\">=</span><span class=\"n\">face_color</span><span class=\"p\">,</span>\n            <span class=\"n\">z_index</span><span class=\"o\">=</span><span class=\"n\">z_index</span><span class=\"p\">,</span>\n        <span class=\"p\">)</span></div>\n\n<div class=\"viewcode-block\" id=\"Shapes.add_paths\"><a class=\"viewcode-back\" href=\"../../../../api/stable/napari.layers.Shapes.html#napari.layers.Shapes.add_paths\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">add_paths</span><span class=\"p\">(</span>\n        <span class=\"bp\">self</span><span class=\"p\">,</span>\n        <span class=\"n\">data</span><span class=\"p\">,</span>\n        <span class=\"o\">*</span><span class=\"p\">,</span>\n        <span class=\"n\">edge_width</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">edge_color</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">face_color</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">z_index</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"p\">):</span>\n        <span class=\"sd\">\"\"\"Add paths to the current layer.</span>\n\n<span class=\"sd\">        Parameters</span>\n<span class=\"sd\">        ----------</span>\n<span class=\"sd\">        data : Array | List[Array]</span>\n<span class=\"sd\">            List of path data where each element is a (V, D) array of V vertices</span>\n<span class=\"sd\">            in D dimensions representing a path. Can be a 3-dimensional array</span>\n<span class=\"sd\">            if all paths have same number of vertices, or a list of V vertices</span>\n<span class=\"sd\">            for a single path.</span>\n<span class=\"sd\">        edge_width : float | list</span>\n<span class=\"sd\">            thickness of lines and edges. If a list is supplied it must be the</span>\n<span class=\"sd\">            same length as the length of `data` and each element will be</span>\n<span class=\"sd\">            applied to each shape otherwise the same value will be used for all</span>\n<span class=\"sd\">            shapes.</span>\n<span class=\"sd\">        edge_color : str | tuple | list</span>\n<span class=\"sd\">            If string can be any color name recognized by vispy or hex value if</span>\n<span class=\"sd\">            starting with `#`. If array-like must be 1-dimensional array with 3</span>\n<span class=\"sd\">            or 4 elements. If a list is supplied it must be the same length as</span>\n<span class=\"sd\">            the length of `data` and each element will be applied to each shape</span>\n<span class=\"sd\">            otherwise the same value will be used for all shapes.</span>\n<span class=\"sd\">        face_color : str | tuple | list</span>\n<span class=\"sd\">            If string can be any color name recognized by vispy or hex value if</span>\n<span class=\"sd\">            starting with `#`. If array-like must be 1-dimensional array with 3</span>\n<span class=\"sd\">            or 4 elements. If a list is supplied it must be the same length as</span>\n<span class=\"sd\">            the length of `data` and each element will be applied to each shape</span>\n<span class=\"sd\">            otherwise the same value will be used for all shapes.</span>\n<span class=\"sd\">        z_index : int | list</span>\n<span class=\"sd\">            Specifier of z order priority. Shapes with higher z order are</span>\n<span class=\"sd\">            displayed ontop of others. If a list is supplied it must be the</span>\n<span class=\"sd\">            same length as the length of `data` and each element will be</span>\n<span class=\"sd\">            applied to each shape otherwise the same value will be used for all</span>\n<span class=\"sd\">            shapes.</span>\n<span class=\"sd\">        \"\"\"</span>\n\n        <span class=\"n\">min_vertices_per_path</span> <span class=\"o\">=</span> <span class=\"mi\">2</span>\n        <span class=\"n\">validate_num_vertices</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">,</span> <span class=\"s1\">'path'</span><span class=\"p\">,</span> <span class=\"n\">min_vertices</span><span class=\"o\">=</span><span class=\"n\">min_vertices_per_path</span><span class=\"p\">)</span>\n\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span>\n            <span class=\"n\">data</span><span class=\"p\">,</span>\n            <span class=\"n\">shape_type</span><span class=\"o\">=</span><span class=\"s1\">'path'</span><span class=\"p\">,</span>\n            <span class=\"n\">edge_width</span><span class=\"o\">=</span><span class=\"n\">edge_width</span><span class=\"p\">,</span>\n            <span class=\"n\">edge_color</span><span class=\"o\">=</span><span class=\"n\">edge_color</span><span class=\"p\">,</span>\n            <span class=\"n\">face_color</span><span class=\"o\">=</span><span class=\"n\">face_color</span><span class=\"p\">,</span>\n            <span class=\"n\">z_index</span><span class=\"o\">=</span><span class=\"n\">z_index</span><span class=\"p\">,</span>\n        <span class=\"p\">)</span></div>\n\n<div class=\"viewcode-block\" id=\"Shapes.add\"><a class=\"viewcode-back\" href=\"../../../../api/stable/napari.layers.Shapes.html#napari.layers.Shapes.add\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">add</span><span class=\"p\">(</span>\n        <span class=\"bp\">self</span><span class=\"p\">,</span>\n        <span class=\"n\">data</span><span class=\"p\">,</span>\n        <span class=\"o\">*</span><span class=\"p\">,</span>\n        <span class=\"n\">shape_type</span><span class=\"o\">=</span><span class=\"s1\">'rectangle'</span><span class=\"p\">,</span>\n        <span class=\"n\">edge_width</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">edge_color</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">face_color</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">z_index</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"p\">):</span>\n        <span class=\"sd\">\"\"\"Add shapes to the current layer.</span>\n\n<span class=\"sd\">        Parameters</span>\n<span class=\"sd\">        ----------</span>\n<span class=\"sd\">        data : Array | Tuple(Array,str) | List[Array | Tuple(Array, str)] | Tuple(List[Array], str)</span>\n<span class=\"sd\">            List of shape data, where each element is either an (N, D) array of the</span>\n<span class=\"sd\">            N vertices of a shape in D dimensions or a tuple containing an array of</span>\n<span class=\"sd\">            the N vertices and the shape_type string. When a shape_type is present,</span>\n<span class=\"sd\">            it overrides keyword arg shape_type. Can be an 3-dimensional array</span>\n<span class=\"sd\">            if each shape has the same number of vertices.</span>\n<span class=\"sd\">        shape_type : string | list</span>\n<span class=\"sd\">            String of shape shape_type, must be one of \"{'line', 'rectangle',</span>\n<span class=\"sd\">            'ellipse', 'path', 'polygon'}\". If a list is supplied it must be</span>\n<span class=\"sd\">            the same length as the length of `data` and each element will be</span>\n<span class=\"sd\">            applied to each shape otherwise the same value will be used for all</span>\n<span class=\"sd\">            shapes. Overridden by data shape_type, if present.</span>\n<span class=\"sd\">        edge_width : float | list</span>\n<span class=\"sd\">            thickness of lines and edges. If a list is supplied it must be the</span>\n<span class=\"sd\">            same length as the length of `data` and each element will be</span>\n<span class=\"sd\">            applied to each shape otherwise the same value will be used for all</span>\n<span class=\"sd\">            shapes.</span>\n<span class=\"sd\">        edge_color : str | tuple | list</span>\n<span class=\"sd\">            If string can be any color name recognized by vispy or hex value if</span>\n<span class=\"sd\">            starting with `#`. If array-like must be 1-dimensional array with 3</span>\n<span class=\"sd\">            or 4 elements. If a list is supplied it must be the same length as</span>\n<span class=\"sd\">            the length of `data` and each element will be applied to each shape</span>\n<span class=\"sd\">            otherwise the same value will be used for all shapes.</span>\n<span class=\"sd\">        face_color : str | tuple | list</span>\n<span class=\"sd\">            If string can be any color name recognized by vispy or hex value if</span>\n<span class=\"sd\">            starting with `#`. If array-like must be 1-dimensional array with 3</span>\n<span class=\"sd\">            or 4 elements. If a list is supplied it must be the same length as</span>\n<span class=\"sd\">            the length of `data` and each element will be applied to each shape</span>\n<span class=\"sd\">            otherwise the same value will be used for all shapes.</span>\n<span class=\"sd\">        z_index : int | list</span>\n<span class=\"sd\">            Specifier of z order priority. Shapes with higher z order are</span>\n<span class=\"sd\">            displayed ontop of others. If a list is supplied it must be the</span>\n<span class=\"sd\">            same length as the length of `data` and each element will be</span>\n<span class=\"sd\">            applied to each shape otherwise the same value will be used for all</span>\n<span class=\"sd\">            shapes.</span>\n<span class=\"sd\">        \"\"\"</span>\n        <span class=\"n\">data</span><span class=\"p\">,</span> <span class=\"n\">shape_type</span> <span class=\"o\">=</span> <span class=\"n\">extract_shape_type</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">,</span> <span class=\"n\">shape_type</span><span class=\"p\">)</span>\n\n        <span class=\"k\">if</span> <span class=\"n\">edge_width</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n            <span class=\"n\">edge_width</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">current_edge_width</span>\n\n        <span class=\"n\">n_new_shapes</span> <span class=\"o\">=</span> <span class=\"n\">number_of_shapes</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">)</span>\n\n        <span class=\"k\">if</span> <span class=\"n\">edge_color</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n            <span class=\"n\">edge_color</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_get_new_shape_color</span><span class=\"p\">(</span>\n                <span class=\"n\">n_new_shapes</span><span class=\"p\">,</span> <span class=\"n\">attribute</span><span class=\"o\">=</span><span class=\"s1\">'edge'</span>\n            <span class=\"p\">)</span>\n        <span class=\"k\">if</span> <span class=\"n\">face_color</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n            <span class=\"n\">face_color</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_get_new_shape_color</span><span class=\"p\">(</span>\n                <span class=\"n\">n_new_shapes</span><span class=\"p\">,</span> <span class=\"n\">attribute</span><span class=\"o\">=</span><span class=\"s1\">'face'</span>\n            <span class=\"p\">)</span>\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_data_view</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n            <span class=\"n\">z_index</span> <span class=\"o\">=</span> <span class=\"n\">z_index</span> <span class=\"ow\">or</span> <span class=\"nb\">max</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_data_view</span><span class=\"o\">.</span><span class=\"n\">_z_index</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=-</span><span class=\"mi\">1</span><span class=\"p\">)</span> <span class=\"o\">+</span> <span class=\"mi\">1</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"n\">z_index</span> <span class=\"o\">=</span> <span class=\"n\">z_index</span> <span class=\"ow\">or</span> <span class=\"mi\">0</span>\n\n        <span class=\"k\">if</span> <span class=\"n\">n_new_shapes</span> <span class=\"o\">&gt;</span> <span class=\"mi\">0</span><span class=\"p\">:</span>\n            <span class=\"k\">if</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">properties</span><span class=\"p\">)</span> <span class=\"o\">&gt;</span> <span class=\"mi\">0</span><span class=\"p\">:</span>\n                <span class=\"n\">first_prop_key</span> <span class=\"o\">=</span> <span class=\"nb\">next</span><span class=\"p\">(</span><span class=\"nb\">iter</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">properties</span><span class=\"p\">))</span>\n                <span class=\"n\">n_prop_values</span> <span class=\"o\">=</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">properties</span><span class=\"p\">[</span><span class=\"n\">first_prop_key</span><span class=\"p\">])</span>\n            <span class=\"k\">else</span><span class=\"p\">:</span>\n                <span class=\"n\">n_prop_values</span> <span class=\"o\">=</span> <span class=\"mi\">0</span>\n            <span class=\"n\">total_shapes</span> <span class=\"o\">=</span> <span class=\"n\">n_new_shapes</span> <span class=\"o\">+</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">nshapes</span>\n            <span class=\"k\">if</span> <span class=\"n\">total_shapes</span> <span class=\"o\">&gt;</span> <span class=\"n\">n_prop_values</span><span class=\"p\">:</span>\n                <span class=\"n\">n_props_to_add</span> <span class=\"o\">=</span> <span class=\"n\">total_shapes</span> <span class=\"o\">-</span> <span class=\"n\">n_prop_values</span>\n                <span class=\"k\">for</span> <span class=\"n\">k</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">properties</span><span class=\"p\">:</span>\n                    <span class=\"n\">new_property</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">repeat</span><span class=\"p\">(</span>\n                        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">current_properties</span><span class=\"p\">[</span><span class=\"n\">k</span><span class=\"p\">],</span> <span class=\"n\">n_props_to_add</span><span class=\"p\">,</span> <span class=\"n\">axis</span><span class=\"o\">=</span><span class=\"mi\">0</span>\n                    <span class=\"p\">)</span>\n                    <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">properties</span><span class=\"p\">[</span><span class=\"n\">k</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">concatenate</span><span class=\"p\">(</span>\n                        <span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">properties</span><span class=\"p\">[</span><span class=\"n\">k</span><span class=\"p\">],</span> <span class=\"n\">new_property</span><span class=\"p\">),</span> <span class=\"n\">axis</span><span class=\"o\">=</span><span class=\"mi\">0</span>\n                    <span class=\"p\">)</span>\n                <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">text</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">current_properties</span><span class=\"p\">,</span> <span class=\"n\">n_props_to_add</span><span class=\"p\">)</span>\n            <span class=\"k\">if</span> <span class=\"n\">total_shapes</span> <span class=\"o\">&lt;</span> <span class=\"n\">n_prop_values</span><span class=\"p\">:</span>\n                <span class=\"k\">for</span> <span class=\"n\">k</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">properties</span><span class=\"p\">:</span>\n                    <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">properties</span><span class=\"p\">[</span><span class=\"n\">k</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">properties</span><span class=\"p\">[</span><span class=\"n\">k</span><span class=\"p\">][:</span><span class=\"n\">total_shapes</span><span class=\"p\">]</span>\n                <span class=\"n\">n_props_to_remove</span> <span class=\"o\">=</span> <span class=\"n\">n_prop_values</span> <span class=\"o\">-</span> <span class=\"n\">total_shapes</span>\n                <span class=\"n\">indices_to_remove</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">arange</span><span class=\"p\">(</span><span class=\"n\">n_prop_values</span><span class=\"p\">)[</span>\n                    <span class=\"o\">-</span><span class=\"n\">n_props_to_remove</span><span class=\"p\">:</span>\n                <span class=\"p\">]</span>\n                <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">text</span><span class=\"o\">.</span><span class=\"n\">remove</span><span class=\"p\">(</span><span class=\"n\">indices_to_remove</span><span class=\"p\">)</span>\n\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_add_shapes</span><span class=\"p\">(</span>\n                <span class=\"n\">data</span><span class=\"p\">,</span>\n                <span class=\"n\">shape_type</span><span class=\"o\">=</span><span class=\"n\">shape_type</span><span class=\"p\">,</span>\n                <span class=\"n\">edge_width</span><span class=\"o\">=</span><span class=\"n\">edge_width</span><span class=\"p\">,</span>\n                <span class=\"n\">edge_color</span><span class=\"o\">=</span><span class=\"n\">edge_color</span><span class=\"p\">,</span>\n                <span class=\"n\">face_color</span><span class=\"o\">=</span><span class=\"n\">face_color</span><span class=\"p\">,</span>\n                <span class=\"n\">z_index</span><span class=\"o\">=</span><span class=\"n\">z_index</span><span class=\"p\">,</span>\n            <span class=\"p\">)</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">events</span><span class=\"o\">.</span><span class=\"n\">data</span><span class=\"p\">(</span><span class=\"n\">value</span><span class=\"o\">=</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">data</span><span class=\"p\">)</span></div>\n\n    <span class=\"k\">def</span> <span class=\"nf\">_init_shapes</span><span class=\"p\">(</span>\n        <span class=\"bp\">self</span><span class=\"p\">,</span>\n        <span class=\"n\">data</span><span class=\"p\">,</span>\n        <span class=\"o\">*</span><span class=\"p\">,</span>\n        <span class=\"n\">shape_type</span><span class=\"o\">=</span><span class=\"s1\">'rectangle'</span><span class=\"p\">,</span>\n        <span class=\"n\">edge_width</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">edge_color</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">edge_color_cycle</span><span class=\"p\">,</span>\n        <span class=\"n\">edge_colormap</span><span class=\"p\">,</span>\n        <span class=\"n\">edge_contrast_limits</span><span class=\"p\">,</span>\n        <span class=\"n\">face_color</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">face_color_cycle</span><span class=\"p\">,</span>\n        <span class=\"n\">face_colormap</span><span class=\"p\">,</span>\n        <span class=\"n\">face_contrast_limits</span><span class=\"p\">,</span>\n        <span class=\"n\">z_index</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n    <span class=\"p\">):</span>\n        <span class=\"sd\">\"\"\"Add shapes to the data view.</span>\n\n<span class=\"sd\">        Parameters</span>\n<span class=\"sd\">        ----------</span>\n<span class=\"sd\">        data : Array | Tuple(Array,str) | List[Array | Tuple(Array, str)] | Tuple(List[Array], str)</span>\n<span class=\"sd\">            List of shape data, where each element is either an (N, D) array of the</span>\n<span class=\"sd\">            N vertices of a shape in D dimensions or a tuple containing an array of</span>\n<span class=\"sd\">            the N vertices and the shape_type string. When a shape_type is present,</span>\n<span class=\"sd\">            it overrides keyword arg shape_type. Can be an 3-dimensional array</span>\n<span class=\"sd\">            if each shape has the same number of vertices.</span>\n<span class=\"sd\">        shape_type : string | list</span>\n<span class=\"sd\">            String of shape shape_type, must be one of \"{'line', 'rectangle',</span>\n<span class=\"sd\">            'ellipse', 'path', 'polygon'}\". If a list is supplied it must be</span>\n<span class=\"sd\">            the same length as the length of `data` and each element will be</span>\n<span class=\"sd\">            applied to each shape otherwise the same value will be used for all</span>\n<span class=\"sd\">            shapes. Overriden by data shape_type, if present.</span>\n<span class=\"sd\">        edge_width : float | list</span>\n<span class=\"sd\">            thickness of lines and edges. If a list is supplied it must be the</span>\n<span class=\"sd\">            same length as the length of `data` and each element will be</span>\n<span class=\"sd\">            applied to each shape otherwise the same value will be used for all</span>\n<span class=\"sd\">            shapes.</span>\n<span class=\"sd\">        edge_color : str | tuple | list</span>\n<span class=\"sd\">            If string can be any color name recognized by vispy or hex value if</span>\n<span class=\"sd\">            starting with `#`. If array-like must be 1-dimensional array with 3</span>\n<span class=\"sd\">            or 4 elements. If a list is supplied it must be the same length as</span>\n<span class=\"sd\">            the length of `data` and each element will be applied to each shape</span>\n<span class=\"sd\">            otherwise the same value will be used for all shapes.</span>\n<span class=\"sd\">        face_color : str | tuple | list</span>\n<span class=\"sd\">            If string can be any color name recognized by vispy or hex value if</span>\n<span class=\"sd\">            starting with `#`. If array-like must be 1-dimensional array with 3</span>\n<span class=\"sd\">            or 4 elements. If a list is supplied it must be the same length as</span>\n<span class=\"sd\">            the length of `data` and each element will be applied to each shape</span>\n<span class=\"sd\">            otherwise the same value will be used for all shapes.</span>\n<span class=\"sd\">        z_index : int | list</span>\n<span class=\"sd\">            Specifier of z order priority. Shapes with higher z order are</span>\n<span class=\"sd\">            displayed ontop of others. If a list is supplied it must be the</span>\n<span class=\"sd\">            same length as the length of `data` and each element will be</span>\n<span class=\"sd\">            applied to each shape otherwise the same value will be used for all</span>\n<span class=\"sd\">            shapes.</span>\n<span class=\"sd\">        \"\"\"</span>\n\n        <span class=\"n\">n_shapes</span> <span class=\"o\">=</span> <span class=\"n\">number_of_shapes</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">)</span>\n        <span class=\"k\">with</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">block_update_properties</span><span class=\"p\">():</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_edge_color_property</span> <span class=\"o\">=</span> <span class=\"s1\">''</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">edge_color_cycle_map</span> <span class=\"o\">=</span> <span class=\"p\">{}</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">edge_colormap</span> <span class=\"o\">=</span> <span class=\"n\">edge_colormap</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_edge_contrast_limits</span> <span class=\"o\">=</span> <span class=\"n\">edge_contrast_limits</span>\n            <span class=\"k\">if</span> <span class=\"n\">edge_color_cycle</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n                <span class=\"n\">edge_color_cycle</span> <span class=\"o\">=</span> <span class=\"n\">deepcopy</span><span class=\"p\">(</span><span class=\"n\">DEFAULT_COLOR_CYCLE</span><span class=\"p\">)</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">edge_color_cycle</span> <span class=\"o\">=</span> <span class=\"n\">edge_color_cycle</span>\n            <span class=\"n\">edge_color</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_initialize_color</span><span class=\"p\">(</span>\n                <span class=\"n\">edge_color</span><span class=\"p\">,</span> <span class=\"n\">attribute</span><span class=\"o\">=</span><span class=\"s1\">'edge'</span><span class=\"p\">,</span> <span class=\"n\">n_shapes</span><span class=\"o\">=</span><span class=\"n\">n_shapes</span>\n            <span class=\"p\">)</span>\n\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_face_color_property</span> <span class=\"o\">=</span> <span class=\"s1\">''</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">face_color_cycle_map</span> <span class=\"o\">=</span> <span class=\"p\">{}</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">face_colormap</span> <span class=\"o\">=</span> <span class=\"n\">face_colormap</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_face_contrast_limits</span> <span class=\"o\">=</span> <span class=\"n\">face_contrast_limits</span>\n            <span class=\"k\">if</span> <span class=\"n\">face_color_cycle</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n                <span class=\"n\">face_color_cycle</span> <span class=\"o\">=</span> <span class=\"n\">deepcopy</span><span class=\"p\">(</span><span class=\"n\">DEFAULT_COLOR_CYCLE</span><span class=\"p\">)</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">face_color_cycle</span> <span class=\"o\">=</span> <span class=\"n\">face_color_cycle</span>\n            <span class=\"n\">face_color</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_initialize_color</span><span class=\"p\">(</span>\n                <span class=\"n\">face_color</span><span class=\"p\">,</span> <span class=\"n\">attribute</span><span class=\"o\">=</span><span class=\"s1\">'face'</span><span class=\"p\">,</span> <span class=\"n\">n_shapes</span><span class=\"o\">=</span><span class=\"n\">n_shapes</span>\n            <span class=\"p\">)</span>\n\n        <span class=\"k\">with</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">block_thumbnail_update</span><span class=\"p\">():</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_add_shapes</span><span class=\"p\">(</span>\n                <span class=\"n\">data</span><span class=\"p\">,</span>\n                <span class=\"n\">shape_type</span><span class=\"o\">=</span><span class=\"n\">shape_type</span><span class=\"p\">,</span>\n                <span class=\"n\">edge_width</span><span class=\"o\">=</span><span class=\"n\">edge_width</span><span class=\"p\">,</span>\n                <span class=\"n\">edge_color</span><span class=\"o\">=</span><span class=\"n\">edge_color</span><span class=\"p\">,</span>\n                <span class=\"n\">face_color</span><span class=\"o\">=</span><span class=\"n\">face_color</span><span class=\"p\">,</span>\n                <span class=\"n\">z_index</span><span class=\"o\">=</span><span class=\"n\">z_index</span><span class=\"p\">,</span>\n                <span class=\"n\">z_refresh</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span>\n            <span class=\"p\">)</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_data_view</span><span class=\"o\">.</span><span class=\"n\">_update_z_order</span><span class=\"p\">()</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">refresh_colors</span><span class=\"p\">()</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">_add_shapes</span><span class=\"p\">(</span>\n        <span class=\"bp\">self</span><span class=\"p\">,</span>\n        <span class=\"n\">data</span><span class=\"p\">,</span>\n        <span class=\"o\">*</span><span class=\"p\">,</span>\n        <span class=\"n\">shape_type</span><span class=\"o\">=</span><span class=\"s1\">'rectangle'</span><span class=\"p\">,</span>\n        <span class=\"n\">edge_width</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">edge_color</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">face_color</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">z_index</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span>\n        <span class=\"n\">z_refresh</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">,</span>\n    <span class=\"p\">):</span>\n        <span class=\"sd\">\"\"\"Add shapes to the data view.</span>\n\n<span class=\"sd\">        Parameters</span>\n<span class=\"sd\">        ----------</span>\n<span class=\"sd\">        data : Array | Tuple(Array,str) | List[Array | Tuple(Array, str)] | Tuple(List[Array], str)</span>\n<span class=\"sd\">            List of shape data, where each element is either an (N, D) array of the</span>\n<span class=\"sd\">            N vertices of a shape in D dimensions or a tuple containing an array of</span>\n<span class=\"sd\">            the N vertices and the shape_type string. When a shape_type is present,</span>\n<span class=\"sd\">            it overrides keyword arg shape_type. Can be an 3-dimensional array</span>\n<span class=\"sd\">            if each shape has the same number of vertices.</span>\n<span class=\"sd\">        shape_type : string | list</span>\n<span class=\"sd\">            String of shape shape_type, must be one of \"{'line', 'rectangle',</span>\n<span class=\"sd\">            'ellipse', 'path', 'polygon'}\". If a list is supplied it must be</span>\n<span class=\"sd\">            the same length as the length of `data` and each element will be</span>\n<span class=\"sd\">            applied to each shape otherwise the same value will be used for all</span>\n<span class=\"sd\">            shapes. Overridden by data shape_type, if present.</span>\n<span class=\"sd\">        edge_width : float | list</span>\n<span class=\"sd\">            thickness of lines and edges. If a list is supplied it must be the</span>\n<span class=\"sd\">            same length as the length of `data` and each element will be</span>\n<span class=\"sd\">            applied to each shape otherwise the same value will be used for all</span>\n<span class=\"sd\">            shapes.</span>\n<span class=\"sd\">        edge_color : str | tuple | list</span>\n<span class=\"sd\">            If string can be any color name recognized by vispy or hex value if</span>\n<span class=\"sd\">            starting with `#`. If array-like must be 1-dimensional array with 3</span>\n<span class=\"sd\">            or 4 elements. If a list is supplied it must be the same length as</span>\n<span class=\"sd\">            the length of `data` and each element will be applied to each shape</span>\n<span class=\"sd\">            otherwise the same value will be used for all shapes.</span>\n<span class=\"sd\">        face_color : str | tuple | list</span>\n<span class=\"sd\">            If string can be any color name recognized by vispy or hex value if</span>\n<span class=\"sd\">            starting with `#`. If array-like must be 1-dimensional array with 3</span>\n<span class=\"sd\">            or 4 elements. If a list is supplied it must be the same length as</span>\n<span class=\"sd\">            the length of `data` and each element will be applied to each shape</span>\n<span class=\"sd\">            otherwise the same value will be used for all shapes.</span>\n<span class=\"sd\">        z_index : int | list</span>\n<span class=\"sd\">            Specifier of z order priority. Shapes with higher z order are</span>\n<span class=\"sd\">            displayed on top of others. If a list is supplied it must be the</span>\n<span class=\"sd\">            same length as the length of `data` and each element will be</span>\n<span class=\"sd\">            applied to each shape otherwise the same value will be used for all</span>\n<span class=\"sd\">            shapes.</span>\n<span class=\"sd\">        z_refresh : bool</span>\n<span class=\"sd\">            If set to true, the mesh elements are reindexed with the new z order.</span>\n<span class=\"sd\">            When shape_index is provided, z_refresh will be overwritten to false,</span>\n<span class=\"sd\">            as the z indices will not change.</span>\n<span class=\"sd\">            When adding a batch of shapes, set to false  and then call</span>\n<span class=\"sd\">            ShapesList._update_z_order() once at the end.</span>\n<span class=\"sd\">        \"\"\"</span>\n        <span class=\"k\">if</span> <span class=\"n\">edge_width</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n            <span class=\"n\">edge_width</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">current_edge_width</span>\n        <span class=\"k\">if</span> <span class=\"n\">edge_color</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n            <span class=\"n\">edge_color</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_current_edge_color</span>\n        <span class=\"k\">if</span> <span class=\"n\">face_color</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n            <span class=\"n\">face_color</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_current_face_color</span>\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_data_view</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n            <span class=\"n\">z_index</span> <span class=\"o\">=</span> <span class=\"n\">z_index</span> <span class=\"ow\">or</span> <span class=\"nb\">max</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_data_view</span><span class=\"o\">.</span><span class=\"n\">_z_index</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=-</span><span class=\"mi\">1</span><span class=\"p\">)</span> <span class=\"o\">+</span> <span class=\"mi\">1</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"n\">z_index</span> <span class=\"o\">=</span> <span class=\"n\">z_index</span> <span class=\"ow\">or</span> <span class=\"mi\">0</span>\n\n        <span class=\"k\">if</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">)</span> <span class=\"o\">&gt;</span> <span class=\"mi\">0</span><span class=\"p\">:</span>\n            <span class=\"k\">if</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">array</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">])</span><span class=\"o\">.</span><span class=\"n\">ndim</span> <span class=\"o\">==</span> <span class=\"mi\">1</span><span class=\"p\">:</span>\n                <span class=\"c1\"># If a single array for a shape has been passed turn into list</span>\n                <span class=\"n\">data</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"n\">data</span><span class=\"p\">]</span>\n\n            <span class=\"c1\"># transform the colors</span>\n            <span class=\"n\">transformed_ec</span> <span class=\"o\">=</span> <span class=\"n\">transform_color_with_defaults</span><span class=\"p\">(</span>\n                <span class=\"n\">num_entries</span><span class=\"o\">=</span><span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">),</span>\n                <span class=\"n\">colors</span><span class=\"o\">=</span><span class=\"n\">edge_color</span><span class=\"p\">,</span>\n                <span class=\"n\">elem_name</span><span class=\"o\">=</span><span class=\"s2\">\"edge_color\"</span><span class=\"p\">,</span>\n                <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s2\">\"white\"</span><span class=\"p\">,</span>\n            <span class=\"p\">)</span>\n            <span class=\"n\">transformed_edge_color</span> <span class=\"o\">=</span> <span class=\"n\">normalize_and_broadcast_colors</span><span class=\"p\">(</span>\n                <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">),</span> <span class=\"n\">transformed_ec</span>\n            <span class=\"p\">)</span>\n            <span class=\"n\">transformed_fc</span> <span class=\"o\">=</span> <span class=\"n\">transform_color_with_defaults</span><span class=\"p\">(</span>\n                <span class=\"n\">num_entries</span><span class=\"o\">=</span><span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">),</span>\n                <span class=\"n\">colors</span><span class=\"o\">=</span><span class=\"n\">face_color</span><span class=\"p\">,</span>\n                <span class=\"n\">elem_name</span><span class=\"o\">=</span><span class=\"s2\">\"face_color\"</span><span class=\"p\">,</span>\n                <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"s2\">\"white\"</span><span class=\"p\">,</span>\n            <span class=\"p\">)</span>\n            <span class=\"n\">transformed_face_color</span> <span class=\"o\">=</span> <span class=\"n\">normalize_and_broadcast_colors</span><span class=\"p\">(</span>\n                <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">),</span> <span class=\"n\">transformed_fc</span>\n            <span class=\"p\">)</span>\n\n            <span class=\"c1\"># Turn input arguments into iterables</span>\n            <span class=\"n\">shape_inputs</span> <span class=\"o\">=</span> <span class=\"nb\">zip</span><span class=\"p\">(</span>\n                <span class=\"n\">data</span><span class=\"p\">,</span>\n                <span class=\"n\">ensure_iterable</span><span class=\"p\">(</span><span class=\"n\">shape_type</span><span class=\"p\">),</span>\n                <span class=\"n\">ensure_iterable</span><span class=\"p\">(</span><span class=\"n\">edge_width</span><span class=\"p\">),</span>\n                <span class=\"n\">transformed_edge_color</span><span class=\"p\">,</span>\n                <span class=\"n\">transformed_face_color</span><span class=\"p\">,</span>\n                <span class=\"n\">ensure_iterable</span><span class=\"p\">(</span><span class=\"n\">z_index</span><span class=\"p\">),</span>\n            <span class=\"p\">)</span>\n\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_add_shapes_to_view</span><span class=\"p\">(</span><span class=\"n\">shape_inputs</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_data_view</span><span class=\"p\">)</span>\n\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_display_order_stored</span> <span class=\"o\">=</span> <span class=\"n\">copy</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_dims_order</span><span class=\"p\">)</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_ndisplay_stored</span> <span class=\"o\">=</span> <span class=\"n\">copy</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_ndisplay</span><span class=\"p\">)</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_update_dims</span><span class=\"p\">()</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">_add_shapes_to_view</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">shape_inputs</span><span class=\"p\">,</span> <span class=\"n\">data_view</span><span class=\"p\">):</span>\n        <span class=\"sd\">\"\"\"Build new shapes and add them to the _data_view\"\"\"</span>\n        <span class=\"k\">for</span> <span class=\"n\">d</span><span class=\"p\">,</span> <span class=\"n\">st</span><span class=\"p\">,</span> <span class=\"n\">ew</span><span class=\"p\">,</span> <span class=\"n\">ec</span><span class=\"p\">,</span> <span class=\"n\">fc</span><span class=\"p\">,</span> <span class=\"n\">z</span> <span class=\"ow\">in</span> <span class=\"n\">shape_inputs</span><span class=\"p\">:</span>\n\n            <span class=\"n\">shape_cls</span> <span class=\"o\">=</span> <span class=\"n\">shape_classes</span><span class=\"p\">[</span><span class=\"n\">ShapeType</span><span class=\"p\">(</span><span class=\"n\">st</span><span class=\"p\">)]</span>\n            <span class=\"n\">shape</span> <span class=\"o\">=</span> <span class=\"n\">shape_cls</span><span class=\"p\">(</span>\n                <span class=\"n\">d</span><span class=\"p\">,</span>\n                <span class=\"n\">edge_width</span><span class=\"o\">=</span><span class=\"n\">ew</span><span class=\"p\">,</span>\n                <span class=\"n\">z_index</span><span class=\"o\">=</span><span class=\"n\">z</span><span class=\"p\">,</span>\n                <span class=\"n\">dims_order</span><span class=\"o\">=</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_dims_order</span><span class=\"p\">,</span>\n                <span class=\"n\">ndisplay</span><span class=\"o\">=</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_ndisplay</span><span class=\"p\">,</span>\n            <span class=\"p\">)</span>\n\n            <span class=\"c1\"># Add shape</span>\n            <span class=\"n\">data_view</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">shape</span><span class=\"p\">,</span> <span class=\"n\">edge_color</span><span class=\"o\">=</span><span class=\"n\">ec</span><span class=\"p\">,</span> <span class=\"n\">face_color</span><span class=\"o\">=</span><span class=\"n\">fc</span><span class=\"p\">,</span> <span class=\"n\">z_refresh</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n        <span class=\"n\">data_view</span><span class=\"o\">.</span><span class=\"n\">_update_z_order</span><span class=\"p\">()</span>\n\n    <span class=\"nd\">@property</span>\n    <span class=\"k\">def</span> <span class=\"nf\">text</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">)</span> <span class=\"o\">-&gt;</span> <span class=\"n\">TextManager</span><span class=\"p\">:</span>\n        <span class=\"sd\">\"\"\"TextManager: The TextManager object containing the text properties\"\"\"</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_text</span>\n\n    <span class=\"nd\">@text</span><span class=\"o\">.</span><span class=\"n\">setter</span>\n    <span class=\"k\">def</span> <span class=\"nf\">text</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">text</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_text</span><span class=\"o\">.</span><span class=\"n\">_set_text</span><span class=\"p\">(</span>\n            <span class=\"n\">text</span><span class=\"p\">,</span> <span class=\"n\">n_text</span><span class=\"o\">=</span><span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">data</span><span class=\"p\">),</span> <span class=\"n\">properties</span><span class=\"o\">=</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">properties</span>\n        <span class=\"p\">)</span>\n\n<div class=\"viewcode-block\" id=\"Shapes.refresh_text\"><a class=\"viewcode-back\" href=\"../../../../api/stable/napari.layers.Shapes.html#napari.layers.Shapes.refresh_text\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">refresh_text</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"sd\">\"\"\"Refresh the text values.</span>\n\n<span class=\"sd\">        This is generally used if the properties were updated without changing the data</span>\n<span class=\"sd\">        \"\"\"</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">text</span><span class=\"o\">.</span><span class=\"n\">refresh_text</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">properties</span><span class=\"p\">)</span></div>\n\n    <span class=\"k\">def</span> <span class=\"nf\">_set_view_slice</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"sd\">\"\"\"Set the view given the slicing indices.\"\"\"</span>\n        <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_ndisplay</span> <span class=\"o\">==</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_ndisplay_stored</span><span class=\"p\">:</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">selected_data</span> <span class=\"o\">=</span> <span class=\"nb\">set</span><span class=\"p\">()</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_data_view</span><span class=\"o\">.</span><span class=\"n\">ndisplay</span> <span class=\"o\">=</span> <span class=\"nb\">min</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">ndim</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_ndisplay</span><span class=\"p\">)</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_ndisplay_stored</span> <span class=\"o\">=</span> <span class=\"n\">copy</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_ndisplay</span><span class=\"p\">)</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_clipboard</span> <span class=\"o\">=</span> <span class=\"p\">{}</span>\n\n        <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_dims_order</span> <span class=\"o\">==</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_display_order_stored</span><span class=\"p\">:</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">selected_data</span> <span class=\"o\">=</span> <span class=\"nb\">set</span><span class=\"p\">()</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_data_view</span><span class=\"o\">.</span><span class=\"n\">update_dims_order</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_dims_order</span><span class=\"p\">)</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_display_order_stored</span> <span class=\"o\">=</span> <span class=\"n\">copy</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_dims_order</span><span class=\"p\">)</span>\n            <span class=\"c1\"># Clear clipboard if dimensions swap</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_clipboard</span> <span class=\"o\">=</span> <span class=\"p\">{}</span>\n\n        <span class=\"n\">slice_key</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">array</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_slice_indices</span><span class=\"p\">)[</span>\n            <span class=\"nb\">list</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_dims_not_displayed</span><span class=\"p\">)</span>\n        <span class=\"p\">]</span>\n        <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">all</span><span class=\"p\">(</span><span class=\"n\">slice_key</span> <span class=\"o\">==</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_data_view</span><span class=\"o\">.</span><span class=\"n\">slice_key</span><span class=\"p\">):</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">selected_data</span> <span class=\"o\">=</span> <span class=\"nb\">set</span><span class=\"p\">()</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_data_view</span><span class=\"o\">.</span><span class=\"n\">slice_key</span> <span class=\"o\">=</span> <span class=\"n\">slice_key</span>\n\n<div class=\"viewcode-block\" id=\"Shapes.interaction_box\"><a class=\"viewcode-back\" href=\"../../../../api/stable/napari.layers.Shapes.html#napari.layers.Shapes.interaction_box\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">interaction_box</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">index</span><span class=\"p\">):</span>\n        <span class=\"sd\">\"\"\"Create the interaction box around a shape or list of shapes.</span>\n<span class=\"sd\">        If a single index is passed then the boudning box will be inherited</span>\n<span class=\"sd\">        from that shapes interaction box. If list of indices is passed it will</span>\n<span class=\"sd\">        be computed directly.</span>\n\n<span class=\"sd\">        Parameters</span>\n<span class=\"sd\">        ----------</span>\n<span class=\"sd\">        index : int | list</span>\n<span class=\"sd\">            Index of a single shape, or a list of shapes around which to</span>\n<span class=\"sd\">            construct the interaction box</span>\n\n<span class=\"sd\">        Returns</span>\n<span class=\"sd\">        -------</span>\n<span class=\"sd\">        box : np.ndarray</span>\n<span class=\"sd\">            10x2 array of vertices of the interaction box. The first 8 points</span>\n<span class=\"sd\">            are the corners and midpoints of the box in clockwise order</span>\n<span class=\"sd\">            starting in the upper-left corner. The 9th point is the center of</span>\n<span class=\"sd\">            the box, and the last point is the location of the rotation handle</span>\n<span class=\"sd\">            that can be used to rotate the box</span>\n<span class=\"sd\">        \"\"\"</span>\n        <span class=\"k\">if</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">index</span><span class=\"p\">,</span> <span class=\"p\">(</span><span class=\"nb\">list</span><span class=\"p\">,</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">ndarray</span><span class=\"p\">,</span> <span class=\"nb\">set</span><span class=\"p\">)):</span>\n            <span class=\"k\">if</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">index</span><span class=\"p\">)</span> <span class=\"o\">==</span> <span class=\"mi\">0</span><span class=\"p\">:</span>\n                <span class=\"n\">box</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n            <span class=\"k\">elif</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">index</span><span class=\"p\">)</span> <span class=\"o\">==</span> <span class=\"mi\">1</span><span class=\"p\">:</span>\n                <span class=\"n\">box</span> <span class=\"o\">=</span> <span class=\"n\">copy</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_data_view</span><span class=\"o\">.</span><span class=\"n\">shapes</span><span class=\"p\">[</span><span class=\"nb\">list</span><span class=\"p\">(</span><span class=\"n\">index</span><span class=\"p\">)[</span><span class=\"mi\">0</span><span class=\"p\">]]</span><span class=\"o\">.</span><span class=\"n\">_box</span><span class=\"p\">)</span>\n            <span class=\"k\">else</span><span class=\"p\">:</span>\n                <span class=\"n\">indices</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">isin</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_data_view</span><span class=\"o\">.</span><span class=\"n\">displayed_index</span><span class=\"p\">,</span> <span class=\"nb\">list</span><span class=\"p\">(</span><span class=\"n\">index</span><span class=\"p\">))</span>\n                <span class=\"n\">box</span> <span class=\"o\">=</span> <span class=\"n\">create_box</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_data_view</span><span class=\"o\">.</span><span class=\"n\">displayed_vertices</span><span class=\"p\">[</span><span class=\"n\">indices</span><span class=\"p\">])</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"n\">box</span> <span class=\"o\">=</span> <span class=\"n\">copy</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_data_view</span><span class=\"o\">.</span><span class=\"n\">shapes</span><span class=\"p\">[</span><span class=\"n\">index</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">_box</span><span class=\"p\">)</span>\n\n        <span class=\"k\">if</span> <span class=\"n\">box</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n            <span class=\"n\">rot</span> <span class=\"o\">=</span> <span class=\"n\">box</span><span class=\"p\">[</span><span class=\"n\">Box</span><span class=\"o\">.</span><span class=\"n\">TOP_CENTER</span><span class=\"p\">]</span>\n            <span class=\"n\">length_box</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">linalg</span><span class=\"o\">.</span><span class=\"n\">norm</span><span class=\"p\">(</span>\n                <span class=\"n\">box</span><span class=\"p\">[</span><span class=\"n\">Box</span><span class=\"o\">.</span><span class=\"n\">BOTTOM_LEFT</span><span class=\"p\">]</span> <span class=\"o\">-</span> <span class=\"n\">box</span><span class=\"p\">[</span><span class=\"n\">Box</span><span class=\"o\">.</span><span class=\"n\">TOP_LEFT</span><span class=\"p\">]</span>\n            <span class=\"p\">)</span>\n            <span class=\"k\">if</span> <span class=\"n\">length_box</span> <span class=\"o\">&gt;</span> <span class=\"mi\">0</span><span class=\"p\">:</span>\n                <span class=\"n\">r</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_rotation_handle_length</span> <span class=\"o\">*</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">scale_factor</span>\n                <span class=\"n\">rot</span> <span class=\"o\">=</span> <span class=\"p\">(</span>\n                    <span class=\"n\">rot</span>\n                    <span class=\"o\">-</span> <span class=\"n\">r</span>\n                    <span class=\"o\">*</span> <span class=\"p\">(</span><span class=\"n\">box</span><span class=\"p\">[</span><span class=\"n\">Box</span><span class=\"o\">.</span><span class=\"n\">BOTTOM_LEFT</span><span class=\"p\">]</span> <span class=\"o\">-</span> <span class=\"n\">box</span><span class=\"p\">[</span><span class=\"n\">Box</span><span class=\"o\">.</span><span class=\"n\">TOP_LEFT</span><span class=\"p\">])</span>\n                    <span class=\"o\">/</span> <span class=\"n\">length_box</span>\n                <span class=\"p\">)</span>\n            <span class=\"n\">box</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">box</span><span class=\"p\">,</span> <span class=\"p\">[</span><span class=\"n\">rot</span><span class=\"p\">],</span> <span class=\"n\">axis</span><span class=\"o\">=</span><span class=\"mi\">0</span><span class=\"p\">)</span>\n\n        <span class=\"k\">return</span> <span class=\"n\">box</span></div>\n\n    <span class=\"k\">def</span> <span class=\"nf\">_outline_shapes</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"sd\">\"\"\"Find outlines of any selected or hovered shapes.</span>\n\n<span class=\"sd\">        Returns</span>\n<span class=\"sd\">        -------</span>\n<span class=\"sd\">        vertices : None | np.ndarray</span>\n<span class=\"sd\">            Nx2 array of any vertices of outline or None</span>\n<span class=\"sd\">        triangles : None | np.ndarray</span>\n<span class=\"sd\">            Mx3 array of any indices of vertices for triangles of outline or</span>\n<span class=\"sd\">            None</span>\n<span class=\"sd\">        \"\"\"</span>\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_value</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span> <span class=\"ow\">and</span> <span class=\"p\">(</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_value</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span> <span class=\"ow\">or</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">selected_data</span><span class=\"p\">)</span> <span class=\"o\">&gt;</span> <span class=\"mi\">0</span>\n        <span class=\"p\">):</span>\n            <span class=\"k\">if</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">selected_data</span><span class=\"p\">)</span> <span class=\"o\">&gt;</span> <span class=\"mi\">0</span><span class=\"p\">:</span>\n                <span class=\"n\">index</span> <span class=\"o\">=</span> <span class=\"nb\">list</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">selected_data</span><span class=\"p\">)</span>\n                <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_value</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n                    <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_value</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span> <span class=\"ow\">in</span> <span class=\"n\">index</span><span class=\"p\">:</span>\n                        <span class=\"k\">pass</span>\n                    <span class=\"k\">else</span><span class=\"p\">:</span>\n                        <span class=\"n\">index</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_value</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">])</span>\n                <span class=\"n\">index</span><span class=\"o\">.</span><span class=\"n\">sort</span><span class=\"p\">()</span>\n            <span class=\"k\">else</span><span class=\"p\">:</span>\n                <span class=\"n\">index</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_value</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span>\n\n            <span class=\"n\">centers</span><span class=\"p\">,</span> <span class=\"n\">offsets</span><span class=\"p\">,</span> <span class=\"n\">triangles</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_data_view</span><span class=\"o\">.</span><span class=\"n\">outline</span><span class=\"p\">(</span><span class=\"n\">index</span><span class=\"p\">)</span>\n            <span class=\"n\">vertices</span> <span class=\"o\">=</span> <span class=\"n\">centers</span> <span class=\"o\">+</span> <span class=\"p\">(</span>\n                <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">scale_factor</span> <span class=\"o\">*</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_highlight_width</span> <span class=\"o\">*</span> <span class=\"n\">offsets</span>\n            <span class=\"p\">)</span>\n            <span class=\"n\">vertices</span> <span class=\"o\">=</span> <span class=\"n\">vertices</span><span class=\"p\">[:,</span> <span class=\"p\">::</span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">]</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"n\">vertices</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n            <span class=\"n\">triangles</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n\n        <span class=\"k\">return</span> <span class=\"n\">vertices</span><span class=\"p\">,</span> <span class=\"n\">triangles</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">_compute_vertices_and_box</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"sd\">\"\"\"Compute location of highlight vertices and box for rendering.</span>\n\n<span class=\"sd\">        Returns</span>\n<span class=\"sd\">        -------</span>\n<span class=\"sd\">        vertices : np.ndarray</span>\n<span class=\"sd\">            Nx2 array of any vertices to be rendered as Markers</span>\n<span class=\"sd\">        face_color : str</span>\n<span class=\"sd\">            String of the face color of the Markers</span>\n<span class=\"sd\">        edge_color : str</span>\n<span class=\"sd\">            String of the edge color of the Markers and Line for the box</span>\n<span class=\"sd\">        pos : np.ndarray</span>\n<span class=\"sd\">            Nx2 array of vertices of the box that will be rendered using a</span>\n<span class=\"sd\">            Vispy Line</span>\n<span class=\"sd\">        width : float</span>\n<span class=\"sd\">            Width of the box edge</span>\n<span class=\"sd\">        \"\"\"</span>\n        <span class=\"k\">if</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">selected_data</span><span class=\"p\">)</span> <span class=\"o\">&gt;</span> <span class=\"mi\">0</span><span class=\"p\">:</span>\n            <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_mode</span> <span class=\"o\">==</span> <span class=\"n\">Mode</span><span class=\"o\">.</span><span class=\"n\">SELECT</span><span class=\"p\">:</span>\n                <span class=\"c1\"># If in select mode just show the interaction boudning box</span>\n                <span class=\"c1\"># including its vertices and the rotation handle</span>\n                <span class=\"n\">box</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_selected_box</span><span class=\"p\">[</span><span class=\"n\">Box</span><span class=\"o\">.</span><span class=\"n\">WITH_HANDLE</span><span class=\"p\">]</span>\n                <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_value</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n                    <span class=\"n\">face_color</span> <span class=\"o\">=</span> <span class=\"s1\">'white'</span>\n                <span class=\"k\">elif</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_value</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">]</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n                    <span class=\"n\">face_color</span> <span class=\"o\">=</span> <span class=\"s1\">'white'</span>\n                <span class=\"k\">else</span><span class=\"p\">:</span>\n                    <span class=\"n\">face_color</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_highlight_color</span>\n                <span class=\"n\">edge_color</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_highlight_color</span>\n                <span class=\"n\">vertices</span> <span class=\"o\">=</span> <span class=\"n\">box</span><span class=\"p\">[:,</span> <span class=\"p\">::</span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">]</span>\n                <span class=\"c1\"># Use a subset of the vertices of the interaction_box to plot</span>\n                <span class=\"c1\"># the line around the edge</span>\n                <span class=\"n\">pos</span> <span class=\"o\">=</span> <span class=\"n\">box</span><span class=\"p\">[</span><span class=\"n\">Box</span><span class=\"o\">.</span><span class=\"n\">LINE_HANDLE</span><span class=\"p\">][:,</span> <span class=\"p\">::</span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">]</span>\n                <span class=\"n\">width</span> <span class=\"o\">=</span> <span class=\"mf\">1.5</span>\n            <span class=\"k\">elif</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_mode</span> <span class=\"ow\">in</span> <span class=\"p\">(</span>\n                <span class=\"p\">[</span>\n                    <span class=\"n\">Mode</span><span class=\"o\">.</span><span class=\"n\">DIRECT</span><span class=\"p\">,</span>\n                    <span class=\"n\">Mode</span><span class=\"o\">.</span><span class=\"n\">ADD_PATH</span><span class=\"p\">,</span>\n                    <span class=\"n\">Mode</span><span class=\"o\">.</span><span class=\"n\">ADD_POLYGON</span><span class=\"p\">,</span>\n                    <span class=\"n\">Mode</span><span class=\"o\">.</span><span class=\"n\">ADD_RECTANGLE</span><span class=\"p\">,</span>\n                    <span class=\"n\">Mode</span><span class=\"o\">.</span><span class=\"n\">ADD_ELLIPSE</span><span class=\"p\">,</span>\n                    <span class=\"n\">Mode</span><span class=\"o\">.</span><span class=\"n\">ADD_LINE</span><span class=\"p\">,</span>\n                    <span class=\"n\">Mode</span><span class=\"o\">.</span><span class=\"n\">VERTEX_INSERT</span><span class=\"p\">,</span>\n                    <span class=\"n\">Mode</span><span class=\"o\">.</span><span class=\"n\">VERTEX_REMOVE</span><span class=\"p\">,</span>\n                <span class=\"p\">]</span>\n            <span class=\"p\">):</span>\n                <span class=\"c1\"># If in one of these mode show the vertices of the shape itself</span>\n                <span class=\"n\">inds</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">isin</span><span class=\"p\">(</span>\n                    <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_data_view</span><span class=\"o\">.</span><span class=\"n\">displayed_index</span><span class=\"p\">,</span> <span class=\"nb\">list</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">selected_data</span><span class=\"p\">)</span>\n                <span class=\"p\">)</span>\n                <span class=\"n\">vertices</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_data_view</span><span class=\"o\">.</span><span class=\"n\">displayed_vertices</span><span class=\"p\">[</span><span class=\"n\">inds</span><span class=\"p\">][:,</span> <span class=\"p\">::</span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">]</span>\n                <span class=\"c1\"># If currently adding path don't show box over last vertex</span>\n                <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_mode</span> <span class=\"o\">==</span> <span class=\"n\">Mode</span><span class=\"o\">.</span><span class=\"n\">ADD_PATH</span><span class=\"p\">:</span>\n                    <span class=\"n\">vertices</span> <span class=\"o\">=</span> <span class=\"n\">vertices</span><span class=\"p\">[:</span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">]</span>\n\n                <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_value</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n                    <span class=\"n\">face_color</span> <span class=\"o\">=</span> <span class=\"s1\">'white'</span>\n                <span class=\"k\">elif</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_value</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">]</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n                    <span class=\"n\">face_color</span> <span class=\"o\">=</span> <span class=\"s1\">'white'</span>\n                <span class=\"k\">else</span><span class=\"p\">:</span>\n                    <span class=\"n\">face_color</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_highlight_color</span>\n                <span class=\"n\">edge_color</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_highlight_color</span>\n                <span class=\"n\">pos</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n                <span class=\"n\">width</span> <span class=\"o\">=</span> <span class=\"mi\">0</span>\n            <span class=\"k\">else</span><span class=\"p\">:</span>\n                <span class=\"c1\"># Otherwise show nothing</span>\n                <span class=\"n\">vertices</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">empty</span><span class=\"p\">((</span><span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">2</span><span class=\"p\">))</span>\n                <span class=\"n\">face_color</span> <span class=\"o\">=</span> <span class=\"s1\">'white'</span>\n                <span class=\"n\">edge_color</span> <span class=\"o\">=</span> <span class=\"s1\">'white'</span>\n                <span class=\"n\">pos</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n                <span class=\"n\">width</span> <span class=\"o\">=</span> <span class=\"mi\">0</span>\n        <span class=\"k\">elif</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_is_selecting</span><span class=\"p\">:</span>\n            <span class=\"c1\"># If currently dragging a selection box just show an outline of</span>\n            <span class=\"c1\"># that box</span>\n            <span class=\"n\">vertices</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">empty</span><span class=\"p\">((</span><span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">2</span><span class=\"p\">))</span>\n            <span class=\"n\">edge_color</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_highlight_color</span>\n            <span class=\"n\">face_color</span> <span class=\"o\">=</span> <span class=\"s1\">'white'</span>\n            <span class=\"n\">box</span> <span class=\"o\">=</span> <span class=\"n\">create_box</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_drag_box</span><span class=\"p\">)</span>\n            <span class=\"n\">width</span> <span class=\"o\">=</span> <span class=\"mf\">1.5</span>\n            <span class=\"c1\"># Use a subset of the vertices of the interaction_box to plot</span>\n            <span class=\"c1\"># the line around the edge</span>\n            <span class=\"n\">pos</span> <span class=\"o\">=</span> <span class=\"n\">box</span><span class=\"p\">[</span><span class=\"n\">Box</span><span class=\"o\">.</span><span class=\"n\">LINE</span><span class=\"p\">][:,</span> <span class=\"p\">::</span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">]</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"c1\"># Otherwise show nothing</span>\n            <span class=\"n\">vertices</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">empty</span><span class=\"p\">((</span><span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">2</span><span class=\"p\">))</span>\n            <span class=\"n\">face_color</span> <span class=\"o\">=</span> <span class=\"s1\">'white'</span>\n            <span class=\"n\">edge_color</span> <span class=\"o\">=</span> <span class=\"s1\">'white'</span>\n            <span class=\"n\">pos</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n            <span class=\"n\">width</span> <span class=\"o\">=</span> <span class=\"mi\">0</span>\n\n        <span class=\"k\">return</span> <span class=\"n\">vertices</span><span class=\"p\">,</span> <span class=\"n\">face_color</span><span class=\"p\">,</span> <span class=\"n\">edge_color</span><span class=\"p\">,</span> <span class=\"n\">pos</span><span class=\"p\">,</span> <span class=\"n\">width</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">_set_highlight</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">force</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">):</span>\n        <span class=\"sd\">\"\"\"Render highlights of shapes.</span>\n\n<span class=\"sd\">        Includes boundaries, vertices, interaction boxes, and the drag</span>\n<span class=\"sd\">        selection box when appropriate.</span>\n\n<span class=\"sd\">        Parameters</span>\n<span class=\"sd\">        ----------</span>\n<span class=\"sd\">        force : bool</span>\n<span class=\"sd\">            Bool that forces a redraw to occur when `True`</span>\n<span class=\"sd\">        \"\"\"</span>\n        <span class=\"c1\"># Check if any shape or vertex ids have changed since last call</span>\n        <span class=\"k\">if</span> <span class=\"p\">(</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">selected_data</span> <span class=\"o\">==</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_selected_data_stored</span>\n            <span class=\"ow\">and</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">all</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_value</span> <span class=\"o\">==</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_value_stored</span><span class=\"p\">)</span>\n            <span class=\"ow\">and</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">all</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_drag_box</span> <span class=\"o\">==</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_drag_box_stored</span><span class=\"p\">)</span>\n        <span class=\"p\">)</span> <span class=\"ow\">and</span> <span class=\"ow\">not</span> <span class=\"n\">force</span><span class=\"p\">:</span>\n            <span class=\"k\">return</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_selected_data_stored</span> <span class=\"o\">=</span> <span class=\"n\">copy</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">selected_data</span><span class=\"p\">)</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_value_stored</span> <span class=\"o\">=</span> <span class=\"n\">copy</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_value</span><span class=\"p\">)</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_drag_box_stored</span> <span class=\"o\">=</span> <span class=\"n\">copy</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_drag_box</span><span class=\"p\">)</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">events</span><span class=\"o\">.</span><span class=\"n\">highlight</span><span class=\"p\">()</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">_finish_drawing</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">event</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n        <span class=\"sd\">\"\"\"Reset properties used in shape drawing.\"\"\"</span>\n        <span class=\"n\">index</span> <span class=\"o\">=</span> <span class=\"n\">copy</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_moving_value</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">])</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_is_moving</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">selected_data</span> <span class=\"o\">=</span> <span class=\"nb\">set</span><span class=\"p\">()</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_drag_start</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_drag_box</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_is_selecting</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_fixed_vertex</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_value</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"kc\">None</span><span class=\"p\">,</span> <span class=\"kc\">None</span><span class=\"p\">)</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_moving_value</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"kc\">None</span><span class=\"p\">,</span> <span class=\"kc\">None</span><span class=\"p\">)</span>\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_is_creating</span> <span class=\"ow\">is</span> <span class=\"kc\">True</span> <span class=\"ow\">and</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_mode</span> <span class=\"o\">==</span> <span class=\"n\">Mode</span><span class=\"o\">.</span><span class=\"n\">ADD_PATH</span><span class=\"p\">:</span>\n            <span class=\"n\">vertices</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_data_view</span><span class=\"o\">.</span><span class=\"n\">shapes</span><span class=\"p\">[</span><span class=\"n\">index</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">data</span>\n            <span class=\"k\">if</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">vertices</span><span class=\"p\">)</span> <span class=\"o\">&lt;=</span> <span class=\"mi\">2</span><span class=\"p\">:</span>\n                <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_data_view</span><span class=\"o\">.</span><span class=\"n\">remove</span><span class=\"p\">(</span><span class=\"n\">index</span><span class=\"p\">)</span>\n            <span class=\"k\">else</span><span class=\"p\">:</span>\n                <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_data_view</span><span class=\"o\">.</span><span class=\"n\">edit</span><span class=\"p\">(</span><span class=\"n\">index</span><span class=\"p\">,</span> <span class=\"n\">vertices</span><span class=\"p\">[:</span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">])</span>\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_is_creating</span> <span class=\"ow\">is</span> <span class=\"kc\">True</span> <span class=\"ow\">and</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_mode</span> <span class=\"o\">==</span> <span class=\"n\">Mode</span><span class=\"o\">.</span><span class=\"n\">ADD_POLYGON</span><span class=\"p\">:</span>\n            <span class=\"n\">vertices</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_data_view</span><span class=\"o\">.</span><span class=\"n\">shapes</span><span class=\"p\">[</span><span class=\"n\">index</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">data</span>\n            <span class=\"k\">if</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">vertices</span><span class=\"p\">)</span> <span class=\"o\">&lt;=</span> <span class=\"mi\">3</span><span class=\"p\">:</span>\n                <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_data_view</span><span class=\"o\">.</span><span class=\"n\">remove</span><span class=\"p\">(</span><span class=\"n\">index</span><span class=\"p\">)</span>\n            <span class=\"k\">else</span><span class=\"p\">:</span>\n                <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_data_view</span><span class=\"o\">.</span><span class=\"n\">edit</span><span class=\"p\">(</span><span class=\"n\">index</span><span class=\"p\">,</span> <span class=\"n\">vertices</span><span class=\"p\">[:</span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">])</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_is_creating</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_update_dims</span><span class=\"p\">()</span>\n\n<div class=\"viewcode-block\" id=\"Shapes.block_thumbnail_update\"><a class=\"viewcode-back\" href=\"../../../../api/stable/napari.layers.Shapes.html#napari.layers.Shapes.block_thumbnail_update\">[docs]</a>    <span class=\"nd\">@contextmanager</span>\n    <span class=\"k\">def</span> <span class=\"nf\">block_thumbnail_update</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"sd\">\"\"\"Use this context manager to block thumbnail updates\"\"\"</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_allow_thumbnail_update</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n        <span class=\"k\">yield</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_allow_thumbnail_update</span> <span class=\"o\">=</span> <span class=\"kc\">True</span></div>\n\n    <span class=\"k\">def</span> <span class=\"nf\">_update_thumbnail</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">event</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n        <span class=\"sd\">\"\"\"Update thumbnail with current shapes and colors.\"\"\"</span>\n\n        <span class=\"c1\"># don't update the thumbnail if dragging a shape</span>\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_is_moving</span> <span class=\"ow\">is</span> <span class=\"kc\">False</span> <span class=\"ow\">and</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_allow_thumbnail_update</span> <span class=\"ow\">is</span> <span class=\"kc\">True</span><span class=\"p\">:</span>\n            <span class=\"c1\"># calculate min vals for the vertices and pad with 0.5</span>\n            <span class=\"c1\"># the offset is needed to ensure that the top left corner of the shapes</span>\n            <span class=\"c1\"># corresponds to the top left corner of the thumbnail</span>\n            <span class=\"n\">de</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_extent_data</span>\n            <span class=\"n\">offset</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">array</span><span class=\"p\">([</span><span class=\"n\">de</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"n\">d</span><span class=\"p\">]</span> <span class=\"k\">for</span> <span class=\"n\">d</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_dims_displayed</span><span class=\"p\">])</span> <span class=\"o\">+</span> <span class=\"mf\">0.5</span>\n            <span class=\"c1\"># calculate range of values for the vertices and pad with 1</span>\n            <span class=\"c1\"># padding ensures the entire shape can be represented in the thumbnail</span>\n            <span class=\"c1\"># without getting clipped</span>\n            <span class=\"n\">shape</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">ceil</span><span class=\"p\">(</span>\n                <span class=\"p\">[</span><span class=\"n\">de</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"n\">d</span><span class=\"p\">]</span> <span class=\"o\">-</span> <span class=\"n\">de</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"n\">d</span><span class=\"p\">]</span> <span class=\"o\">+</span> <span class=\"mi\">1</span> <span class=\"k\">for</span> <span class=\"n\">d</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_dims_displayed</span><span class=\"p\">]</span>\n            <span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">astype</span><span class=\"p\">(</span><span class=\"nb\">int</span><span class=\"p\">)</span>\n            <span class=\"n\">zoom_factor</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">divide</span><span class=\"p\">(</span>\n                <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_thumbnail_shape</span><span class=\"p\">[:</span><span class=\"mi\">2</span><span class=\"p\">],</span> <span class=\"n\">shape</span><span class=\"p\">[</span><span class=\"o\">-</span><span class=\"mi\">2</span><span class=\"p\">:]</span>\n            <span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">min</span><span class=\"p\">()</span>\n\n            <span class=\"n\">colormapped</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_data_view</span><span class=\"o\">.</span><span class=\"n\">to_colors</span><span class=\"p\">(</span>\n                <span class=\"n\">colors_shape</span><span class=\"o\">=</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_thumbnail_shape</span><span class=\"p\">[:</span><span class=\"mi\">2</span><span class=\"p\">],</span>\n                <span class=\"n\">zoom_factor</span><span class=\"o\">=</span><span class=\"n\">zoom_factor</span><span class=\"p\">,</span>\n                <span class=\"n\">offset</span><span class=\"o\">=</span><span class=\"n\">offset</span><span class=\"p\">[</span><span class=\"o\">-</span><span class=\"mi\">2</span><span class=\"p\">:],</span>\n                <span class=\"n\">max_shapes</span><span class=\"o\">=</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_max_shapes_thumbnail</span><span class=\"p\">,</span>\n            <span class=\"p\">)</span>\n\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">thumbnail</span> <span class=\"o\">=</span> <span class=\"n\">colormapped</span>\n\n<div class=\"viewcode-block\" id=\"Shapes.remove_selected\"><a class=\"viewcode-back\" href=\"../../../../api/stable/napari.layers.Shapes.html#napari.layers.Shapes.remove_selected\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">remove_selected</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"sd\">\"\"\"Remove any selected shapes.\"\"\"</span>\n        <span class=\"n\">index</span> <span class=\"o\">=</span> <span class=\"nb\">list</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">selected_data</span><span class=\"p\">)</span>\n        <span class=\"n\">to_remove</span> <span class=\"o\">=</span> <span class=\"nb\">sorted</span><span class=\"p\">(</span><span class=\"n\">index</span><span class=\"p\">,</span> <span class=\"n\">reverse</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n        <span class=\"k\">for</span> <span class=\"n\">ind</span> <span class=\"ow\">in</span> <span class=\"n\">to_remove</span><span class=\"p\">:</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_data_view</span><span class=\"o\">.</span><span class=\"n\">remove</span><span class=\"p\">(</span><span class=\"n\">ind</span><span class=\"p\">)</span>\n\n        <span class=\"k\">if</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">index</span><span class=\"p\">)</span> <span class=\"o\">&gt;</span> <span class=\"mi\">0</span><span class=\"p\">:</span>\n            <span class=\"k\">for</span> <span class=\"n\">k</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">properties</span><span class=\"p\">:</span>\n                <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">properties</span><span class=\"p\">[</span><span class=\"n\">k</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">delete</span><span class=\"p\">(</span>\n                    <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">properties</span><span class=\"p\">[</span><span class=\"n\">k</span><span class=\"p\">],</span> <span class=\"n\">index</span><span class=\"p\">,</span> <span class=\"n\">axis</span><span class=\"o\">=</span><span class=\"mi\">0</span>\n                <span class=\"p\">)</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">text</span><span class=\"o\">.</span><span class=\"n\">remove</span><span class=\"p\">(</span><span class=\"n\">index</span><span class=\"p\">)</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_data_view</span><span class=\"o\">.</span><span class=\"n\">_edge_color</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">delete</span><span class=\"p\">(</span>\n                <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_data_view</span><span class=\"o\">.</span><span class=\"n\">_edge_color</span><span class=\"p\">,</span> <span class=\"n\">index</span><span class=\"p\">,</span> <span class=\"n\">axis</span><span class=\"o\">=</span><span class=\"mi\">0</span>\n            <span class=\"p\">)</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_data_view</span><span class=\"o\">.</span><span class=\"n\">_face_color</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">delete</span><span class=\"p\">(</span>\n                <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_data_view</span><span class=\"o\">.</span><span class=\"n\">_face_color</span><span class=\"p\">,</span> <span class=\"n\">index</span><span class=\"p\">,</span> <span class=\"n\">axis</span><span class=\"o\">=</span><span class=\"mi\">0</span>\n            <span class=\"p\">)</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">selected_data</span> <span class=\"o\">=</span> <span class=\"nb\">set</span><span class=\"p\">()</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_finish_drawing</span><span class=\"p\">()</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">events</span><span class=\"o\">.</span><span class=\"n\">data</span><span class=\"p\">(</span><span class=\"n\">value</span><span class=\"o\">=</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">data</span><span class=\"p\">)</span></div>\n\n    <span class=\"k\">def</span> <span class=\"nf\">_rotate_box</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">angle</span><span class=\"p\">,</span> <span class=\"n\">center</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">]):</span>\n        <span class=\"sd\">\"\"\"Perform a rotation on the selected box.</span>\n\n<span class=\"sd\">        Parameters</span>\n<span class=\"sd\">        ----------</span>\n<span class=\"sd\">        angle : float</span>\n<span class=\"sd\">            angle specifying rotation of shapes in degrees.</span>\n<span class=\"sd\">        center : list</span>\n<span class=\"sd\">            coordinates of center of rotation.</span>\n<span class=\"sd\">        \"\"\"</span>\n        <span class=\"n\">theta</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">radians</span><span class=\"p\">(</span><span class=\"n\">angle</span><span class=\"p\">)</span>\n        <span class=\"n\">transform</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">array</span><span class=\"p\">(</span>\n            <span class=\"p\">[[</span><span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">cos</span><span class=\"p\">(</span><span class=\"n\">theta</span><span class=\"p\">),</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">sin</span><span class=\"p\">(</span><span class=\"n\">theta</span><span class=\"p\">)],</span> <span class=\"p\">[</span><span class=\"o\">-</span><span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">sin</span><span class=\"p\">(</span><span class=\"n\">theta</span><span class=\"p\">),</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">cos</span><span class=\"p\">(</span><span class=\"n\">theta</span><span class=\"p\">)]]</span>\n        <span class=\"p\">)</span>\n        <span class=\"n\">box</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_selected_box</span> <span class=\"o\">-</span> <span class=\"n\">center</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_selected_box</span> <span class=\"o\">=</span> <span class=\"n\">box</span> <span class=\"o\">@</span> <span class=\"n\">transform</span><span class=\"o\">.</span><span class=\"n\">T</span> <span class=\"o\">+</span> <span class=\"n\">center</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">_scale_box</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">scale</span><span class=\"p\">,</span> <span class=\"n\">center</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">]):</span>\n        <span class=\"sd\">\"\"\"Perform a scaling on the selected box.</span>\n\n<span class=\"sd\">        Parameters</span>\n<span class=\"sd\">        ----------</span>\n<span class=\"sd\">        scale : float, list</span>\n<span class=\"sd\">            scalar or list specifying rescaling of shape.</span>\n<span class=\"sd\">        center : list</span>\n<span class=\"sd\">            coordinates of center of rotation.</span>\n<span class=\"sd\">        \"\"\"</span>\n        <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">scale</span><span class=\"p\">,</span> <span class=\"p\">(</span><span class=\"nb\">list</span><span class=\"p\">,</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">ndarray</span><span class=\"p\">)):</span>\n            <span class=\"n\">scale</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"n\">scale</span><span class=\"p\">,</span> <span class=\"n\">scale</span><span class=\"p\">]</span>\n        <span class=\"n\">box</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_selected_box</span> <span class=\"o\">-</span> <span class=\"n\">center</span>\n        <span class=\"n\">box</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">array</span><span class=\"p\">(</span><span class=\"n\">box</span> <span class=\"o\">*</span> <span class=\"n\">scale</span><span class=\"p\">)</span>\n        <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">all</span><span class=\"p\">(</span><span class=\"n\">box</span><span class=\"p\">[</span><span class=\"n\">Box</span><span class=\"o\">.</span><span class=\"n\">TOP_CENTER</span><span class=\"p\">]</span> <span class=\"o\">==</span> <span class=\"n\">box</span><span class=\"p\">[</span><span class=\"n\">Box</span><span class=\"o\">.</span><span class=\"n\">HANDLE</span><span class=\"p\">]):</span>\n            <span class=\"n\">r</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_rotation_handle_length</span> <span class=\"o\">*</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">scale_factor</span>\n            <span class=\"n\">handle_vec</span> <span class=\"o\">=</span> <span class=\"n\">box</span><span class=\"p\">[</span><span class=\"n\">Box</span><span class=\"o\">.</span><span class=\"n\">HANDLE</span><span class=\"p\">]</span> <span class=\"o\">-</span> <span class=\"n\">box</span><span class=\"p\">[</span><span class=\"n\">Box</span><span class=\"o\">.</span><span class=\"n\">TOP_CENTER</span><span class=\"p\">]</span>\n            <span class=\"n\">cur_len</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">linalg</span><span class=\"o\">.</span><span class=\"n\">norm</span><span class=\"p\">(</span><span class=\"n\">handle_vec</span><span class=\"p\">)</span>\n            <span class=\"n\">box</span><span class=\"p\">[</span><span class=\"n\">Box</span><span class=\"o\">.</span><span class=\"n\">HANDLE</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">box</span><span class=\"p\">[</span><span class=\"n\">Box</span><span class=\"o\">.</span><span class=\"n\">TOP_CENTER</span><span class=\"p\">]</span> <span class=\"o\">+</span> <span class=\"n\">r</span> <span class=\"o\">*</span> <span class=\"n\">handle_vec</span> <span class=\"o\">/</span> <span class=\"n\">cur_len</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_selected_box</span> <span class=\"o\">=</span> <span class=\"n\">box</span> <span class=\"o\">+</span> <span class=\"n\">center</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">_transform_box</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">transform</span><span class=\"p\">,</span> <span class=\"n\">center</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">]):</span>\n        <span class=\"sd\">\"\"\"Perform a linear transformation on the selected box.</span>\n\n<span class=\"sd\">        Parameters</span>\n<span class=\"sd\">        ----------</span>\n<span class=\"sd\">        transform : np.ndarray</span>\n<span class=\"sd\">            2x2 array specifying linear transform.</span>\n<span class=\"sd\">        center : list</span>\n<span class=\"sd\">            coordinates of center of rotation.</span>\n<span class=\"sd\">        \"\"\"</span>\n        <span class=\"n\">box</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_selected_box</span> <span class=\"o\">-</span> <span class=\"n\">center</span>\n        <span class=\"n\">box</span> <span class=\"o\">=</span> <span class=\"n\">box</span> <span class=\"o\">@</span> <span class=\"n\">transform</span><span class=\"o\">.</span><span class=\"n\">T</span>\n        <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">all</span><span class=\"p\">(</span><span class=\"n\">box</span><span class=\"p\">[</span><span class=\"n\">Box</span><span class=\"o\">.</span><span class=\"n\">TOP_CENTER</span><span class=\"p\">]</span> <span class=\"o\">==</span> <span class=\"n\">box</span><span class=\"p\">[</span><span class=\"n\">Box</span><span class=\"o\">.</span><span class=\"n\">HANDLE</span><span class=\"p\">]):</span>\n            <span class=\"n\">r</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_rotation_handle_length</span> <span class=\"o\">*</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">scale_factor</span>\n            <span class=\"n\">handle_vec</span> <span class=\"o\">=</span> <span class=\"n\">box</span><span class=\"p\">[</span><span class=\"n\">Box</span><span class=\"o\">.</span><span class=\"n\">HANDLE</span><span class=\"p\">]</span> <span class=\"o\">-</span> <span class=\"n\">box</span><span class=\"p\">[</span><span class=\"n\">Box</span><span class=\"o\">.</span><span class=\"n\">TOP_CENTER</span><span class=\"p\">]</span>\n            <span class=\"n\">cur_len</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">linalg</span><span class=\"o\">.</span><span class=\"n\">norm</span><span class=\"p\">(</span><span class=\"n\">handle_vec</span><span class=\"p\">)</span>\n            <span class=\"n\">box</span><span class=\"p\">[</span><span class=\"n\">Box</span><span class=\"o\">.</span><span class=\"n\">HANDLE</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">box</span><span class=\"p\">[</span><span class=\"n\">Box</span><span class=\"o\">.</span><span class=\"n\">TOP_CENTER</span><span class=\"p\">]</span> <span class=\"o\">+</span> <span class=\"n\">r</span> <span class=\"o\">*</span> <span class=\"n\">handle_vec</span> <span class=\"o\">/</span> <span class=\"n\">cur_len</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_selected_box</span> <span class=\"o\">=</span> <span class=\"n\">box</span> <span class=\"o\">+</span> <span class=\"n\">center</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">_get_value</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">position</span><span class=\"p\">):</span>\n        <span class=\"sd\">\"\"\"Value of the data at a position in data coordinates.</span>\n\n<span class=\"sd\">        Parameters</span>\n<span class=\"sd\">        ----------</span>\n<span class=\"sd\">        position : tuple</span>\n<span class=\"sd\">            Position in data coordinates.</span>\n\n<span class=\"sd\">        Returns</span>\n<span class=\"sd\">        -------</span>\n<span class=\"sd\">        shape : int | None</span>\n<span class=\"sd\">            Index of shape if any that is at the coordinates. Returns `None`</span>\n<span class=\"sd\">            if no shape is found.</span>\n<span class=\"sd\">        vertex : int | None</span>\n<span class=\"sd\">            Index of vertex if any that is at the coordinates. Returns `None`</span>\n<span class=\"sd\">            if no vertex is found.</span>\n<span class=\"sd\">        \"\"\"</span>\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_ndisplay</span> <span class=\"o\">==</span> <span class=\"mi\">3</span><span class=\"p\">:</span>\n            <span class=\"k\">return</span> <span class=\"p\">(</span><span class=\"kc\">None</span><span class=\"p\">,</span> <span class=\"kc\">None</span><span class=\"p\">)</span>\n\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_is_moving</span><span class=\"p\">:</span>\n            <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_moving_value</span>\n\n        <span class=\"n\">coord</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"n\">position</span><span class=\"p\">[</span><span class=\"n\">i</span><span class=\"p\">]</span> <span class=\"k\">for</span> <span class=\"n\">i</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_dims_displayed</span><span class=\"p\">]</span>\n\n        <span class=\"c1\"># Check selected shapes</span>\n        <span class=\"n\">value</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n        <span class=\"n\">selected_index</span> <span class=\"o\">=</span> <span class=\"nb\">list</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">selected_data</span><span class=\"p\">)</span>\n        <span class=\"k\">if</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">selected_index</span><span class=\"p\">)</span> <span class=\"o\">&gt;</span> <span class=\"mi\">0</span><span class=\"p\">:</span>\n            <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_mode</span> <span class=\"o\">==</span> <span class=\"n\">Mode</span><span class=\"o\">.</span><span class=\"n\">SELECT</span><span class=\"p\">:</span>\n                <span class=\"c1\"># Check if inside vertex of interaction box or rotation handle</span>\n                <span class=\"n\">box</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_selected_box</span><span class=\"p\">[</span><span class=\"n\">Box</span><span class=\"o\">.</span><span class=\"n\">WITH_HANDLE</span><span class=\"p\">]</span>\n                <span class=\"n\">distances</span> <span class=\"o\">=</span> <span class=\"nb\">abs</span><span class=\"p\">(</span><span class=\"n\">box</span> <span class=\"o\">-</span> <span class=\"n\">coord</span><span class=\"p\">)</span>\n\n                <span class=\"c1\"># Get the vertex sizes</span>\n                <span class=\"n\">sizes</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_vertex_size</span> <span class=\"o\">*</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">scale_factor</span> <span class=\"o\">/</span> <span class=\"mi\">2</span>\n\n                <span class=\"c1\"># Check if any matching vertices</span>\n                <span class=\"n\">matches</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">all</span><span class=\"p\">(</span><span class=\"n\">distances</span> <span class=\"o\">&lt;=</span> <span class=\"n\">sizes</span><span class=\"p\">,</span> <span class=\"n\">axis</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">nonzero</span><span class=\"p\">()</span>\n                <span class=\"k\">if</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">matches</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">])</span> <span class=\"o\">&gt;</span> <span class=\"mi\">0</span><span class=\"p\">:</span>\n                    <span class=\"n\">value</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"n\">selected_index</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">],</span> <span class=\"n\">matches</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">][</span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">])</span>\n            <span class=\"k\">elif</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_mode</span> <span class=\"ow\">in</span> <span class=\"p\">(</span>\n                <span class=\"p\">[</span><span class=\"n\">Mode</span><span class=\"o\">.</span><span class=\"n\">DIRECT</span><span class=\"p\">,</span> <span class=\"n\">Mode</span><span class=\"o\">.</span><span class=\"n\">VERTEX_INSERT</span><span class=\"p\">,</span> <span class=\"n\">Mode</span><span class=\"o\">.</span><span class=\"n\">VERTEX_REMOVE</span><span class=\"p\">]</span>\n            <span class=\"p\">):</span>\n                <span class=\"c1\"># Check if inside vertex of shape</span>\n                <span class=\"n\">inds</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">isin</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_data_view</span><span class=\"o\">.</span><span class=\"n\">displayed_index</span><span class=\"p\">,</span> <span class=\"n\">selected_index</span><span class=\"p\">)</span>\n                <span class=\"n\">vertices</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_data_view</span><span class=\"o\">.</span><span class=\"n\">displayed_vertices</span><span class=\"p\">[</span><span class=\"n\">inds</span><span class=\"p\">]</span>\n                <span class=\"n\">distances</span> <span class=\"o\">=</span> <span class=\"nb\">abs</span><span class=\"p\">(</span><span class=\"n\">vertices</span> <span class=\"o\">-</span> <span class=\"n\">coord</span><span class=\"p\">)</span>\n\n                <span class=\"c1\"># Get the vertex sizes</span>\n                <span class=\"n\">sizes</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_vertex_size</span> <span class=\"o\">*</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">scale_factor</span> <span class=\"o\">/</span> <span class=\"mi\">2</span>\n\n                <span class=\"c1\"># Check if any matching vertices</span>\n                <span class=\"n\">matches</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">all</span><span class=\"p\">(</span><span class=\"n\">distances</span> <span class=\"o\">&lt;=</span> <span class=\"n\">sizes</span><span class=\"p\">,</span> <span class=\"n\">axis</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">nonzero</span><span class=\"p\">()[</span><span class=\"mi\">0</span><span class=\"p\">]</span>\n                <span class=\"k\">if</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">matches</span><span class=\"p\">)</span> <span class=\"o\">&gt;</span> <span class=\"mi\">0</span><span class=\"p\">:</span>\n                    <span class=\"n\">index</span> <span class=\"o\">=</span> <span class=\"n\">inds</span><span class=\"o\">.</span><span class=\"n\">nonzero</span><span class=\"p\">()[</span><span class=\"mi\">0</span><span class=\"p\">][</span><span class=\"n\">matches</span><span class=\"p\">[</span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">]]</span>\n                    <span class=\"n\">shape</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_data_view</span><span class=\"o\">.</span><span class=\"n\">displayed_index</span><span class=\"p\">[</span><span class=\"n\">index</span><span class=\"p\">]</span>\n                    <span class=\"n\">vals</span><span class=\"p\">,</span> <span class=\"n\">idx</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">unique</span><span class=\"p\">(</span>\n                        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_data_view</span><span class=\"o\">.</span><span class=\"n\">displayed_index</span><span class=\"p\">,</span> <span class=\"n\">return_index</span><span class=\"o\">=</span><span class=\"kc\">True</span>\n                    <span class=\"p\">)</span>\n                    <span class=\"n\">shape_in_list</span> <span class=\"o\">=</span> <span class=\"nb\">list</span><span class=\"p\">(</span><span class=\"n\">vals</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">index</span><span class=\"p\">(</span><span class=\"n\">shape</span><span class=\"p\">)</span>\n                    <span class=\"n\">value</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"n\">shape</span><span class=\"p\">,</span> <span class=\"n\">index</span> <span class=\"o\">-</span> <span class=\"n\">idx</span><span class=\"p\">[</span><span class=\"n\">shape_in_list</span><span class=\"p\">])</span>\n\n        <span class=\"k\">if</span> <span class=\"n\">value</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n            <span class=\"c1\"># Check if mouse inside shape</span>\n            <span class=\"n\">shape</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_data_view</span><span class=\"o\">.</span><span class=\"n\">inside</span><span class=\"p\">(</span><span class=\"n\">coord</span><span class=\"p\">)</span>\n            <span class=\"n\">value</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"n\">shape</span><span class=\"p\">,</span> <span class=\"kc\">None</span><span class=\"p\">)</span>\n\n        <span class=\"k\">return</span> <span class=\"n\">value</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">_get_value_3d</span><span class=\"p\">(</span>\n        <span class=\"bp\">self</span><span class=\"p\">,</span>\n        <span class=\"n\">start_point</span><span class=\"p\">:</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">ndarray</span><span class=\"p\">,</span>\n        <span class=\"n\">end_point</span><span class=\"p\">:</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">ndarray</span><span class=\"p\">,</span>\n        <span class=\"n\">dims_displayed</span><span class=\"p\">:</span> <span class=\"n\">List</span><span class=\"p\">[</span><span class=\"nb\">int</span><span class=\"p\">],</span>\n    <span class=\"p\">)</span> <span class=\"o\">-&gt;</span> <span class=\"n\">Tuple</span><span class=\"p\">[</span><span class=\"n\">Union</span><span class=\"p\">[</span><span class=\"nb\">float</span><span class=\"p\">,</span> <span class=\"nb\">int</span><span class=\"p\">],</span> <span class=\"kc\">None</span><span class=\"p\">]:</span>\n        <span class=\"sd\">\"\"\"Get the layer data value along a ray</span>\n\n<span class=\"sd\">        Parameters</span>\n<span class=\"sd\">        ----------</span>\n<span class=\"sd\">        start_point : np.ndarray</span>\n<span class=\"sd\">            The start position of the ray used to interrogate the data.</span>\n<span class=\"sd\">        end_point : np.ndarray</span>\n<span class=\"sd\">            The end position of the ray used to interrogate the data.</span>\n<span class=\"sd\">        dims_displayed : List[int]</span>\n<span class=\"sd\">            The indices of the dimensions currently displayed in the Viewer.</span>\n\n<span class=\"sd\">        Returns</span>\n<span class=\"sd\">        -------</span>\n<span class=\"sd\">        value</span>\n<span class=\"sd\">            The data value along the supplied ray.</span>\n<span class=\"sd\">        vertex : None</span>\n<span class=\"sd\">            Index of vertex if any that is at the coordinates. Always returns `None`.</span>\n<span class=\"sd\">        \"\"\"</span>\n        <span class=\"n\">value</span><span class=\"p\">,</span> <span class=\"n\">_</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_get_index_and_intersection</span><span class=\"p\">(</span>\n            <span class=\"n\">start_point</span><span class=\"o\">=</span><span class=\"n\">start_point</span><span class=\"p\">,</span>\n            <span class=\"n\">end_point</span><span class=\"o\">=</span><span class=\"n\">end_point</span><span class=\"p\">,</span>\n            <span class=\"n\">dims_displayed</span><span class=\"o\">=</span><span class=\"n\">dims_displayed</span><span class=\"p\">,</span>\n        <span class=\"p\">)</span>\n\n        <span class=\"k\">return</span> <span class=\"p\">(</span><span class=\"n\">value</span><span class=\"p\">,</span> <span class=\"kc\">None</span><span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">_get_index_and_intersection</span><span class=\"p\">(</span>\n        <span class=\"bp\">self</span><span class=\"p\">,</span>\n        <span class=\"n\">start_point</span><span class=\"p\">:</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">ndarray</span><span class=\"p\">,</span>\n        <span class=\"n\">end_point</span><span class=\"p\">:</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">ndarray</span><span class=\"p\">,</span>\n        <span class=\"n\">dims_displayed</span><span class=\"p\">:</span> <span class=\"n\">List</span><span class=\"p\">[</span><span class=\"nb\">int</span><span class=\"p\">],</span>\n    <span class=\"p\">)</span> <span class=\"o\">-&gt;</span> <span class=\"n\">Tuple</span><span class=\"p\">[</span><span class=\"n\">Union</span><span class=\"p\">[</span><span class=\"nb\">float</span><span class=\"p\">,</span> <span class=\"nb\">int</span><span class=\"p\">],</span> <span class=\"kc\">None</span><span class=\"p\">]:</span>\n        <span class=\"sd\">\"\"\"Get the shape index and intersection point of the first shape</span>\n<span class=\"sd\">        (i.e., closest to start_point) along the specified 3D line segment.</span>\n\n<span class=\"sd\">        Note: this method is meant to be used for 3D intersection and returns</span>\n<span class=\"sd\">        (None, None) when used in 2D (i.e., len(dims_displayed) is 2).</span>\n\n<span class=\"sd\">        Parameters</span>\n<span class=\"sd\">        ----------</span>\n<span class=\"sd\">        start_point : np.ndarray</span>\n<span class=\"sd\">            The start position of the ray used to interrogate the data in</span>\n<span class=\"sd\">            layer coordinates.</span>\n<span class=\"sd\">        end_point : np.ndarray</span>\n<span class=\"sd\">            The end position of the ray used to interrogate the data in</span>\n<span class=\"sd\">            layer coordinates.</span>\n<span class=\"sd\">        dims_displayed : List[int]</span>\n<span class=\"sd\">            The indices of the dimensions currently displayed in the Viewer.</span>\n\n<span class=\"sd\">        Returns</span>\n<span class=\"sd\">        -------</span>\n<span class=\"sd\">        value</span>\n<span class=\"sd\">            The data value along the supplied ray.</span>\n<span class=\"sd\">        intersection_point : np.ndarray</span>\n<span class=\"sd\">            (n,) array containing the point where the ray intersects the first shape</span>\n<span class=\"sd\">            (i.e., the shape most in the foreground). The coordinate is in layer</span>\n<span class=\"sd\">            coordinates.</span>\n<span class=\"sd\">        \"\"\"</span>\n        <span class=\"k\">if</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">dims_displayed</span><span class=\"p\">)</span> <span class=\"o\">==</span> <span class=\"mi\">3</span><span class=\"p\">:</span>\n            <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"n\">start_point</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span><span class=\"p\">)</span> <span class=\"ow\">and</span> <span class=\"p\">(</span><span class=\"n\">end_point</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span><span class=\"p\">):</span>\n                <span class=\"c1\"># Get the normal vector of the click plane</span>\n                <span class=\"n\">start_position_view</span> <span class=\"o\">=</span> <span class=\"n\">start_point</span><span class=\"p\">[</span><span class=\"n\">dims_displayed</span><span class=\"p\">]</span>\n                <span class=\"n\">end_position_view</span> <span class=\"o\">=</span> <span class=\"n\">end_point</span><span class=\"p\">[</span><span class=\"n\">dims_displayed</span><span class=\"p\">]</span>\n                <span class=\"n\">ray_direction</span> <span class=\"o\">=</span> <span class=\"n\">end_position_view</span> <span class=\"o\">-</span> <span class=\"n\">start_position_view</span>\n                <span class=\"n\">ray_direction_normed</span> <span class=\"o\">=</span> <span class=\"n\">ray_direction</span> <span class=\"o\">/</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">linalg</span><span class=\"o\">.</span><span class=\"n\">norm</span><span class=\"p\">(</span>\n                    <span class=\"n\">ray_direction</span>\n                <span class=\"p\">)</span>\n                <span class=\"c1\"># step the start position back a little bit to be able to detect shapes</span>\n                <span class=\"c1\"># that contain the start_position</span>\n                <span class=\"n\">start_position_view</span> <span class=\"o\">=</span> <span class=\"p\">(</span>\n                    <span class=\"n\">start_position_view</span> <span class=\"o\">-</span> <span class=\"mf\">0.1</span> <span class=\"o\">*</span> <span class=\"n\">ray_direction_normed</span>\n                <span class=\"p\">)</span>\n                <span class=\"n\">value</span><span class=\"p\">,</span> <span class=\"n\">intersection</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_data_view</span><span class=\"o\">.</span><span class=\"n\">_inside_3d</span><span class=\"p\">(</span>\n                    <span class=\"n\">start_position_view</span><span class=\"p\">,</span> <span class=\"n\">ray_direction_normed</span>\n                <span class=\"p\">)</span>\n\n                <span class=\"c1\"># add the full nD coords to intersection</span>\n                <span class=\"n\">intersection_point</span> <span class=\"o\">=</span> <span class=\"n\">start_point</span><span class=\"o\">.</span><span class=\"n\">copy</span><span class=\"p\">()</span>\n                <span class=\"n\">intersection_point</span><span class=\"p\">[</span><span class=\"n\">dims_displayed</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">intersection</span>\n\n            <span class=\"k\">else</span><span class=\"p\">:</span>\n                <span class=\"n\">value</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n                <span class=\"n\">intersection_point</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"n\">value</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n            <span class=\"n\">intersection_point</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n        <span class=\"k\">return</span> <span class=\"n\">value</span><span class=\"p\">,</span> <span class=\"n\">intersection_point</span>\n\n<div class=\"viewcode-block\" id=\"Shapes.get_index_and_intersection\"><a class=\"viewcode-back\" href=\"../../../../api/stable/napari.layers.Shapes.html#napari.layers.Shapes.get_index_and_intersection\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">get_index_and_intersection</span><span class=\"p\">(</span>\n        <span class=\"bp\">self</span><span class=\"p\">,</span>\n        <span class=\"n\">position</span><span class=\"p\">:</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">ndarray</span><span class=\"p\">,</span>\n        <span class=\"n\">view_direction</span><span class=\"p\">:</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">ndarray</span><span class=\"p\">,</span>\n        <span class=\"n\">dims_displayed</span><span class=\"p\">:</span> <span class=\"n\">List</span><span class=\"p\">[</span><span class=\"nb\">int</span><span class=\"p\">],</span>\n    <span class=\"p\">)</span> <span class=\"o\">-&gt;</span> <span class=\"n\">Tuple</span><span class=\"p\">[</span><span class=\"n\">Union</span><span class=\"p\">[</span><span class=\"nb\">float</span><span class=\"p\">,</span> <span class=\"nb\">int</span><span class=\"p\">],</span> <span class=\"kc\">None</span><span class=\"p\">]:</span>\n        <span class=\"sd\">\"\"\"Get the shape index and intersection point of the first shape</span>\n<span class=\"sd\">        (i.e., closest to start_point) \"under\" a mouse click.</span>\n\n<span class=\"sd\">        See examples/add_points_on_nD_shapes.py for example usage.</span>\n\n<span class=\"sd\">        Parameters</span>\n<span class=\"sd\">        ----------</span>\n<span class=\"sd\">        position : tuple</span>\n<span class=\"sd\">            Position in either data or world coordinates.</span>\n<span class=\"sd\">        view_direction : Optional[np.ndarray]</span>\n<span class=\"sd\">            A unit vector giving the direction of the ray in nD world coordinates.</span>\n<span class=\"sd\">            The default value is None.</span>\n<span class=\"sd\">        dims_displayed : Optional[List[int]]</span>\n<span class=\"sd\">            A list of the dimensions currently being displayed in the viewer.</span>\n<span class=\"sd\">            The default value is None.</span>\n\n<span class=\"sd\">        Returns</span>\n<span class=\"sd\">        -------</span>\n<span class=\"sd\">        value</span>\n<span class=\"sd\">            The data value along the supplied ray.</span>\n<span class=\"sd\">        intersection_point : np.ndarray</span>\n<span class=\"sd\">            (n,) array containing the point where the ray intersects the first shape</span>\n<span class=\"sd\">            (i.e., the shape most in the foreground). The coordinate is in layer</span>\n<span class=\"sd\">            coordinates.</span>\n<span class=\"sd\">        \"\"\"</span>\n        <span class=\"n\">start_point</span><span class=\"p\">,</span> <span class=\"n\">end_point</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_ray_intersections</span><span class=\"p\">(</span>\n            <span class=\"n\">position</span><span class=\"p\">,</span> <span class=\"n\">view_direction</span><span class=\"p\">,</span> <span class=\"n\">dims_displayed</span>\n        <span class=\"p\">)</span>\n        <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"n\">start_point</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span><span class=\"p\">)</span> <span class=\"ow\">and</span> <span class=\"p\">(</span><span class=\"n\">end_point</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span><span class=\"p\">):</span>\n            <span class=\"n\">shape_index</span><span class=\"p\">,</span> <span class=\"n\">intersection_point</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_get_index_and_intersection</span><span class=\"p\">(</span>\n                <span class=\"n\">start_point</span><span class=\"o\">=</span><span class=\"n\">start_point</span><span class=\"p\">,</span>\n                <span class=\"n\">end_point</span><span class=\"o\">=</span><span class=\"n\">end_point</span><span class=\"p\">,</span>\n                <span class=\"n\">dims_displayed</span><span class=\"o\">=</span><span class=\"n\">dims_displayed</span><span class=\"p\">,</span>\n            <span class=\"p\">)</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"n\">shape_index</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"kc\">None</span><span class=\"p\">,)</span>\n            <span class=\"n\">intersection_point</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n        <span class=\"k\">return</span> <span class=\"n\">shape_index</span><span class=\"p\">,</span> <span class=\"n\">intersection_point</span></div>\n\n<div class=\"viewcode-block\" id=\"Shapes.move_to_front\"><a class=\"viewcode-back\" href=\"../../../../api/stable/napari.layers.Shapes.html#napari.layers.Shapes.move_to_front\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">move_to_front</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"sd\">\"\"\"Moves selected objects to be displayed in front of all others.\"\"\"</span>\n        <span class=\"k\">if</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">selected_data</span><span class=\"p\">)</span> <span class=\"o\">==</span> <span class=\"mi\">0</span><span class=\"p\">:</span>\n            <span class=\"k\">return</span>\n        <span class=\"n\">new_z_index</span> <span class=\"o\">=</span> <span class=\"nb\">max</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_data_view</span><span class=\"o\">.</span><span class=\"n\">_z_index</span><span class=\"p\">)</span> <span class=\"o\">+</span> <span class=\"mi\">1</span>\n        <span class=\"k\">for</span> <span class=\"n\">index</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">selected_data</span><span class=\"p\">:</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_data_view</span><span class=\"o\">.</span><span class=\"n\">update_z_index</span><span class=\"p\">(</span><span class=\"n\">index</span><span class=\"p\">,</span> <span class=\"n\">new_z_index</span><span class=\"p\">)</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">refresh</span><span class=\"p\">()</span></div>\n\n<div class=\"viewcode-block\" id=\"Shapes.move_to_back\"><a class=\"viewcode-back\" href=\"../../../../api/stable/napari.layers.Shapes.html#napari.layers.Shapes.move_to_back\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">move_to_back</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"sd\">\"\"\"Moves selected objects to be displayed behind all others.\"\"\"</span>\n        <span class=\"k\">if</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">selected_data</span><span class=\"p\">)</span> <span class=\"o\">==</span> <span class=\"mi\">0</span><span class=\"p\">:</span>\n            <span class=\"k\">return</span>\n        <span class=\"n\">new_z_index</span> <span class=\"o\">=</span> <span class=\"nb\">min</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_data_view</span><span class=\"o\">.</span><span class=\"n\">_z_index</span><span class=\"p\">)</span> <span class=\"o\">-</span> <span class=\"mi\">1</span>\n        <span class=\"k\">for</span> <span class=\"n\">index</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">selected_data</span><span class=\"p\">:</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_data_view</span><span class=\"o\">.</span><span class=\"n\">update_z_index</span><span class=\"p\">(</span><span class=\"n\">index</span><span class=\"p\">,</span> <span class=\"n\">new_z_index</span><span class=\"p\">)</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">refresh</span><span class=\"p\">()</span></div>\n\n    <span class=\"k\">def</span> <span class=\"nf\">_copy_data</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"sd\">\"\"\"Copy selected shapes to clipboard.\"\"\"</span>\n        <span class=\"k\">if</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">selected_data</span><span class=\"p\">)</span> <span class=\"o\">&gt;</span> <span class=\"mi\">0</span><span class=\"p\">:</span>\n            <span class=\"n\">index</span> <span class=\"o\">=</span> <span class=\"nb\">list</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">selected_data</span><span class=\"p\">)</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_clipboard</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n                <span class=\"s1\">'data'</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n                    <span class=\"n\">deepcopy</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_data_view</span><span class=\"o\">.</span><span class=\"n\">shapes</span><span class=\"p\">[</span><span class=\"n\">i</span><span class=\"p\">])</span>\n                    <span class=\"k\">for</span> <span class=\"n\">i</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_selected_data</span>\n                <span class=\"p\">],</span>\n                <span class=\"s1\">'edge_color'</span><span class=\"p\">:</span> <span class=\"n\">deepcopy</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_data_view</span><span class=\"o\">.</span><span class=\"n\">_edge_color</span><span class=\"p\">[</span><span class=\"n\">index</span><span class=\"p\">]),</span>\n                <span class=\"s1\">'face_color'</span><span class=\"p\">:</span> <span class=\"n\">deepcopy</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_data_view</span><span class=\"o\">.</span><span class=\"n\">_face_color</span><span class=\"p\">[</span><span class=\"n\">index</span><span class=\"p\">]),</span>\n                <span class=\"s1\">'properties'</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n                    <span class=\"n\">k</span><span class=\"p\">:</span> <span class=\"n\">deepcopy</span><span class=\"p\">(</span><span class=\"n\">v</span><span class=\"p\">[</span><span class=\"n\">index</span><span class=\"p\">])</span> <span class=\"k\">for</span> <span class=\"n\">k</span><span class=\"p\">,</span> <span class=\"n\">v</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">properties</span><span class=\"o\">.</span><span class=\"n\">items</span><span class=\"p\">()</span>\n                <span class=\"p\">},</span>\n                <span class=\"s1\">'indices'</span><span class=\"p\">:</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_slice_indices</span><span class=\"p\">,</span>\n            <span class=\"p\">}</span>\n            <span class=\"k\">if</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">text</span><span class=\"o\">.</span><span class=\"n\">values</span><span class=\"p\">)</span> <span class=\"o\">==</span> <span class=\"mi\">0</span><span class=\"p\">:</span>\n                <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_clipboard</span><span class=\"p\">[</span><span class=\"s1\">'text'</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">empty</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">)</span>\n            <span class=\"k\">else</span><span class=\"p\">:</span>\n                <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_clipboard</span><span class=\"p\">[</span><span class=\"s1\">'text'</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">deepcopy</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">text</span><span class=\"o\">.</span><span class=\"n\">values</span><span class=\"p\">[</span><span class=\"n\">index</span><span class=\"p\">])</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_clipboard</span> <span class=\"o\">=</span> <span class=\"p\">{}</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">_paste_data</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"sd\">\"\"\"Paste any shapes from clipboard and then selects them.\"\"\"</span>\n        <span class=\"n\">cur_shapes</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">nshapes</span>\n        <span class=\"k\">if</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_clipboard</span><span class=\"o\">.</span><span class=\"n\">keys</span><span class=\"p\">())</span> <span class=\"o\">&gt;</span> <span class=\"mi\">0</span><span class=\"p\">:</span>\n            <span class=\"c1\"># Calculate offset based on dimension shifts</span>\n            <span class=\"n\">offset</span> <span class=\"o\">=</span> <span class=\"p\">[</span>\n                <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_slice_indices</span><span class=\"p\">[</span><span class=\"n\">i</span><span class=\"p\">]</span> <span class=\"o\">-</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_clipboard</span><span class=\"p\">[</span><span class=\"s1\">'indices'</span><span class=\"p\">][</span><span class=\"n\">i</span><span class=\"p\">]</span>\n                <span class=\"k\">for</span> <span class=\"n\">i</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_dims_not_displayed</span>\n            <span class=\"p\">]</span>\n\n            <span class=\"k\">for</span> <span class=\"n\">k</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">properties</span><span class=\"p\">:</span>\n                <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">properties</span><span class=\"p\">[</span><span class=\"n\">k</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">concatenate</span><span class=\"p\">(</span>\n                    <span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">properties</span><span class=\"p\">[</span><span class=\"n\">k</span><span class=\"p\">],</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_clipboard</span><span class=\"p\">[</span><span class=\"s1\">'properties'</span><span class=\"p\">][</span><span class=\"n\">k</span><span class=\"p\">]),</span>\n                    <span class=\"n\">axis</span><span class=\"o\">=</span><span class=\"mi\">0</span><span class=\"p\">,</span>\n                <span class=\"p\">)</span>\n\n            <span class=\"c1\"># Add new shape data</span>\n            <span class=\"k\">for</span> <span class=\"n\">i</span><span class=\"p\">,</span> <span class=\"n\">s</span> <span class=\"ow\">in</span> <span class=\"nb\">enumerate</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_clipboard</span><span class=\"p\">[</span><span class=\"s1\">'data'</span><span class=\"p\">]):</span>\n                <span class=\"n\">shape</span> <span class=\"o\">=</span> <span class=\"n\">deepcopy</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">)</span>\n                <span class=\"n\">data</span> <span class=\"o\">=</span> <span class=\"n\">copy</span><span class=\"p\">(</span><span class=\"n\">shape</span><span class=\"o\">.</span><span class=\"n\">data</span><span class=\"p\">)</span>\n                <span class=\"n\">data</span><span class=\"p\">[:,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_dims_not_displayed</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">data</span><span class=\"p\">[</span>\n                    <span class=\"p\">:,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_dims_not_displayed</span>\n                <span class=\"p\">]</span> <span class=\"o\">+</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">array</span><span class=\"p\">(</span><span class=\"n\">offset</span><span class=\"p\">)</span>\n                <span class=\"n\">shape</span><span class=\"o\">.</span><span class=\"n\">data</span> <span class=\"o\">=</span> <span class=\"n\">data</span>\n                <span class=\"n\">face_color</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_clipboard</span><span class=\"p\">[</span><span class=\"s1\">'face_color'</span><span class=\"p\">][</span><span class=\"n\">i</span><span class=\"p\">]</span>\n                <span class=\"n\">edge_color</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_clipboard</span><span class=\"p\">[</span><span class=\"s1\">'edge_color'</span><span class=\"p\">][</span><span class=\"n\">i</span><span class=\"p\">]</span>\n                <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_data_view</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span>\n                    <span class=\"n\">shape</span><span class=\"p\">,</span> <span class=\"n\">face_color</span><span class=\"o\">=</span><span class=\"n\">face_color</span><span class=\"p\">,</span> <span class=\"n\">edge_color</span><span class=\"o\">=</span><span class=\"n\">edge_color</span>\n                <span class=\"p\">)</span>\n\n            <span class=\"k\">if</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_clipboard</span><span class=\"p\">[</span><span class=\"s1\">'text'</span><span class=\"p\">])</span> <span class=\"o\">&gt;</span> <span class=\"mi\">0</span><span class=\"p\">:</span>\n                <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">text</span><span class=\"o\">.</span><span class=\"n\">values</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">concatenate</span><span class=\"p\">(</span>\n                    <span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">text</span><span class=\"o\">.</span><span class=\"n\">values</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_clipboard</span><span class=\"p\">[</span><span class=\"s1\">'text'</span><span class=\"p\">]),</span> <span class=\"n\">axis</span><span class=\"o\">=</span><span class=\"mi\">0</span>\n                <span class=\"p\">)</span>\n\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">selected_data</span> <span class=\"o\">=</span> <span class=\"nb\">set</span><span class=\"p\">(</span>\n                <span class=\"nb\">range</span><span class=\"p\">(</span><span class=\"n\">cur_shapes</span><span class=\"p\">,</span> <span class=\"n\">cur_shapes</span> <span class=\"o\">+</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_clipboard</span><span class=\"p\">[</span><span class=\"s1\">'data'</span><span class=\"p\">]))</span>\n            <span class=\"p\">)</span>\n\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">move_to_front</span><span class=\"p\">()</span>\n\n<div class=\"viewcode-block\" id=\"Shapes.to_masks\"><a class=\"viewcode-back\" href=\"../../../../api/stable/napari.layers.Shapes.html#napari.layers.Shapes.to_masks\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">to_masks</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">mask_shape</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n        <span class=\"sd\">\"\"\"Return an array of binary masks, one for each shape.</span>\n\n<span class=\"sd\">        Parameters</span>\n<span class=\"sd\">        ----------</span>\n<span class=\"sd\">        mask_shape : np.ndarray | tuple | None</span>\n<span class=\"sd\">            tuple defining shape of mask to be generated. If non specified,</span>\n<span class=\"sd\">            takes the max of all the vertices</span>\n\n<span class=\"sd\">        Returns</span>\n<span class=\"sd\">        -------</span>\n<span class=\"sd\">        masks : np.ndarray</span>\n<span class=\"sd\">            Array where there is one binary mask for each shape</span>\n<span class=\"sd\">        \"\"\"</span>\n        <span class=\"k\">if</span> <span class=\"n\">mask_shape</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n            <span class=\"c1\"># See https://github.com/napari/napari/issues/2778</span>\n            <span class=\"c1\"># Point coordinates land on pixel centers. We want to find the</span>\n            <span class=\"c1\"># smallest shape that will hold the largest point in the data,</span>\n            <span class=\"c1\"># using rounding.</span>\n            <span class=\"n\">mask_shape</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">round</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_extent_data</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">])</span> <span class=\"o\">+</span> <span class=\"mi\">1</span>\n\n        <span class=\"n\">mask_shape</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">ceil</span><span class=\"p\">(</span><span class=\"n\">mask_shape</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">astype</span><span class=\"p\">(</span><span class=\"s1\">'int'</span><span class=\"p\">)</span>\n        <span class=\"n\">masks</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_data_view</span><span class=\"o\">.</span><span class=\"n\">to_masks</span><span class=\"p\">(</span><span class=\"n\">mask_shape</span><span class=\"o\">=</span><span class=\"n\">mask_shape</span><span class=\"p\">)</span>\n\n        <span class=\"k\">return</span> <span class=\"n\">masks</span></div>\n\n<div class=\"viewcode-block\" id=\"Shapes.to_labels\"><a class=\"viewcode-back\" href=\"../../../../api/stable/napari.layers.Shapes.html#napari.layers.Shapes.to_labels\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">to_labels</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">labels_shape</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n        <span class=\"sd\">\"\"\"Return an integer labels image.</span>\n\n<span class=\"sd\">        Parameters</span>\n<span class=\"sd\">        ----------</span>\n<span class=\"sd\">        labels_shape : np.ndarray | tuple | None</span>\n<span class=\"sd\">            Tuple defining shape of labels image to be generated. If non</span>\n<span class=\"sd\">            specified, takes the max of all the vertiecs</span>\n\n<span class=\"sd\">        Returns</span>\n<span class=\"sd\">        -------</span>\n<span class=\"sd\">        labels : np.ndarray</span>\n<span class=\"sd\">            Integer array where each value is either 0 for background or an</span>\n<span class=\"sd\">            integer up to N for points inside the shape at the index value - 1.</span>\n<span class=\"sd\">            For overlapping shapes z-ordering will be respected.</span>\n<span class=\"sd\">        \"\"\"</span>\n        <span class=\"k\">if</span> <span class=\"n\">labels_shape</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n            <span class=\"c1\"># See https://github.com/napari/napari/issues/2778</span>\n            <span class=\"c1\"># Point coordinates land on pixel centers. We want to find the</span>\n            <span class=\"c1\"># smallest shape that will hold the largest point in the data,</span>\n            <span class=\"c1\"># using rounding.</span>\n            <span class=\"n\">labels_shape</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">round</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_extent_data</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">])</span> <span class=\"o\">+</span> <span class=\"mi\">1</span>\n\n        <span class=\"n\">labels_shape</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">ceil</span><span class=\"p\">(</span><span class=\"n\">labels_shape</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">astype</span><span class=\"p\">(</span><span class=\"s1\">'int'</span><span class=\"p\">)</span>\n        <span class=\"n\">labels</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_data_view</span><span class=\"o\">.</span><span class=\"n\">to_labels</span><span class=\"p\">(</span><span class=\"n\">labels_shape</span><span class=\"o\">=</span><span class=\"n\">labels_shape</span><span class=\"p\">)</span>\n\n        <span class=\"k\">return</span> <span class=\"n\">labels</span></div></div>\n</pre></div>\n      ","pageHeaders":[]}},"__N_SSG":true}